{"version":3,"sources":["helpers.js","eve-scout.js","init.js","options.js","layout.js","tripwire.js","global-hooks.js","wormholeRendering.js","widget-inlinecomplete.js","systemAnalysis.js","favourite.js","invasions.js","guidance.js","systemRendering.js","chain-map-renderer-base.js","chain-map-renderer-orgchart-side.js","chain-map-renderer-orgchart-top.js","chain-map-renderer-orgchart.js","chain-map-renderer-radial.js","chain-map.js","guidance_profiles.js","systemPanel.js","active.js","addSignature.js","api.js","automapper.js","comments.js","deleteSignature.js","editSignature.js","esi.js","eve.js","genericSystemTypes.js","parse.js","paste.js","redo.js","serverStatus.js","sync.js","systemChange.js","tutorials.js","undo.js","activity-graph.js","ckeditor.js","firefox-jquery-css-zoom.js","fw.js","mass.js","tracking.js","wormholeAnalysis.js","dialogs/admin-dialog.js","dialogs/base-dialog.js","dialogs/mask-dialog.js","dialogs/mass-dialog.js","dialogs/options-dialog.js","dialogs/ping-dialog.js","dialogs/signature-delete-dialog.js","dialogs/signature-dialog.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACv+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxnBA;AACA;AACA;AACA;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;Af7FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AgB9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.min.js","sourcesContent":["Object.sort = function(obj, prop) {\r\n\tvar swapped, prev;\r\n\tdo {\r\n\t\tswapped = false, prev = null;\r\n\t\tfor (var i in obj) {\r\n\t\t\tif (prev && Number(obj[i][prop]) < Number(obj[prev][prop])) {\r\n\t\t\t\tvar tmp = obj[i];\r\n\t\t\t\tobj[i] = obj[prev];\r\n\t\t\t\tobj[prev] = tmp;\r\n\t\t\t\tswapped = true;\r\n\t\t\t}\r\n\t\t\tprev = i;\r\n\t\t}\r\n\t} while (swapped);\r\n}\r\n\r\nObject.index = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn key;\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn key;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nObject.find = function(obj, prop, val, cs) {\r\n\tfor (var key in obj) {\r\n\t\tif (!cs && obj[key][prop] == val) {\r\n\t\t\treturn obj[key];\r\n\t\t} else if (obj[key][prop] && obj[key][prop].toLowerCase() == val.toLowerCase()) {\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n(function($){\r\n    $.fn.serializeObject = function(){\r\n\r\n        var self = this,\r\n            json = {},\r\n            push_counters = {},\r\n            patterns = {\r\n                \"validate\": /^[a-zA-Z][a-zA-Z0-9_]*(?:\\[(?:\\d*|[a-zA-Z0-9_]+)\\])*$/,\r\n                \"key\":      /[a-zA-Z0-9_]+|(?=\\[\\])/g,\r\n                \"push\":     /^$/,\r\n                \"fixed\":    /^\\d+$/,\r\n                \"named\":    /^[a-zA-Z0-9_]+$/\r\n            };\r\n\r\n\r\n        this.build = function(base, key, value){\r\n            base[key] = value;\r\n            return base;\r\n        };\r\n\r\n        this.push_counter = function(key){\r\n            if(push_counters[key] === undefined){\r\n                push_counters[key] = 0;\r\n            }\r\n            return push_counters[key]++;\r\n        };\r\n\r\n        $.each($(this).serializeArray(), function(){\r\n\r\n            // skip invalid keys\r\n            if(!patterns.validate.test(this.name)){\r\n                return;\r\n            }\r\n\r\n            var k,\r\n                keys = this.name.match(patterns.key),\r\n                merge = this.value,\r\n                reverse_key = this.name;\r\n\r\n            while((k = keys.pop()) !== undefined){\r\n\r\n                // adjust reverse_key\r\n                reverse_key = reverse_key.replace(new RegExp(\"\\\\[\" + k + \"\\\\]$\"), '');\r\n\r\n                // push\r\n                if(k.match(patterns.push)){\r\n                    merge = self.build([], self.push_counter(reverse_key), merge);\r\n                }\r\n\r\n                // fixed\r\n                else if(k.match(patterns.fixed)){\r\n                    merge = self.build([], k, merge);\r\n                }\r\n\r\n                // named\r\n                else if(k.match(patterns.named)){\r\n                    merge = self.build({}, k, merge);\r\n                }\r\n            }\r\n\r\n            json = $.extend(true, json, merge);\r\n        });\r\n\r\n        return json;\r\n    };\r\n})(jQuery);\r\n\r\nvar letterToNumbers = function(string) {\r\n    string = string.toUpperCase();\r\n    var letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', sum = 0, i;\r\n    for (i = 0; i < string.length; i++) {\r\n        sum += Math.pow(letters.length, i) * (letters.indexOf(string.substr(((i + 1) * -1), 1)) + 1);\r\n    }\r\n    return sum;\r\n};\r\n\r\n/** Find the relative position of one element within the hierarchy tree of another */\r\nfunction positionRelativeTo(elem, ancestor) {\r\n\tconst elemPos = elem.getBoundingClientRect(),\r\n\t\tancestorPos = ancestor.getBoundingClientRect();\r\n\treturn { \r\n\t\tleft: elemPos.left - ancestorPos.left + ancestor.scrollLeft,\r\n\t\ttop: elemPos.top - ancestorPos.top + ancestor.scrollTop\r\n\t};\r\n}\r\n\r\n/** Look up one or more values in a comma separated string as keys in a data map, and return a property from the results in a new comma separated string.\r\nConvenience function for UI mapping.\r\nWill throw a failure message, unless suppress=true in which case it will return undefined, if \r\nany of the lookups fail to resolve. */\r\nfunction lookupMultiple(map, propertyName, lookupString, suppress) {\r\n\tconst values = lookupString.split(',');\r\n\tconst results = [];\r\n\tfor(var i = 0; i < values.length; i++) {\r\n\t\tconst v = values[i];\r\n\t\tconst r = map[v];\r\n\t\tif(!r) { \r\n\t\t\tif(suppress) { return undefined;}\r\n\t\t\telse { throw 'Value ' + v + ' did not match anything in ' + map; }\r\n\t\t}\r\n\t\tresults.push(r[propertyName]);\r\n\t}\r\n\treturn results.join(',');\r\n}\r\n\r\n// Global CSS class change event\r\n(function($) {\r\n    var originalAddClassMethod = $.fn.addClass;\r\n\tvar originalRemoveClassMethod = $.fn.removeClass;\r\n\r\n    $.fn.addClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalAddClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n\r\n\t$.fn.removeClass = function(className) {\r\n        // Execute the original method.\r\n        var result = originalRemoveClassMethod.apply(this, arguments);\r\n\r\n        // trigger a custom event\r\n        this.trigger('classchange', className);\r\n\r\n        // return the original result\r\n        return result;\r\n    }\r\n})(jQuery);\r\n\r\n","const eveScout = new _EveScoutSignatureConnection();\r\n\r\nfunction _EveScoutSignatureConnection() {\r\n\tconst _this = this;\r\n\t\r\n\tthis.links = [];\r\n\t\r\n\tthis.active = function() {\r\n\t\treturn 'undefined' !== typeof options && options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout;\r\n\t}\r\n\t\r\n\tthis.nodeNameSuffix = 'eve-scout';\r\n\t\r\n\tthis.findLinks = function(systemID, ids) {\r\n\t\tif(!this.active()) { return []; }\r\n\t\t\r\n\t\tconst r = [];\r\n\t\tfor(var ti = 0; ti < this.links.length; ti++) {\r\n\t\t\tconst eveScoutLink = this.links[ti];\r\n\t\t\tconst eveScoutID = 'ES-' + eveScoutLink.id;\r\n\t\t\t\r\n\t\t\tconst nodeDefaults = {\r\n\t\t\t\tlife: eveScoutLink.remaining_hours >= 4 ? 'stable' : 'critical',\r\n\t\t\t\tmass: 'stable',\t// they no longer attempt to track mass\r\n\t\t\t\tid: eveScoutID,\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tif(eveScoutLink.out_system_id == systemID) {\t// Connection from this hole\r\n\t\t\t\tr.push(Object.assign({\r\n\t\t\t\t\t\r\n\t\t\t\t\tparent: {\r\n\t\t\t\t\t\tid: ids.parentID,\r\n\t\t\t\t\t\tsystemID: systemID,\r\n\t\t\t\t\t\tsignatureID: eveScoutLink.in_signature,\r\n\t\t\t\t\t\ttype: eveScoutLink.wh_exits_outward ? eveScoutLink.wh_type : 'K162'\r\n\t\t\t\t\t},\tchild: {\r\n\t\t\t\t\t\tid: ids.nextChildID++,\r\n\t\t\t\t\t\tsystemID: eveScoutLink.in_system_id,\r\n\t\t\t\t\t\tsignatureID: eveScoutLink.out_signature,\r\n\t\t\t\t\t\ttype: eveScoutLink.wh_exits_outward ? 'K162' : eveScoutLink.wh_type\r\n\t\t\t\t\t}\r\n\t\t\t\t}, nodeDefaults));\r\n\t\t\t} else if(eveScoutLink.in_system_id == systemID) { // Connection to this hole\r\n\t\t\t\tr.push(Object.assign({\r\n\t\t\t\t\tparent: {\r\n\t\t\t\t\t\tid: ids.parentID,\r\n\t\t\t\t\t\tsystemID: systemID,\r\n\t\t\t\t\t\tsignatureID: eveScoutLink.out_signature,\r\n\t\t\t\t\t\ttype: eveScoutLink.wh_exits_outward ? 'K162' : eveScoutLink.wh_type\r\n\t\t\t\t\t},\tchild: {\r\n\t\t\t\t\t\tid: ids.nextChildID++,\r\n\t\t\t\t\t\tsystemID: eveScoutLink.out_system_id,\r\n\t\t\t\t\t\tsignatureID: eveScoutLink.in_signature,\r\n\t\t\t\t\t\ttype: eveScoutLink.wh_exits_outward ? eveScoutLink.wh_type : 'K162'\r\n\t\t\t\t\t}\r\n\t\t\t\t}, nodeDefaults));\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn r;\r\n\t}\r\n\t\r\n\t/** Refresh the signature data from the public Eve-Scout API */\r\n\tthis.refresh = function() {\r\n\t\tif(!_this.active()) {\r\n\t\t\treturn;\t// only look for Thera data if on a tab with the option selected\r\n\t\t}\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\turl: 'cached_third_party.php?key=eve-scout-signatures',\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data, status, xhr) {\t\r\n\t\t\tif(!_.isEqual(data, _this.links)) {\r\n\t\t\t\tconsole.info('Updating map for EvE Scout update');\r\n\t\t\t\t_this.links = data;\r\n\t\t\t\tchain.redraw();\r\n\t\t\t}\r\n\t\t}).fail(function(xhr, status, error) {\r\n\t\t\tconsole.warn('Failed to fetch signatures from eve-scout.com: ' + status, error);\r\n\t\t});\r\n\t};\r\n\t\r\n\tsetInterval(this.refresh, 60000);\r\n\tsetTimeout(this.refresh, 0);\r\n}","function findSystemID(systemName) {\r\n\tfor(let k in appData.systems) {\r\n\t\tif(appData.systems[k].name.toUpperCase() === systemName.toUpperCase()) return k; \r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\nvar viewingSystem = $(\"meta[name=system]\").attr(\"content\");\r\nvar viewingSystemID = findSystemID(viewingSystem);\r\nvar server = $(\"meta[name=server]\").attr(\"content\");\r\nvar app_name = $(\"meta[name=app_name]\").attr(\"content\");\r\nvar version = $(\"meta[name=version]\").attr(\"content\");\r\n\r\n// Reload with default system if it was invalid\r\nif(!viewingSystemID) { window.stop(); window.location = '?system=Jita'; }\r\n\r\n// Use this to test performance of javascript code lines\r\n// var startTime = window.performance.now();\r\n// console.log(\"stint: \"+ (window.performance.now() - startTime));\r\n","var options = new function() {\r\n\tvar localOverrides = [\"grid\"];\r\n\tvar localOptions = JSON.parse(localStorage.getItem(\"tripwire_options\"));\r\n\tvar saveTimer;\r\n\r\n\tthis.userID = init.userID;\r\n\tthis.character = {id: init.characterID, name: init.characterName};\r\n\tthis.background = null;\r\n\tthis.uiscale = 1.0;\r\n\tthis.favorites = [];\r\n\tthis.grid = {};\r\n\tthis.tracking = {active: \"new\", characterOptions: {}};\r\n\tthis.masks = {active: init.corporationID + \".2\"};\r\n\tthis.chain = {gridlines: true, aura: true, lineWeight: 1.0, scrollWithoutCtrl: false, active: 0, tabs: [], \"node-reference\": \"type\", zoom: 1.0, sigNameLocation: 'name', routingLimit: 15, routeSecurity: 'shortest', routeIgnore: { enabled: false, systems: [ 'Tama', 'Rancer' ] }, renderer: 'radial', nodeSpacing: { x: 1.0, y: 1.0 } };\r\n\tthis.signatures = {editType: \"unknown\", copySeparator: \",\", pasteLife: 72, alignment: {sigID: \"centerAlign\", sigType: \"centerAlign\", sigAge: \"centerAlign\", leadsTo: \"centerAlign\", sigLife: \"centerAlign\", sigMass: \"centerAlign\"}};\r\n\tthis.buttons = {follow: false, chainWidget: {viewing: false, favorites: false}, signaturesWidget: {autoMapper: false}};\r\n\r\n\tthis.saveDelay = function(delay) {\r\n\t\tif (saveTimer) clearTimeout(saveTimer);\r\n\r\n\t\tsaveTimer = setTimeout(\"options.save()\", delay);\r\n\t};\r\n\r\n\t// Saves options in both cookie and database\r\n\tthis.save = function() {\r\n\t\tvar options = JSON.stringify(window.options.get());\r\n\r\n\t\tlocalStorage.setItem(\"tripwire_options\", options);\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"options.php\",\r\n\t\t\tdata: {mode: \"set\", options: options},\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t});\r\n\t};\r\n\r\n\t// Loads options via passed object else cookie\r\n\tthis.load = function(data) {\r\n\t\tif (data && typeof(data) != \"undefined\") {\r\n\t\t\tthis.set(this, data);\r\n\t\t} else if (localOptions) {\r\n\t\t\tthis.set(this, localOptions);\r\n\t\t}\r\n\r\n\t\tthis.apply();\r\n\t\tif(tripwire) { set_tracking_text(); }\r\n\t};\r\n\r\n\t// Gets options from this by exluding types == function\r\n\tthis.get = function() {\r\n\t\tvar data = {};\r\n\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tdata[x] = this[x];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t};\r\n\r\n\t// Sets this from passed object\r\n\tthis.set = function(local, data) {\r\n\t\tfor (var prop in data) {\r\n\t\t\tif (data[prop] && data[prop].constructor && data[prop].constructor === Object) {\r\n\t\t\t\tif (local) {\r\n\t\t\t\t\tif(typeof(local[prop]) === 'undefined') { local[prop] = {}; }\r\n\t\t\t\t\tthis.set(local[prop], data[prop]);\r\n\t\t\t\t}\r\n\t\t\t} else if (local) {\r\n\t\t\t\tlocal[prop] = data[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset = function() {\r\n\t\tfor (var x in this) {\r\n\t\t\tif (typeof(this[x]) != \"function\") {\r\n\t\t\t\tthis[x] = JSON.parse(JSON.stringify(this.reset.defaults[x]));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Applies settings\r\n\tthis.apply = function() {\r\n\t\t// Local browser overrides\r\n\t\tif (localOptions) {\r\n            for (key in localOverrides) {\r\n                this[localOverrides[key]] = localOptions[localOverrides[key]];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Grid layout (detect old IGB setting options)\r\n\t\tif (this.grid.hasOwnProperty(\"oog\") && Object.keys(this.grid.oog||{}).length) {\r\n\t\t\t$.each(this.grid.oog, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t} else if (Object.keys(this.grid||{}).length) {\r\n\t\t\t$.each(this.grid, function() {\r\n\t\t\t\t$(\"#\"+this.id).attr({\"data-col\": this.col, \"data-row\": this.row, \"data-sizex\": this.size_x, \"data-sizey\": this.size_y})\r\n\t\t\t\t\t.css({width: this.width, height: this.height});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Make sure favorites are all ints and not strings\r\n\t\tthis.favorites = $.map(this.favorites, function(favorite) {\r\n\t\t\treturn parseInt(favorite);\r\n\t\t});\r\n\r\n\t\t// Buttons\r\n\t\tif (this.buttons.follow) $(\"#follow\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.home) $(\"#home\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.kspace) $(\"#k-space\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.viewing) $(\"#show-viewing\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.favorites) $(\"#show-favorite\").addClass(\"active\");\r\n\t\tif (this.buttons.chainWidget.evescout) $(\"#eve-scout\").addClass(\"active\");\r\n\t\tif ($.inArray(parseInt(viewingSystemID), this.favorites) !== -1) $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\t\tif (this.buttons.signaturesWidget.autoMapper) $(\"#toggle-automapper\").addClass(\"active\");\r\n\r\n\t\t// UI Scale\r\n\t\tif (this.uiscale) {\r\n\t\t\t$(\"body\").css(\"zoom\", this.uiscale);\r\n\t\t}\r\n\r\n\t\t// Chain zoom\r\n\t\tif (this.chain.zoom) {\r\n\t\t\t$(\"#chainParent\").css(\"zoom\", this.chain.zoom);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.background) {\r\n\t\t\tvar a = $('<a>', { href:this.background } )[0];\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"background-image: url(https://\" + a.hostname + a.pathname + a.search + \");\");\r\n\t\t} else {\r\n\t\t\t$(\"#wrapper\").attr(\"style\", \"\");\r\n\t\t}\r\n\r\n\t\t// Characters in Options\r\n\t\t$(\"#dialog-options #characters\").html(\"<img src='https://image.eveonline.com/Character/\"+init.characterID+\"_64.jpg' />\");\r\n\r\n\t\t// Active mask\r\n\t\t$(\"#dialog-options input[name='mask']\").filter(\"[value='\"+this.masks.active+\"']\").attr(\"checked\", true);\r\n\r\n\t\t// Chain tabs\r\n\t\t$(\"#chainTabs\").html(\"\");\r\n\t\tfor (var x in this.chain.tabs) {\r\n\t\t\tif (this.chain.tabs[x]) {\r\n\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\r\n\t\t\t\t$tab.attr(\"id\", x).find(\".name\").data(\"tab\", this.chain.tabs[x].systemID).html(this.chain.tabs[x].name);\r\n\t\t\t\tif (x == this.chain.active) { $tab.addClass(\"current\"); }\r\n\r\n\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Reset routing cache in case routing options changed\r\n\t\tif(guidance) { guidance.clearCache(); }\r\n\r\n\t\t// Draw chain if Tripwire is initialized\r\n\t\tif (typeof(tripwire) !== \"undefined\") {\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t};\r\n\r\n\tthis.reset.defaults = JSON.parse(JSON.stringify(this.get()));\r\n\tthis.load(init && init.options ? init.options : null);\r\n}\r\n","var grid = $(\".gridster ul\").gridster({\r\n\twidget_selector: \"li.gridWidget\",\r\n\tavoid_overlapped_widgets: false,\r\n\twidget_base_dimensions: [50, 50],\r\n\twidget_margins: [5, 5],\r\n\tautogrow_cols: true,\r\n\thelper: \"clone\",\r\n\tdraggable: {\r\n\t\tstart: function(e, ui) {\r\n\t\t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n\t\t}\r\n\t},\r\n\tresize: {\r\n    \tenabled: true,\r\n    \thandle_class: \"grid-resize\",\r\n    \tmin_size: [4, 4],\r\n    \tstart: function(e) {\r\n    \t\t$(\"div.gridster\").width($(\"div.gridster ul\").width());\r\n    \t},\r\n    \tstop: function(e, ui, $widget) {\r\n    \t\t//var width = parseInt($(\".gridster\").css(\"margin-left\")) + this.container_width;\r\n    \t\t//$(\"#wrapper\").css({width: width + \"px\"})\r\n    \t\tswitch ($widget.attr(\"id\")) {\r\n    \t\t\tcase \"infoWidget\":\r\n    \t\t\t\tsetTimeout(\"activity.redraw();\", 300);\r\n    \t\t\t\tbreak;\r\n    \t\t}\r\n    \t}\r\n\t},\r\n\tserialize_params: function($w, wgd) {\r\n\t\treturn {\r\n\t\t\tid: $w.attr(\"id\"),\r\n\t\t\tcol: wgd.col,\r\n\t\t\trow: wgd.row,\r\n\t\t\tsize_x: wgd.size_x,\r\n\t\t\tsize_y: wgd.size_y,\r\n\t\t\twidth: $w.width(),\r\n\t\t\theight: $w.height()\r\n\t\t}\r\n\t}\r\n}).data(\"gridster\").disable();\r\n\r\ngrid.disable_resize();\r\n$(\".grid-resize\").addClass(\"hidden\").attr(\"data-icon\", \"resize\");\r\n\r\n$(\".gridster\").css({visibility: \"visible\"});\r\n$(\".gridster > *\").addClass(\"gridster-transition\");\r\n\r\n$(\"#layout\").click(function() {\r\n\tif (!$(this).hasClass(\"active\")) {\r\n\t\tgrid.enable();\r\n\t\tgrid.enable_resize();\r\n\t\t$(\".grid-resize\").removeClass(\"hidden\");\r\n\r\n\t\t$(this).addClass(\"active\");\r\n\t} else {\r\n\t\tgrid.disable();\r\n\t\tgrid.disable_resize();\r\n\t\t$(\".grid-resize\").addClass(\"hidden\");\r\n\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\toptions.grid = grid.serialize();\r\n\r\n\t\toptions.save();\r\n\t}\r\n});\r\n","var tripwire = new function() {\r\n    this.timer, this.xhr;\r\n\tthis.version = version;\r\n\tthis.client = {signatures: {}, wormholes: {}};\r\n\tthis.server = {signatures: {}, wormholes: {}};\r\n\tthis.signatures = {list: {}, undo: JSON.parse(sessionStorage.getItem(\"tripwire_undo\")) || {}, redo: JSON.parse(sessionStorage.getItem(\"tripwire_redo\")) || {}};\r\n\tthis.serverSignatureCount = 0;\r\n\tthis.activity = {};\r\n\tthis.data = {tracking: {}, esi: {}};\r\n\tthis.refreshRate = 5000;\r\n\tthis.connected = true;\r\n\tthis.ageFormat = \"HM\";\r\n\tthis.instance = window.name ? window.name : (new Date().getTime() / 1000, window.name = new Date().getTime() / 1000);\r\n\r\n\t// Reference to `this` that can be used inside of functions\r\n\tvar _this = this\r\n\r\n    // Command to start/stop tripwire updates\r\n\t// ToDo: Include API and Server timers\r\n\tthis.stop = function() {\r\n\t\tclearTimeout(this.timer);\r\n\t\treturn this.timer;\r\n\t};\r\n\r\n\tthis.start = function() {\r\n\t\treturn this.sync();\r\n\t}\r\n\r\n    // Command to change Age format\r\n\t// ToDo: Cookie change to keep\r\n\tthis.setAgeFormat = function(format) {\r\n\t\tvar format = typeof(format) !== 'undefined' ? format : this.ageFormat;\r\n\r\n\t\t$(\"span[data-age]\").each(function() {\r\n\t\t\t$(this).countdown(\"option\", {format: format});\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tthis.cookies = {\r\n\t\tgetCookie: function(c_name) {\r\n\t\t\tvar c_value = document.cookie;\r\n\r\n\t\t\tvar c_start = c_value.indexOf(\" \" + c_name + \"=\");\r\n\t\t\tif (c_start == -1) {\r\n\t\t\t\tc_start = c_value.indexOf(c_name + \"=\");\r\n\t\t\t}\r\n\r\n\t\t\tif (c_start == -1) {\r\n\t\t\t\tc_value = null;\r\n\t\t\t} else {\r\n\t\t\t\tc_start = c_value.indexOf(\"=\", c_start) + 1;\r\n\t\t\t\tvar c_end = c_value.indexOf(\";\", c_start);\r\n\r\n\t\t\t\tif (c_end == -1) {\r\n\t\t\t\t\tc_end = c_value.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tc_value = unescape(c_value.substring(c_start, c_end));\r\n\t\t\t}\r\n\r\n\t\t\treturn c_value;\r\n\t\t},\r\n\r\n\t\tsetCookie: function(c_name, value, exdays) {\r\n\t\t\tvar exdate = new Date();\r\n\t\t\texdate.setDate(exdate.getDate() + exdays);\r\n\t\t\tvar c_value = escape(value) + ((exdays == null) ? \"\" : \"; expires=\"+exdate.toUTCString());\r\n\r\n\t\t\tdocument.cookie = c_name + \"=\" + c_value + \";\" + (document.location.protocol == \"https:\" ? \"secure;\" : \"\");\r\n\t\t}\r\n\t};\r\n\r\n    this.serverTime = function() {\r\n\t\tthis.time;\r\n\r\n\t\tthis.serverTime.getTime = function() {\r\n\t\t\treturn tripwire.serverTime.time;\r\n\t\t}\r\n\t}\r\n    this.serverTime();\r\n\r\n    // Handles putting chain together\r\n\tthis.chainMap = function() {\r\n\t\tthis.chainMap.parse = function(data) {\r\n\t\t\tchain.draw(data);\r\n\t\t}\r\n\t}\r\n    this.chainMap();\r\n\r\n    this.pastEOL = function() {\r\n\t\tvar options = {since: $(this).countdown('option', 'until'), format: \"HM\", layout: \"-{hnn}{sep}{mnn}&nbsp;\"};\r\n\t\t$(this).countdown(\"option\", options);\r\n\t}\r\n\r\n    // Handles WH Type hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.whTooltip = function(sig) {\r\n\t\tif (viewingSystemID == sig.systemID) {\r\n\t\t\tif ($.inArray(sig.type, $.map(appData.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+(type || 'Unknown')+\"<br/>\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($.inArray(sig.sig2Type, $.map(appData.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\t\tvar type = sig.sig2Type;\r\n\t\t\t\tvar tooltip = '';\r\n\t\t\t} else {\r\n\t\t\t\tvar type = sig.type;\r\n\t\t\t\tvar tooltip = \"<b>Type:</b> \"+(type || 'Unknown')+\"<br/>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($.inArray(type, $.map(appData.wormholes, function(item, index) { return index;})) >= 0) {\r\n\t\t\tvar whType = true;\r\n\t\t} else {\r\n\t\t\tvar whType = false;\r\n\t\t}\r\n\r\n\t\ttooltip += \"<b>Life:</b> \"+(whType?appData.wormholes[type].life:\"Unknown\")+\"<br/>\";\r\n\r\n\t\tif (whType) {\r\n\t\t\tswitch (appData.wormholes[type].leadsTo.split(\"-\")[0]) {\r\n\t\t\t\tcase 'High':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='hisec'>\"+appData.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Low':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='lowsec'>\"+appData.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Null':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='nullsec'>\"+appData.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Class':\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span class='wh'>\"+appData.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\ttooltip += \"<b>Leads To:</b> <span>\"+appData.wormholes[type].leadsTo+\"</span><br/>\";\r\n\t\t\t}\r\n\r\n\t\t\ttooltip += \"<b>Max Mass</b>: \"+(Intl.NumberFormat().format(tripwire.wormholes[type].mass))+\" Kg<br/>\";\r\n\r\n\t\t\ttooltip += \"<b>Max Jumpable</b>: \"+(Intl.NumberFormat().format(tripwire.wormholes[type].jump))+\" Kg<br/>\";\r\n\t\t}\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\t// Handles Age hover-over tooltip\r\n\t// ToDo: Use native JS\r\n\tthis.ageTooltip = function(sig) {\r\n\t\t// var date = new Date(sig.lifeTime);\r\n\t\t// var localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t// date = new Date(date.getTime() + localOffset);\r\n        var date = new Date(sig.lifeTime);\r\n\r\n\t\tvar tooltip = \"<table class=\\\"age-tooltip-table\\\"><tr>\"\r\n        + \"<th>Created:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n        + \"<td>\"+sig.createdByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n        + \"</tr>\";\r\n\r\n\t\tif (sig.lifeTime != sig.modifiedTime) {\r\n\t\t\tdate = new Date(sig.modifiedTime);\r\n\t\t\t// localOffset = date.getTimezoneOffset() * 60000;\r\n\t\t\t// date = new Date(date.getTime() + localOffset);\r\n      \r\n\t\t\ttooltip += \"<tr><th>Last Modified:</th><td>\"+(date.getMonth()+1)+\"/\"+date.getDate()+\" \"+(date.getHours() < 10?'0':'')+date.getHours()+\":\"+(date.getMinutes() < 10?'0':'')+date.getMinutes()+\"</td>\"\r\n          + \"<td>\"+sig.modifiedByName.replace(/'/g, '&#39;').replace(/\"/g, '&#34;')+\"</td>\"\r\n          + \"</tr>\";\r\n\t\t}\r\n\r\n\t\ttooltip += \"</table>\";\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n    this.refresh = function(mode, data, successCallback, alwaysCallback) {\r\n\t\tvar mode = mode || 'refresh';\r\n\r\n\t\tthis.sync(mode, data, successCallback, alwaysCallback);\r\n\t}\r\n\r\n\t// getSystemIDsByNames performs a case-insensitive search of the internal\r\n\t// list of systems looking for matches on each system name in the given\r\n\t// comma-separated list of names. A comma-separated list of system IDs is\r\n\t// returned if all systems are found, otherwise the empty string is returned.\r\n\tthis.getSystemIDsByNames = function(systemNames) {\r\n\t\tif (!_this.systems) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tconst values = systemNames.split(\",\");\r\n\t\tconst systems = [];\r\n\t\tfor(var i = 0; i < values.length; i++) {\r\n\t\t\tfor (systemID in _this.systems) {\r\n\t\t\t\tconst system = _this.systems[systemID];\r\n\t\t\t\tif (system.name.toLowerCase() == values[i].toLowerCase()) {\r\n\t\t\t\t\tsystems.push(systemID);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (values.length != systems.length) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\treturn systems.join(\",\");\r\n\t}\r\n}\r\n","$(\"body\").on(\"click\", \"a[href^='.?system=']\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).attr(\"href\").replace(\".?system=\", \"\");\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system);\r\n\r\n\ttripwire.systemChange(systemID);\r\n});\r\n\r\n$(\"body\").on(\"submit\", \"#systemSearch\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tvar system = $(this).find(\"[name='system']\").val();\r\n\tvar systemID = Object.index(tripwire.systems, \"name\", system, true) || false;\r\n\r\n\tif (systemID !== false) {\r\n\t\ttripwire.systemChange(systemID);\r\n\t\t$(this).find(\"[name='system']\").val(\"\");\r\n\t\t$(\"#search\").click();\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#undo:not(.disabled)\", function() {\r\n\ttripwire.undo();\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#redo:not(.disabled)\", function() {\r\n\ttripwire.redo();\r\n});\r\n\r\n// Bind class=copy to copy the text of the previous element\r\n$(\".copy\").on('click', function(e) {\r\n\te.preventDefault();\r\n\tconst source = e.target.previousElementSibling;\r\n\tif(source) { navigator.clipboard.writeText(source.innerText); }\r\n\telse { console.warn('Copy event couldn\\'t find a source', e); }\r\n});\r\n\r\n// Chain map zooming (Gets funky if you push things too far)\r\n$(\"#chainParent\").on(\"wheel\", function(e) {\r\n\tif(!(options.chain.scrollWithoutCtrl || e.ctrlKey)) { return; }\r\n\te.preventDefault();\r\n\tvar zoom = parseFloat($(\"#chainParent\").css(\"zoom\")) || 1.0;\r\n\tvar min = 0.6;\r\n\tvar max = 2.0;\r\n\r\n    if (e.originalEvent.wheelDelta / 120 > 0 && zoom < max) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom + 0.1);\r\n    } else if (e.originalEvent.wheelDelta / 120 < 0 && zoom > min) {\r\n\t\t$(\"#chainParent\").css(\"zoom\", zoom - 0.1);\r\n    }\r\n\r\n\t// Show the reset zoom button for awhile\r\n\t$(\"#chain-zoom-reset\").fadeIn(200);\r\n\tif (this.timeout) clearTimeout(this.timeout);\r\n\tthis.timeout = setTimeout('$(\"#chain-zoom-reset\").fadeOut(200);', 3000);\r\n\r\n\t// Save options\r\n\toptions.chain.zoom = parseFloat($(\"#chainParent\").css(\"zoom\"));\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(\"#chain-zoom-reset\").on(\"click\", function() {\r\n\t$(\"#chainParent\").css(\"zoom\", 1);\r\n\toptions.chain.zoom = 1;\r\n\toptions.saveDelay(2000);\r\n});\r\n\r\n$(document).keydown(function(e)\t{\r\n\t//Abort - user is in input or textarea\r\n\tif ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n\t// Ctrl key hooks\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\r\n\t\tif (e.keyCode === 89 && !$(\"#redo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-y redo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#redo\").click();\r\n\t\t\tNotify.trigger(\"Redoing last undo\");\r\n\t\t} else if (e.keyCode === 90 && !$(\"#undo\").hasClass(\"disabled\")) {\r\n\t\t\t// Ctrl-z undo hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#undo\").click();\r\n\t\t\tNotify.trigger(\"Undoing last action\");\r\n\t\t} else if (e.keyCode === 65) {\r\n\t\t\t// Ctrl-a select all (signatures) hook\r\n\t\t\te.preventDefault();\r\n\t\t\t$(\"#sigTable tbody tr\").addClass(\"selected\");\r\n\t\t\t$(\"#signaturesWidget #delete-signature\").trigger(\"delete:refresh\");\r\n\t\t} else if (e.keyCode === 67) {\r\n\t\t\t// Ctrl-c copy selected signatures hook\r\n\t\t\tif (window.getSelection().toString() === \"\") {\r\n\t\t\t\tvar output = \"\";\r\n\t\t\t\t$(\"#sigTable tbody tr.selected\").each(function(row) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[$(this).data(\"id\")];\r\n\t\t\t\t\tvar row = [];\r\n\r\n\t\t\t\t\tif (signature.signatureID) {\r\n\t\t\t\t\t\trow.push(signature.signatureID.substring(0, 3).toUpperCase() + \"-\" + (signature.signatureID.substring(3, 6) || \"###\"));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(\"null\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.type);\r\n\t\t\t\t\tif (signature.type === \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\trow.push(wormhole.type || \"null\" );\r\n\t\t\t\t\t\trow.push(tripwire.systems[signature.systemID] ? tripwire.systems[signature.systemID].name : appData.genericSystemTypes[signature.systemID]);\r\n\t\t\t\t\t\trow.push(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : appData.genericSystemTypes[otherSignature.systemID]);\r\n\t\t\t\t\t\trow.push(wormhole.life);\r\n\t\t\t\t\t\trow.push(wormhole.mass);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trow.push(signature.name);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(signature.createdByName);\r\n\t\t\t\t\trow.push(signature.lifeTime);\r\n\t\t\t\t\trow.push(signature.lifeLength);\r\n\t\t\t\t\trow.push(signature.lifeLeft);\r\n\t\t\t\t\trow.push(signature.modifiedByName);\r\n\t\t\t\t\trow.push(signature.modifiedTime);\r\n\t\t\t\t\toutput += row.join(options.signatures.copySeparator) + \"\\r\\n\";\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#clipboard\").text(output);\r\n\t\t\t\t$(\"#clipboard\").focus();\r\n\t\t\t\t$(\"#clipboard\").select();\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\t// delete key keyhooks\r\n\t\tif (e.keyCode == 46 && $(\"#sigTable tr.selected\").length > 0) {\r\n\t\t\t$(\"#delete-signature\").click();\r\n\t\t}\r\n\t}\r\n});\r\n\r\n// $(\"#APIclock\").knob({angleArc: 359.9, height: 20, width: 20, max: 60, readOnly: true, displayInput: false, fgColor: \"#CCC\", bgColor: \"#666\"});\r\n\r\n$(\"#follow\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\toptions.buttons.follow = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n})\r\n\r\n$(\"#show-viewing\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.viewing = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#show-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\"))\r\n\t\t$(this).removeClass(\"active\");\r\n\telse\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\tchain.redraw();\r\n\r\n\toptions.buttons.chainWidget.favorites = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#system-favorite\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\").attr(\"data-icon\", \"star-empty\");\r\n\r\n\t\toptions.favorites.splice(options.favorites.indexOf(parseInt(viewingSystemID)), 1);\r\n\t} else {\r\n\t\t$(this).attr(\"data-icon\", \"star\").addClass(\"active\");\r\n\r\n\t\toptions.favorites.push(parseInt(viewingSystemID));\r\n\t}\r\n\r\n\tif ($(\"#show-favorite\").hasClass(\"active\"))\r\n\t\tchain.redraw();\r\n\r\n\toptions.save();\r\n});\r\n\r\n$('#favorite-dropdown-toggle').click(function() {\r\n\tconst target = document.getElementById('favorite-panel');\r\n\tif(target.style.display === 'none') {\r\n\t\tconst listWrapper = document.getElementById('favorite-panel-wrapper');\r\n\t\tlistWrapper.innerHTML = options.favorites.length == 0 ? '<p>You have no favourites. Use the star to add a system.</p>'\r\n\t\t\t: options.favorites.map(function(f) {\r\n\t\t\t\tconst systemInfo = systemAnalysis.analyse(f);\r\n\t\t\t\treturn '<p>' + systemRendering.renderSystem(systemInfo) + '</p>';\r\n\t\t\t}).join('\\n');\r\n\t\ttarget.style.display = '';\r\n\t} else { target.style.display = 'none'; }\r\n});\r\n\r\n$(\"#search\").click(function(e) {\r\n\t$(\"#searchSpan\").toggle();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\tif (tripwire.client.EVE && tripwire.client.EVE.systemName)\r\n\t\t\t$(\"#currentSpan\").show();\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#currentSpan\").hide();\r\n\r\n\t\t$(\"#searchSpan input[name=system]\").focus().select();\r\n\t}\r\n});\r\n\r\n$(\"#toggle-automapper\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t}\r\n\r\n\toptions.buttons.signaturesWidget.autoMapper = $(this).hasClass(\"active\");\r\n\toptions.save();\r\n});\r\n\r\n$(\"#user\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\r\n\t\t//$(\"#wrapper\").unbind(\"click\");\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\r\n\t\t$(\"#login > #panel\").css({display: \"inline\"});\r\n\t\t$(\"#loginForm input[name=username]\").focus().select();\r\n\t}\r\n});\r\n$(\"#wrapper\").click(function(e) { // Click outside closes\r\n\tif(!(e.originalEvent && e.originalEvent.isInPanel)) {\r\n\t\t$(\"#login > #panel\").css({display: \"none\"});\r\n\t\t$(\"#user\").removeClass(\"active\");\r\n\t}\r\n});\r\n$(\"#login\").click(function(e) { // click inside doesn't\r\n\te.originalEvent.isInPanel = true;\r\n})\r\n\r\n\r\n$(\"#logout\").click(function() {\r\n\twindow.location = \"logout.php\";\r\n});\r\n\r\nvar Notify = new function() {\r\n\tthis.trigger = function(content, color, stick, id) {\r\n\t\tvar color = typeof(color) !== \"undefined\" ? color : \"blue\";\r\n\t\tvar stick = typeof(stick) !== \"undefined\" ? stick : 10000;\r\n\t\tvar id = typeof(id) !== \"undefined\" ? id : null;\r\n\r\n\t\tnew jBox(\"Notice\", {\r\n\t\t\tid: id,\r\n\t\t\tcontent: content,\r\n\t\t\toffset: {y: 35},\r\n\t\t\tanimation: \"flip\",\r\n\t\t\tcolor: color,\r\n\t\t\tautoClose: stick\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Init valdiation tooltips\r\nvar ValidationTooltips = new jBox(\"Tooltip\", {\r\n\ttrigger: null,\r\n\taddClass: \"validation-tooltip\",\r\n\tanimation: \"flip\",\r\n\tfade: 0\r\n});\r\n\r\nvar Tooltips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"[data-tooltip]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\toutside: \"x\"\r\n});\r\n\r\nvar SystemActivityToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodePos = this.source.closest(\"[data-nodeid]\").position();\r\n\t\tvar parentPos = this.source.closest(\".nodeActivity\").position();\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeRouteToolTips = new jBox(\"Tooltip\", {\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {y: \"bottom\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar nodeHeight = this.source.closest(\"[data-nodeid]\").height();\r\n\t\t// var nodeWidth = this.source.closest(\"[data-nodeid]\").width();\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\t\t// var tooltipHeight = this.container.parent().height();\r\n\t\t\r\n\t\tthis.options.position = {x: targetPos.left + 3 - tooltipWidth /2 , y: targetPos.top + this.target[0].offsetHeight};\r\n\t}\r\n});\r\n\r\nvar WormholeTypeToolTips = new jBox(\"Tooltip\", {\r\n\tattach: $(\"#chainMap .whEffect[data-icon]\"),\r\n\tgetContent: \"data-tooltip\",\r\n\tposition: {x: \"left\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\t\tvar tooltipWidth = this.container.parent().width();\r\n\r\n\t\tthis.options.position = {x: targetPos.left - tooltipWidth - 10, y: targetPos.top - 3};\r\n\t}\r\n});\r\n\r\nvar OccupiedToolTips = new jBox(\"Tooltip\", {\r\n\tpointer: \"top:-3\",\r\n\tposition: {x: \"right\", y: \"center\"},\r\n\tappendTo: $(\"#chainParent\"),\r\n\toutside: \"x\",\r\n\tminWidth: 100,\r\n\tanimation: \"move\",\r\n\tadjustDistance: 100,\r\n\tresponsiveWidth: false,\r\n\treposition: true,\r\n\trepositionOnOpen: true,\r\n\trepositionOnContent: true,\r\n\tcreateOnInit: true,\r\n\tonOpen: function() {\r\n\t\tvar tooltip = this;\r\n\t\tconst nodeElemJ = this.source.closest(\"[data-nodeid]\");\r\n\t\tvar systemID = nodeElemJ.data(\"nodeid\");\r\n\t\tvar targetPos = positionRelativeTo(this.target[0], document.getElementById('chainParent'));\r\n\r\n\t\tthis.options.position = {x: targetPos.left + this.target[0].offsetWidth, y: targetPos.top - 3};\r\n\r\n\t\ttooltip.setContent(\"&nbsp;\");\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"occupants.php\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tdata: \"systemID=\"+systemID,\r\n\t\t\tcache: false\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.occupants) {\r\n\t\t\t\tvar chars = \"<table>\";\r\n\r\n\t\t\t\t// Sort by characterName\r\n\t\t\t\tdata.occupants.sort(function(a, b) {\r\n\t\t\t\t\tif (a.characterName.toLowerCase() < b.characterName.toLowerCase()) return -1;\r\n\t\t\t\t\tif (a.characterName.toLowerCase() > b.characterName.toLowerCase()) return 1;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (var x in data.occupants) {\r\n\t\t\t\t\tchars += \"<tr><td>\"+data.occupants[x].characterName+\"</td><td style='padding-left: 10px;'>\"+(data.occupants[x].shipTypeName?data.occupants[x].shipTypeName:\"\")+\"</td></tr>\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchars += \"</table>\";\r\n\t\t\t\ttooltip.setContent(chars);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").sortable({\r\n\titems: \"> .tab\",\r\n\taxis: \"x\",\r\n\tdelay: 150,\r\n\ttolerance: \"pointer\",\r\n\tcontainment: \"parent\",\r\n\tupdate: function(e, ui) {\r\n\t\tvar result = $(\"#chainTabs\").sortable(\"toArray\");\r\n\t\tvar newTabs = [];\r\n\r\n\t\tfor (var x in result) {\r\n\t\t\tnewTabs.push(options.chain.tabs[result[x]]);\r\n\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t}\r\n\r\n\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\toptions.chain.tabs = newTabs;\r\n\t\toptions.save();\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".tab\", function(e) {\r\n\te.preventDefault();\r\n\tchain.setActiveTab($(this).hasClass(\"current\") ? null : $(this).index())\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".closeTab\", function(e) {\r\n\te.stopPropagation();\r\n\tvar $tab = $(this).closest(\".tab\");\r\n\r\n\t$(\"#dialog-confirm #msg\").html(\"This tab will be removed, are you sure?\");\r\n\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\tbuttons: {\r\n\t\t\t\"Remove Tab\": function() {\r\n\t\t\t\tvar i = $tab.index();\r\n\r\n\t\t\t\toptions.chain.active = $(\".tab.current\").index();\r\n\t\t\t\toptions.chain.tabs.splice(i, 1);\r\n\t\t\t\toptions.save();\r\n\r\n\t\t\t\t$tab.remove();\r\n\t\t\t\tif ($(\"#chainTabs .tab.current\").length == 0) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:last\").click();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var x = 0, l = $(\"#chainTabs .tab\").length; x < l; x++) {\r\n\t\t\t\t\t$(\"#chainTabs .tab:eq(\"+x+\")\").attr(\"id\", x);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t},\r\n\t\t\tCancel: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t}\r\n\t}).dialog(\"open\");\r\n});\r\n\r\n$(\"#newTab\").on(\"click\", function() {\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-newTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-newTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#newTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-newTab .name\").val(viewingSystem).focus();\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").val(viewingSystem);\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, maxSize: 10, delay: 0, renderer: 'system'});\r\n\r\n\t\t\t\t$(\"#newTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tvar name = $(\"#dialog-newTab .name\").val();\r\n\t\t\t\t\tvar systemID = tripwire.getSystemIDsByNames($(\"#dialog-newTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#tabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#tabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-newTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#tabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: systemID, name: name, evescout: thera});\r\n\t\t\t\t\toptions.save();\r\n\r\n\t\t\t\t\t$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-newTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-newTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-newTab #tabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-newTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-newTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"#chainTabs\").on(\"click\", \".editTab\", function(e) {\r\n\te.stopPropagation();\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-editTab\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-editTab\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tOK: function() {\r\n\t\t\t\t\t$(\"#editTab_form\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-editTab .name\").val(options.chain.tabs[options.chain.active].name).focus();\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").val(options.chain.tabs[options.chain.active].systemID != 0 ? lookupMultiple(tripwire.systems, 'name', options.chain.tabs[options.chain.active].systemID) : \"\");\r\n\t\t\t\toptions.chain.tabs[options.chain.active].systemID != 0 ? $(\"#dialog-editTab #editTabType1\")[0].checked = true : $(\"#dialog-editTab #editTabType2\")[0].checked = true;\r\n\t\t\t\t$(\"#dialog-editTab #editTabThera\")[0].checked = options.chain.tabs[options.chain.active].evescout;\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").inlinecomplete({source: tripwire.aSigSystems, renderer: 'system', maxSize: 10, delay: 0});\r\n\r\n\t\t\t\t$(\"#editTab_form\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $tab = $(\"#chainTabs .tab\").eq([options.chain.active]);\r\n\t\t\t\t\tvar name = $(\"#dialog-editTab .name\").val();\r\n\t\t\t\t\tvar systemID = tripwire.getSystemIDsByNames($(\"#dialog-editTab .sigSystemsAutocomplete\").val());\r\n\t\t\t\t\tvar thera = $(\"#editTabThera\")[0].checked ? true : false;\r\n\r\n\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .name\")}).setContent(\"Must have a name!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if (!systemID && $(\"#editTabType1\")[0].checked) {\r\n\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-editTab .sigSystemsAutocomplete\")}).setContent(\"Must have valid systems (comma separated if multiple)!\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t} else if ($(\"#editTabType2\")[0].checked) {\r\n\t\t\t\t\t\tsystemID = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$tab.attr(\"id\", $(\"#chainTabs .tab\").length).find(\".name\").data(\"tab\", systemID).html(name);\r\n\t\t\t\t\toptions.chain.tabs[options.chain.active] = {systemID: systemID, name: name, evescout: thera};\r\n\t\t\t\t\toptions.save();\r\n\t\t\t\t\tchain.redraw();\r\n\r\n\t\t\t\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\r\n\t\t\t\t\t//$(\"#chainTabs\").append($tab);\r\n\r\n\t\t\t\t\t$(\"#dialog-editTab\").dialog(\"close\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-editTab .sigSystemsAutocomplete\").click(function(e) {\r\n\t\t\t\t\t$(\"#dialog-editTab #editTabType1\").click();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-editTab\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-editTab\").dialog(\"open\");\r\n\t}\r\n});\r\n\r\n// Signature column context menu\r\n$(\"#signaturesWidget #sigTable thead\").contextmenu({\r\n\tdelegate: \"th.sortable\",\r\n\tmenu: \"#signatureColumnMenu\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top\", at: \"center\", of: ui.target};\r\n    },\r\n\tselect: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"leftAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign rightAlign\").addClass(\"leftAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"leftAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"centerAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"leftAlign rightAlign\").addClass(\"centerAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"centerAlign\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightAlign\":\r\n\t\t\t\t$(\"#signaturesWidget #sigTable tbody td:nth-child(\"+ col +\")\").removeClass(\"centerAlign leftAlign\").addClass(\"rightAlign\");\r\n\t\t\t\toptions.signatures.alignment[colName] = \"rightAlign\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\toptions.save();\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar col = $(ui.target).parent().parent().children().index($(ui.target).parent()) + 1;\r\n\r\n\t\tswitch(col) {\r\n\t\t\tcase 1:\r\n\t\t\t\tcolName = \"sigID\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tcolName = \"sigType\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tcolName = \"sigAge\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tcolName = \"leadsTo\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tcolName = \"sigLife\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tcolName = \"sigMass\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", \"leftAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"centerAlign\", true);\r\n\t\t$(this).contextmenu(\"enableEntry\", \"rightAlign\", true);\r\n\r\n\t\t$(this).contextmenu(\"enableEntry\", options.signatures.alignment[colName], false);\r\n\t}\r\n});\r\n\r\n// Chain Map Context Menu\r\n$(\"#chainParent\").contextmenu({\r\n\tappendTo: \"#chainParent\",\r\n\tdelegate: \".nodeSystem a\",\r\n\tposition: function(event, ui) {\r\n        return {my: \"left top-1\", at: \"right top\", of: ui.target};\r\n    },\r\n\tmenu: \"#chainMenu\",\r\n\tshow: {effect: \"slideDown\", duration: 150},\r\n\tselect: function(e, ui) {\r\n\t\tconst nodeElem = $(ui.target[0]).closest(\"[data-nodeid]\");\r\n\t\tvar id = nodeElem.data(\"nodeid\");\r\n\t\tvar row = nodeElem.attr(\"id\").replace(\"node\", \"\") -1;\r\n\r\n\t\tswitch(ui.cmd) {\r\n\t\t\tcase \"showInfo\":\r\n\t\t\t\ttripwire.esi.showInfo(id, options.tracking.active);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"setDest\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, true);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"addWay\":\r\n\t\t\t\ttripwire.esi.setDestination(id, options.tracking.active, false);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"showMap\":\r\n\t\t\t\t// CCPEVE.showMap(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"red\":\r\n\t\t\t\tnodeElem.hasClass(\"redNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yellow\":\r\n\t\t\t\tnodeElem.hasClass(\"yellowNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"green\":\r\n\t\t\t\tnodeElem.hasClass(\"greenNode\") ? $(this).contextmenu(\"removeFlare\", id, ui) : $(this).contextmenu(\"setFlare\", id, ui.cmd, ui);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"mass\":\r\n\t\t\t\t$(\"#dialog-mass\").data(\"id\", nodeElem.data(\"sigid\")).data(\"systemID\", id).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ping\":\r\n\t\t\t\t$(\"#dialog-ping\").data(\"id\", nodeElem.data(\"sigid\") || null).data(\"systemID\", id).dialog(\"open\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"collapse\":\r\n\t\t\t\tvar toggle = options.chain.tabs[options.chain.active] ? ($.inArray(id, options.chain.tabs[options.chain.active].collapsed) == -1 ? true : false) : true;\r\n\t\t\t\tchain.renderer.collapse(id, toggle);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"makeTab\":\r\n\t\t\t\tconst existingTabIndex = Object.index(options.chain.tabs, 'systemID', '' + id, false);\r\n\t\t\t\tif(undefined !== existingTabIndex) {\r\n\t\t\t\t\tchain.setActiveTab(existingTabIndex);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst systemName = tripwire.systems[id].name;\r\n\t\t\t\t\toptions.chain.tabs.push({systemID: '' + id, name: systemName});\r\n\t\t\t\t\tvar newTab = $(\"#chainTab .tab\").clone();\r\n\t\t\t\t\tnewTab.attr('id', options.chain.tabs.length - 1).find(\".name\").data(\"tab\", id).html(systemName);\r\n\t\t\t\t\t$(\"#chainTabs\").append(newTab);\r\n\t\t\t\t\tchain.setActiveTab(options.chain.tabs.length - 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t},\r\n\tbeforeOpen: function(e, ui) {\r\n\t\tvar wormholeID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"sigid\") || null;\r\n\t\tvar systemID = $(ui.target[0]).closest(\"[data-nodeid]\").data(\"nodeid\");\r\n\r\n\t\t// Add check for k-space\r\n\t\tif (tripwire.systems[systemID].class || !tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", false);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"setDest\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"addWay\", true);\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"showMap\", false);\r\n\t\t}\r\n\t\t\r\n\t\t// Add check for in-sig\r\n\t\tif (wormholeID) {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", true);\r\n\t\t} else {\r\n\t\t\t$(this).contextmenu(\"enableEntry\", \"mass\", false);\r\n\t\t}\r\n\t\t\r\n\t\t// Add check for tab validity\r\n\t\tconst existingTab = Object.find(options.chain.tabs, 'systemID', '' + systemID, false);\r\n\t\t$('#makeTabMenuItem').text(existingTab ? 'View Tab' : 'Make Tab' );\r\n\t},\r\n\tcreate: function(e, ui) {\r\n\t\t// Fix some bad CSS from jQuery Position\r\n\t\t$(this).find(\".ui-front\").css(\"width\", \"10em\");\r\n\t\t$(this).find(\".ui-front\").css(\"position\", \"\");\r\n\r\n\t\t$.moogle.contextmenu.prototype.setFlare = function(systemID, flare, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID, \"flare\": flare};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\").addClass(flare+\"Node\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.push({systemID: systemID, flare: flare, time: null});\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$.moogle.contextmenu.prototype.removeFlare = function(systemID, ui) {\r\n\t\t\tvar data = {\"systemID\": systemID};\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"flares.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: data,\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.result) {\r\n\t\t\t\t\t// $(ui.target[0]).closest(\"td\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t\t\t\tchain.data.flares.flares.splice(Object.index(chain.data.flares.flares, \"systemID\", systemID), 1);\r\n\t\t\t\t\tchain.flares(chain.data.flares);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n});\r\n\r\n/** Format a signature ID like abc123 as ABC-123 for user display */\r\nfunction formatSignatureID(signatureID) {\r\n\treturn (!signatureID) ? '???-###' :\r\n\t\t(signatureID.length >= 3 ? signatureID.substring(0, 3).toUpperCase() : '') + \"-\" + (signatureID.length == 6 ? signatureID.substring(3, 6) : \"###\");\r\n}\r\n\r\n// Used to generate eve-survival guide link\r\nfunction linkSig(sigName) {\r\n\tvar wormholeSignatures = [\r\n\t\t// Ore sites\r\n\t\t\"Average Frontier Deposit\",\r\n\t\t\"Unexceptional Frontier Deposit\",\r\n\t\t\"Common Perimeter Deposit\",\r\n\t\t\"Exceptional Core Deposit\",\r\n\t\t\"Infrequent Core Deposit\",\r\n\t\t\"Unusual Core Deposit\",\r\n\t\t\"Rarified Core Deposit\",\r\n\t\t\"Isolated Core Deposit\",\r\n\t\t\"Ordinary Permiter Deposit\",\r\n\t\t\"Uncommon Core Deposit\",\r\n\r\n\t\t// Gas Sites\r\n\t\t\"Barren Perimeter Reservoir\",\r\n\t\t\"Minor Perimeter Reservoir\",\r\n\t\t\"Ordinary Perimeter Reservoir\",\r\n\t\t\"Sizeable Perimeter Reservoir\",\r\n\t\t\"Token Perimeter Reservoir\",\r\n\t\t\"Bountiful Frontier Reservoir\",\r\n\t\t\"Vast Frontier Reservoir\",\r\n\t\t\"Instrumental Core Reservoir\",\r\n\t\t\"Vital Core Reservoir\",\r\n\r\n\t\t// Class 1\r\n\t\t\"Perimeter Ambush Point\",\r\n\t\t\"Perimeter Camp\",\r\n\t\t\"Phase Catalyst Node\",\r\n\t\t\"The Line\",\r\n\t\t\"Forgotten Perimeter Coronation Platform\",\r\n\t\t\"Forgotten Perimeter Power Array\",\r\n\t\t\"Unsecured Perimeter Amplifier\",\r\n\t\t\"Unsecured Perimeter Information Center\",\r\n\r\n\t\t// Class 2\r\n\t\t\"Perimeter Checkpoint\",\r\n\t\t\"Perimeter Hangar\",\r\n\t\t\"The Ruins of Enclave Cohort 27\",\r\n\t\t\"Sleeper Data Sanctuary\",\r\n\t\t\"Forgotten Perimeter Gateway\",\r\n\t\t\"Forgotten Perimeter Habitation Coils\",\r\n\t\t\"Unsecured Perimeter Comms Relay\",\r\n\t\t\"Unsecured Perimeter Transponder Farm\",\r\n\r\n\t\t// Class 3\r\n\t\t\"Fortification Frontier Stronghold\",\r\n\t\t\"Outpost Frontier Stronghold\",\r\n\t\t\"Solar Cell\",\r\n\t\t\"The Oruze Construct\",\r\n\t\t\"Forgotten Frontier Quarantine Outpost\",\r\n\t\t\"Forgotten Frontier Recursive Depot\",\r\n\t\t\"Unsecured Frontier Database\",\r\n\t\t\"Unsecured Frontier Receiver\",\r\n\r\n\t\t// Class 4\r\n\t\t\"Frontier Barracks\",\r\n\t\t\"Frontier Command Post\",\r\n\t\t\"Integrated Terminus\",\r\n\t\t\"Sleeper Information Sanctum\",\r\n\t\t\"Forgotten Frontier Conversion Module\",\r\n\t\t\"Forgotten Frontier Evacuation Center\",\r\n\t\t\"Unsecured Frontier Digital Nexus\",\r\n\t\t\"Unsecured Frontier Trinary Hub\",\r\n\r\n\t\t// Class 5\r\n\t\t\"Core Garrison\",\r\n\t\t\"Core Stronghold\",\r\n\t\t\"Oruze Osobnyk\",\r\n\t\t\"Quarantine Area\",\r\n\t\t\"Forgotten Core Data Field\",\r\n\t\t\"Forgotten Core Information Pen\",\r\n\t\t\"Unsecured Frontier Enclave Relay\",\r\n\t\t\"Unsecured Frontier Server Bank\",\r\n\r\n\t\t// Class 6\r\n\t\t\"Core Citadel\",\r\n\t\t\"Core Bastion\",\r\n\t\t\"Strange Energy Readings\",\r\n\t\t\"The Mirror\",\r\n\t\t\"Forgotten Core Assembly Hall\",\r\n\t\t\"Forgotten Core Circuitry Disassembler\",\r\n\t\t\"Unsecured Core Backup Array\",\r\n\t\t\"Unsecured Core Emergence\"\r\n\t];\r\n\r\n\tif (wormholeSignatures.indexOf(sigName) > -1) {\r\n\t\treturn '<a href=\"http://eve-survival.org/wikka.php?wakka='+sigName.replace(/ /g, '')+'\" target=\"_blank\" class=\"siteLink\">'+sigName+'</a>';\r\n\t}\r\n\r\n\treturn sigName;\r\n}\r\n\r\n// Initialize tablesorter plugin on signaturesWidget table\r\n$(\"#sigTable\").tablesorter({\r\n\tsortReset: true,\r\n\twidgets: ['saveSort'],\r\n\ttextExtraction: {\r\n\t\t2: function(node) { return $(node).find(\"span\").data(\"age\"); }\r\n\t}\r\n});\r\n\r\n// Highlight signaturesWidget tr on click\r\n$(\"#sigTable tbody\").on(\"click\", \"tr\", function(e) {\r\n\tif (e.metaKey || e.ctrlKey) {\r\n\t\t// ctrl or cmd key\r\n\t\t$(this).toggleClass(\"selected\");\r\n\t} else if (e.shiftKey) {\r\n\t\t// shift key\r\n\t\t$(this).addClass(\"selected\");\r\n\t\t$(\"#sigTable tbody tr.selected:first\").nextUntil(\"#sigTable tbody tr.selected:last\").addBack().add(\"#sigTable tbody tr.selected:last\").addClass(\"selected\");\r\n\t} else {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n\t\t$(this).addClass(\"selected\");\r\n\t}\r\n});\r\n\r\n// Un-Highlight signaturesWidget tr on clicking outside\r\n$(document).click(function(e) {\r\n    if(!$(e.target).closest('#sigTable tbody').length && !$(e.target).closest('#edit-signature').length && !$(e.target).closest('#delete-signature').length) {\r\n\t\t$(\"#sigTable tbody tr.selected\").removeClass(\"selected\");\r\n    }\r\n});\r\n\r\n// Monitor custom 'classchange' event\r\n$(\"#sigTable tbody\").on(\"classchange\", \"tr\", function(e, className) {\r\n\t// Trigger signaturesWidget selected row change custom event\r\n\tif (className === \"selected\") {\r\n\t\t$(\"#signaturesWidget\").trigger(\"selected:change\");\r\n\t}\r\n});\r\n\r\n// Update signaturesWidget based on .selected rows change\r\n$(\"#signaturesWidget\").on(\"selected:change\", function() {\r\n\t// Enable/Disable delete icon\r\n\tif ($(\"#sigTable tr.selected\").length === 0) {\r\n\t\t$(\"#signaturesWidget #delete-signature\").addClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n\t}\r\n\r\n\t// Enable/Disable edit icon\r\n\tif ($(\"#sigTable tr.selected\").length === 1) {\r\n\t\t$(\"#signaturesWidget #edit-signature\").removeClass(\"disabled\");\r\n\t} else {\r\n\t\t$(\"#signaturesWidget #edit-signature\").addClass(\"disabled\");\r\n\t}\r\n})\r\n\r\n$(\"#dialog-error\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t},\r\n\tcreate: function() {\r\n\t\t$(this).dialog(\"option\", \"show\", {effect: \"shake\", duration: 150, easing: \"easeOutElastic\"});\r\n\t}\r\n});\r\n\r\n$(\"#dialog-msg\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tOk: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\n$(\"#dialog-confirm\").dialog({\r\n\tautoOpen: false,\r\n\tresizable: false,\r\n\tminHeight: 0,\r\n\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\tbuttons: {\r\n\t\tCancel: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n});\r\n\r\nif (window.location.href.indexOf(\"galileo\") != -1) {\r\n\tNotify.trigger(\"This is the test version of Tripwire.<br/>Please use <a href='https://tripwire.cloud-things.com'>Tripwire</a>\")\r\n}\r\n","/** Functions for rendering things relating to wormholes */\r\nconst wormholeRendering = new function() { \r\n\t/** Render a wormhole type (from appData.wormholes).\r\n\t* @param type The type object e.g. appData.wormholes.B274\r\n\t* @param key The wormhole type e.g. 'B274'\r\n\t* @param from What system, or type of system e.g. 'Class-2' the wormhole comes from. If omitted, the type object will be used\r\n\t* @param target As above but for the target of the wormhole\r\n\t*/\r\n\tthis.renderWormholeType = function(type, key, from, target) {\r\n\t\treturn ((key || type.key) ? '<b>' + (key || type.key || '') + '</b>: ' : '') +\r\n\t\t\tformatEndTypes(type.from, from) + '' + formatEndTypes(type.leadsTo, target) +\r\n\t\t\t(type.jump ? ' (' + this.renderMass(type.jump) + ')' : '')\r\n\t\t\t;\r\n\t};\r\n\t\r\n\t/** Render a mass number. */\r\n\tthis.renderMass = function(mass) { return Math.trunc(mass / 1e6) + 'kt'; }\r\n\t\r\n\tfunction formatEndTypes(types, override) {\r\n\t\tif(!types) { return '?'; }\r\n\t\ttypes = Array.isArray(types) ? types : [ types ];\r\n\t\t\r\n\t\tif(override) {\r\n\t\t\tconst overrideSystem = override.name ? override :\r\n\t\t\t\tsystemAnalysis.analyse(Object.index(appData.systems, \"name\", override, true) || override);\t// look up real system ID first\r\n\t\t\t\r\n\t\t\tconst eligibleTypes = types.filter(function(type) {\r\n\t\t\t\treturn overrideSystem.name == type || overrideSystem.genericSystemType == type;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(eligibleTypes.length) { types = eligibleTypes; }\r\n\t\t}\r\n\t\t\r\n\t\treturn types.map(function(type) {\r\n\t\t\tconst systemID = Object.index(appData.systems, \"name\", type, true) || type;\t// look up real system ID first\r\n\t\t\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\treturn system ? '<span class=\"' + system.systemTypeClass + '\">' + (system.name || system.systemTypeName) + '</span>' : undefined }\r\n\t\t).filter(function(x) { return x !== undefined; }).join(',');\r\n\t};\r\n}","// Custom inlinecomplete + dropdown input\r\n$.widget(\"custom.inlinecomplete\", $.ui.autocomplete, {\r\n\t_create: function() {\r\n\t\tthis.options.source = this._coerceSource(this.options.source);\r\n\t\t\r\n\t\tif (!this.element.is(\"input\")) {\r\n\t\t\tthis._selectInit();\r\n\t\t}\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super();\r\n\t},\r\n\t_value: function() {\r\n\t\t// Invoke the parent function\r\n\t\tvar originalReturn = this._superApply(arguments);\r\n\r\n\t\tthis.element.change();\r\n\r\n\t\treturn originalReturn;\r\n\t},\r\n\t_suggest: function(items) {\r\n\t\t// if (this.element.val() != items[0].value) {\r\n\t\t\t// this.element.val(items[0].value.substr(0, this.element.val().length));\r\n\t\t// }\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(items);\r\n\t},\r\n\t_coerceSource: function(source) {\r\n\t\t// Allow an object source like tripwire.systems - coerce it to an array\r\n\t\treturn $.isArray(source) ? source :\r\n\t\t\tObject.keys(source).map(function(k) { return Object.assign({ key: k }, source[k]); }.bind(this) );\r\n\t},\r\n\t_initSource: function() {\r\n\t\tthis.source = function(request, response) {\r\n\t\t\tvar matcher = new RegExp(\"^\" + $.ui.autocomplete.escapeRegex(request.term), \"i\");\r\n\t\t\tvar results = new Array(); // results array\r\n\t\t\tconst dataSource = this.options.source;\r\n\t\t\tvar maxSize = this.options.maxSize || 25; // maximum result size\r\n\t\t\t// simple loop for the options\r\n\t\t\tfor (var i = 0, l = dataSource.length; i < l; i++) {\r\n\t\t\t\tconst target = dataSource[i].name || dataSource[i].key || dataSource[i];\r\n\t\t\t\tif (matcher.test(target)) {\r\n\t\t\t\t\tresults.push( { value: target, label: target, content: typeof dataSource[i] === 'object' ? dataSource[i] : undefined });\r\n\r\n\t\t\t\t\tif (maxSize && request.term !== '' && results.length > maxSize) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t // send response\r\n\t\t\t response(results);\r\n\t\t}\r\n\t},\t\r\n\t_renderItem: function( ul, item ) {\r\n\t\tif(item.content && this.options.renderer) {\r\n\t\t\tconst renderFunction = typeof this.options.renderer === 'function' ? this.options.renderer : renderers[this.options.renderer];\r\n\t\t\tconst renderResult = renderFunction(item.content);\r\n\t\t\treturn $( \"<li>\" )\r\n\t\t\t.html( '<span>' + renderResult + '</span>')\r\n\t\t\t.appendTo( ul );\r\n\t\t} else return this._super(ul, item);\r\n\t},\r\n\t_close: function(event) {\r\n\t\tthis.options.source = this.options.input_source ? this.options.input_source : this.options.source;\r\n\r\n\t\t// Invoke the parent function\r\n\t\treturn this._super(event);\r\n\t},\r\n\taddToSelect: function(value) {\r\n\t\tthis.options.select_added_value = value;\r\n\t\tthis.options.select_source.unshift(value);\r\n\t},\r\n\tremoveFromSelect: function(value) {\r\n\t\tif (value) {\r\n\t\t\tthis.options.select_source.splice(value, 1);\r\n\t\t} else if (this.options.select_added_value) {\r\n\t\t\tthis.options.select_source.splice(this.options.select_added_value, 1);\r\n\t\t}\r\n\t\tthis.options.select_added_value = null;\r\n\t},\r\n\t_selectInit: function() {\r\n\t\tthis.element.addClass(\"custom-combobox\");\r\n\t\tthis.wrapper = this.element;\r\n\t\tthis.element = this.wrapper.find(\"input:first\") || this.element;\r\n\t\tthis.select = this.wrapper.find(\"select:first\").remove();\r\n\r\n\t\tthis.options.input_source = this.options.source;\r\n\t\tconst selectItemMapper = this.options.select_item_mapper || function(x) { return x; };\r\n\t\tthis.options.select_source = selectItemMapper(this.select.children(\"option[value!='']\").map(function() { return $.trim(this.text); }).toArray());\r\n\r\n\t\tthis._createShowAllButton();\r\n\t},\r\n\t_createShowAllButton: function() {\r\n        var that = this,\r\n          wasOpen = false;\r\n\r\n        $(\"<a>\")\r\n\t\t\t.attr(\"tabIndex\", that.element.prop(\"tabindex\"))\r\n\t\t\t.attr(\"title\", \"\")\r\n\t\t\t.appendTo(that.wrapper)\r\n\t\t\t.button({icons: {primary: \"ui-icon-triangle-1-s\"}, text: false})\r\n\t\t\t.removeClass(\"ui-corner-all\")\r\n\t\t\t.addClass(\"custom-combobox-toggle ui-corner-right\")\r\n\t\t\t.on(\"mousedown\", function() {\r\n\t\t\t\twasOpen = that.widget().is(\":visible\");\r\n\t\t\t})\r\n\t\t\t.on(\"click\", function() {\r\n\t\t\t\tthat.element.trigger(\"focus\");\r\n\r\n\t\t\t\t// Close if already visible\r\n\t\t\t\tif (wasOpen) {\r\n\t\t\t\t  return;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pass empty string as value to search for, displaying all results\r\n\t\t\t\tif(that.options.customDropdown) {\r\n\t\t\t\t\tthat.options.select_source = that._coerceSource(that.options.customDropdown())\r\n\t\t\t\t}\r\n\t\t\t\tthat.options.source = that.options.select_source;\r\n\t\t\t\tthat._search(\"\");\r\n\t\t\t});\r\n\t},\r\n});\r\n\r\nconst renderers =  {\r\n\tsystem: function(system) {\r\n\t\treturn systemRendering.renderSystem(systemAnalysis.analyse(undefined, system), 'span');\r\n\t},\r\n\twormholeType: wormholeRendering.renderWormholeType\r\n};\r\n","const systemAnalysis = new function() {\r\n\tconst mutators = [];\r\n\tthis.addMutator = function(m) { mutators.push(m); }\r\n\t\r\n\t/** Extract attributes of the system, and allow mutators to add/modify them.\r\n\t\tOptionally, pass in a system object */\r\n\tthis.analyse = function(systemID, system) {\r\n\t\tif(!system) { system = appData.systems[systemID]; }\r\n\t\tif(!system) { system = getDummySystem(systemID); }\r\n\t\tif(!systemID) { systemID = system.systemID; }\r\n\t\tconst r = Object.assign({}, system);\r\n\t\t\r\n\t\t// Defaults or saved original values\r\n\t\tr.baseSecurity = 1 * system.security;\r\n\t\tr.pathSymbol = '';\r\n\t\tr.systemTypeModifiers = [];\t\t\r\n\t\tr.systemID = systemID;\r\n\t\t\r\n\t\tmutators.forEach(function(m) { m.mutate(r, systemID); });\r\n\t\t\r\n\t\t// Calculated final values\r\n\t\tr.class = (!r.class || Array.isArray(r.class)) ? r.class : [1 * r.class];\r\n\t\tr.systemTypeClass = r.class ? 'wh class-' + r.class[0] :\r\n\t\t\tr.factionID == 500026 ? 'triglavian' :\r\n\t\t\tr.security >= 0.45 ? 'hisec' :\r\n\t\t\tr.security > 0.0 ? 'lowsec' :\r\n\t\t\tr.security <= 0.0 ? 'nullsec' :\r\n\t\t\t'unknown';\r\n\t\tr.systemTypeName = r.class ? 'C' + r.class.join('/') :\r\n\t\t\tr.factionID == 500026 ? 'Trig' :\r\n\t\t\tr.baseSecurity >= 0.45 ? 'HS' :\r\n\t\t\tr.baseSecurity > 0.0 ? 'LS' :\r\n\t\t\tr.baseSecurity <= 0.0 ? 'NS' :\r\n\t\t\t'';\r\n\t\tr.genericSystemType = r.class ? r.class.map(x => 'Class-' + x) :\r\n\t\t\tr.factionID == 500026 ? ['Triglavian'] :\r\n\t\t\tr.baseSecurity >= 0.45 ? ['High-Sec'] :\r\n\t\t\tr.baseSecurity > 0.0 ? ['Low-Sec'] :\r\n\t\t\tr.baseSecurity <= 0.0 ? ['Null-Sec'] :\r\n\t\t\tundefined;\r\n\t\tr.effectClass = \r\n\t\t\tr.effect === 'Black Hole' ? 'blackhole' :\r\n\t\t\tr.effect === 'Cataclysmic Variable' ? 'cataclysmic-variable' :\r\n\t\t\tr.effect === 'Magnetar' ? 'magnetar' :\r\n\t\t\tr.effect === 'Pulsar' ? 'pulsar' :\r\n\t\t\tr.effect === 'Red Giant' ? 'red-giant' :\r\n\t\t\tr.effect === 'Wolf-Rayet Star' ? 'wolf-rayet' :\r\n\t\t\tundefined;\r\n\t\t\t\r\n\t\treturn r;\r\n\t};\r\n\t\r\n\t/** Get the classes possible for a 'leads to' text e.g. 'Class-2', 'Dangerous', 'Triglavian' */\r\n\tfunction classForTypeName(leadsTo) {\r\n\t\treturn leadsTo && leadsTo.substring(0, 6) == 'Class-' ? [1 * leadsTo.substring(6)] :\r\n\t\t\t'Dangerous' == leadsTo ? [4,5] :\r\n\t\t\t'Unknown' == leadsTo ? [2,3] :\r\n\t\t\t'Unknown (small)' == leadsTo ? [1,2,3,13] :\r\n\t\t\tundefined;\r\n\t};\r\n\tthis.classForTypeName = classForTypeName;\t// expose public\r\n\t\r\n\t/** Create a dummy system object for fake IDs like 'Null-Sec', 'Class-5' etc */\r\n\tfunction getDummySystem(systemID) {\r\n\t\tconst leadsToPointer = typeof(systemID) === \"string\" && systemID.indexOf(\"|\") >= 0 ? appData.genericSystemTypes[systemID.substring(0, systemID.indexOf(\"|\"))]\r\n\t\t: appData.genericSystemTypes.indexOf(systemID) >= 0 ? systemID\r\n\t\t: appData.genericSystemTypes[systemID];\r\n\t\tconst nodeClass = classForTypeName(leadsToPointer);\r\n\t\tconst nodeSecurity = \r\n\t\t\tleadsToPointer == \"High-Sec\" ? 0.8 :\r\n\t\t\tleadsToPointer == \"Low-Sec\" ? 0.4 :\r\n\t\t\tleadsToPointer == \"Null-Sec\" ? -0.1 :\r\n\t\t\tundefined;\r\n\t\tconst nodeFaction = \r\n\t\t\tleadsToPointer == \"Triglavian\" ? 500026 :\r\n\t\t\tundefined;\r\n\t\t\r\n\t\treturn { security: nodeSecurity, class: nodeClass, factionID: nodeFaction };\r\n\t}\r\n}","const mutator_favourite = new _FavouriteMutator();\r\nsystemAnalysis.addMutator(mutator_favourite);\r\n\r\nfunction _FavouriteMutator() {\r\n\tconst _this = this;\r\n\r\n\tthis.mutate = function(system, systemID) {\r\n\t\tif(options.favorites.indexOf(systemID * 1) >= 0) {\r\n\t\t\tsystem.pathSymbol = '';\r\n\t\t\tsystem.systemTypeModifiers.push('<span class=\"favorite active\" data-icon=\"star\"></span>');\t\t// star added by CSS\r\n\t\t}\r\n\t}\r\n}","const invasions = new _Invasions();\r\nsystemAnalysis.addMutator(invasions);\r\n\r\nfunction _Invasions() {\r\n\tconst _this = this;\r\n\tconst pathSymbolMap = {\r\n\t\tstellar_reconnaissance: '',\r\n\t\t\r\n\t\ttriglavian_minor_victory: '',\r\n\t\tescalating_liminality: '',\r\n\t\tfinal_liminality: '',\r\n\t\t\r\n\t\tedencom_minor_victory: '',\r\n\t\tredoubt: '', bulwark: '',\r\n\t\tfortress: '',\r\n\t};\r\n\tconst textMap = {\r\n\t\tstellar_reconnaissance: 'Stellar Reconnaissance',\r\n\t\t\r\n\t\ttriglavian_minor_victory: 'Triglavian Minor Victory',\r\n\t\tescalating_liminality: 'Escalating Liminality',\r\n\t\tfinal_liminality: 'Final Liminality',\r\n\t\t\r\n\t\tedencom_minor_victory: 'EDENCOM Minor Victory',\r\n\t\tredoubt: 'Redoubt',\r\n\t\tbulwark: 'Bulwark',\r\n\t\tfortress: 'EDENCOM Fortress',\r\n\t}\r\n\tconst data = [{\"system_id\":30003088,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-10-04T12:29:02.888Z\",\"system_name\":\"Oyonata\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003894,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-10-01T18:28:09.852Z\",\"system_name\":\"Sabusi\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004302,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-30T15:36:50.977Z\",\"system_name\":\"Omigiav\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003539,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-30T14:11:30.759Z\",\"system_name\":\"Miakie\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005074,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-30T14:02:33.042Z\",\"system_name\":\"Daran\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003570,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-30T13:47:01.992Z\",\"system_name\":\"Elore\",\"system_security\":\"0.2\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003573,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-28T15:38:24.368Z\",\"system_name\":\"Pertnineere\",\"system_security\":\"0.4\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003463,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-28T15:38:14.299Z\",\"system_name\":\"Erlendur\",\"system_security\":\"0.5\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30002079,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-09-28T15:37:20.058Z\",\"system_name\":\"Krirald\",\"system_security\":\"0.2\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30002652,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-09-28T15:36:53.719Z\",\"system_name\":\"Ala\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30045331,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-28T15:36:28.616Z\",\"system_name\":\"Vaaralen\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003788,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-26T12:44:03.049Z\",\"system_name\":\"Intaki\",\"system_security\":\"0.1\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002724,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-25T00:51:28.251Z\",\"system_name\":\"Assiettes\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002999,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-24T12:03:23.037Z\",\"system_name\":\"Shastal\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000102,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-23T22:22:21.093Z\",\"system_name\":\"Dysa\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003919,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-22T10:22:11.970Z\",\"system_name\":\"Ashkoo\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004978,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-22T10:21:30.195Z\",\"system_name\":\"Pemene\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30004287,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-20T11:25:28.863Z\",\"system_name\":\"Esubara\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002051,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-20T11:25:09.478Z\",\"system_name\":\"Anher\",\"system_security\":\"0.5\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003823,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-20T11:24:54.777Z\",\"system_name\":\"Kenninck\",\"system_security\":\"0.1\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001400,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-18T14:03:33.048Z\",\"system_name\":\"Litiura\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30005251,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-18T09:42:27.550Z\",\"system_name\":\"Asanot\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005267,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-17T11:18:57.960Z\",\"system_name\":\"Bherdasopt\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002411,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.3\",\"updated_at\":\"2020-09-17T00:30:42.544Z\",\"system_name\":\"Skarkon\",\"system_security\":\"0.1\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003587,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-15T01:16:50.021Z\",\"system_name\":\"Harner\",\"system_security\":\"0.1\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003904,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-14T16:54:07.359Z\",\"system_name\":\"Col\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005209,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-14T16:53:54.556Z\",\"system_name\":\"Sibe\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004103,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-14T13:40:36.727Z\",\"system_name\":\"Kothe\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005219,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-13T09:34:00.331Z\",\"system_name\":\"Sigga\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002755,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-12T20:51:38.354Z\",\"system_name\":\"Usi\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003824,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-11T08:28:52.435Z\",\"system_name\":\"Archavoinet\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002239,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-11T08:28:42.669Z\",\"system_name\":\"Rammi\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005005,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.5\",\"updated_at\":\"2020-09-10T21:09:12.196Z\",\"system_name\":\"Ignebaener\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30000021,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.8\",\"updated_at\":\"2020-09-09T21:16:25.577Z\",\"system_name\":\"Kuharah\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000118,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-09T08:08:17.988Z\",\"system_name\":\"Uanzin\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003794,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-07T23:26:42.297Z\",\"system_name\":\"Stacmon\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003927,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-07T22:18:47.862Z\",\"system_name\":\"Zahefeus\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000109,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-07T20:54:30.351Z\",\"system_name\":\"Berta\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002797,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.9\",\"updated_at\":\"2020-09-06T13:33:29.649Z\",\"system_name\":\"Kaunokka\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30031392,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-09-06T13:33:15.544Z\",\"system_name\":\"Komo\",\"system_security\":\"0.8\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30004090,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-06T06:22:50.377Z\",\"system_name\":\"Aband\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000060,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-06T01:54:13.794Z\",\"system_name\":\"Janus\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003548,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-05T17:05:22.429Z\",\"system_name\":\"Barira\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000160,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-04T23:48:55.626Z\",\"system_name\":\"Reisen\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30004999,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-04T15:38:27.450Z\",\"system_name\":\"Ladistier\",\"system_security\":\"0.3\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30000113,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-04T07:07:27.574Z\",\"system_name\":\"Astabih\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004295,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-09-02T18:09:55.446Z\",\"system_name\":\"Keba\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001413,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.2\",\"updated_at\":\"2020-09-02T08:11:42.869Z\",\"system_name\":\"Nani\",\"system_security\":\"0.8\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002386,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-09-01T08:04:35.922Z\",\"system_name\":\"Gelfiven\",\"system_security\":\"0.6\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30004973,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-31T21:17:02.227Z\",\"system_name\":\"Caslemon\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30004231,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-31T20:32:52.884Z\",\"system_name\":\"Shakasi\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004284,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-31T20:32:43.772Z\",\"system_name\":\"Defsunun\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002266,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-31T10:38:02.368Z\",\"system_name\":\"Ahmak\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003932,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-29T23:12:29.549Z\",\"system_name\":\"Timudan\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004254,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-28T16:43:28.986Z\",\"system_name\":\"Fihrneh\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004244,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-28T07:55:35.187Z\",\"system_name\":\"Onanam\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002513,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-27T20:59:21.817Z\",\"system_name\":\"Dammalin\",\"system_security\":\"0.5\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30000206,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.5\",\"updated_at\":\"2020-08-27T14:06:44.066Z\",\"system_name\":\"Wirashoda\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002048,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-27T11:14:57.970Z\",\"system_name\":\"Bei\",\"system_security\":\"0.6\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003090,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-26T23:04:35.948Z\",\"system_name\":\"Saidusairos\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003478,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-26T00:06:02.331Z\",\"system_name\":\"Basan\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004289,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-25T11:33:32.949Z\",\"system_name\":\"Vaini\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30045345,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-24T21:16:26.292Z\",\"system_name\":\"Hirri\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30001358,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-24T08:44:18.165Z\",\"system_name\":\"Ossa\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003061,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-24T07:23:55.183Z\",\"system_name\":\"Mormelot\",\"system_security\":\"0.2\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30040141,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-08-23T11:05:21.929Z\",\"system_name\":\"Urhinichi\",\"system_security\":\"0.8\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003078,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-22T18:47:39.976Z\",\"system_name\":\"Erkinen\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002530,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-22T15:09:00.523Z\",\"system_name\":\"Avesber\",\"system_security\":\"0.8\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003900,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-22T07:50:34.044Z\",\"system_name\":\"Ham\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002644,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-21T08:26:40.788Z\",\"system_name\":\"Ambeke\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001401,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-21T00:44:17.584Z\",\"system_name\":\"Nonni\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30045328,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.7\",\"updated_at\":\"2020-08-20T14:35:34.268Z\",\"system_name\":\"Ahtila\",\"system_security\":\"0.6\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003480,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-20T11:19:04.711Z\",\"system_name\":\"Amod\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004141,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-20T01:50:23.539Z\",\"system_name\":\"Hiremir\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002770,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.1\",\"updated_at\":\"2020-08-18T14:53:00.972Z\",\"system_name\":\"Tunudan\",\"system_security\":\"0.4\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003504,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.7\",\"updated_at\":\"2020-08-18T14:46:27.787Z\",\"system_name\":\"Niarja\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002253,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-18T09:31:28.183Z\",\"system_name\":\"Arshat\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002737,\"status\":\"final_liminality\",\"derived_security_status\":\"0.0\",\"updated_at\":\"2020-08-16T21:29:53.121Z\",\"system_name\":\"Konola\",\"system_security\":\"0.7\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003398,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-16T17:38:55.577Z\",\"system_name\":\"Anbald\",\"system_security\":\"0.7\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003490,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-15T20:27:08.919Z\",\"system_name\":\"Khopa\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001696,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-14T06:57:31.468Z\",\"system_name\":\"Iro\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000192,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.3\",\"updated_at\":\"2020-08-14T01:51:38.839Z\",\"system_name\":\"Otanuomi\",\"system_security\":\"0.4\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002772,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-13T11:24:31.714Z\",\"system_name\":\"Rairomon\",\"system_security\":\"0.6\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30005284,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-13T11:24:24.229Z\",\"system_name\":\"Promised Land\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30045354,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-13T07:37:02.262Z\",\"system_name\":\"Reitsato\",\"system_security\":\"0.2\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30005222,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-12T17:58:16.210Z\",\"system_name\":\"Serren\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003556,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-10T23:13:52.643Z\",\"system_name\":\"Arton\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005086,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-10T06:50:08.222Z\",\"system_name\":\"Arza\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000157,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.3\",\"updated_at\":\"2020-08-10T06:49:46.743Z\",\"system_name\":\"Otela\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003918,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-09T15:49:15.024Z\",\"system_name\":\"Hakana\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002385,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-09T00:34:34.831Z\",\"system_name\":\"Teonusude\",\"system_security\":\"0.6\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30002704,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-07T22:29:26.455Z\",\"system_name\":\"Adrallezoen\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001372,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.9\",\"updated_at\":\"2020-08-07T19:29:54.183Z\",\"system_name\":\"Kino\",\"system_security\":\"0.7\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003908,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-07T07:00:48.775Z\",\"system_name\":\"Bashyam\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000012,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-06T09:30:28.248Z\",\"system_name\":\"Asabona\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005058,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-05T21:45:44.898Z\",\"system_name\":\"Neesher\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004305,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-05T21:24:35.293Z\",\"system_name\":\"Esaeel\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003883,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-05T20:44:57.150Z\",\"system_name\":\"Keberz\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003481,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-05T07:41:10.729Z\",\"system_name\":\"Unefsih\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003397,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-04T16:45:17.206Z\",\"system_name\":\"Bongveber\",\"system_security\":\"0.9\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30002702,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-08-04T11:15:48.842Z\",\"system_name\":\"Archee\",\"system_security\":\"0.4\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003460,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-03T22:03:14.542Z\",\"system_name\":\"Offikatlin\",\"system_security\":\"0.4\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30004084,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-02T17:58:04.736Z\",\"system_name\":\"Ghesis\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003574,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-01T20:28:35.755Z\",\"system_name\":\"Boystin\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30005213,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-01T20:20:33.816Z\",\"system_name\":\"Hesarid\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005308,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-08-01T10:42:51.414Z\",\"system_name\":\"Jufvitte\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002665,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-01T02:12:09.248Z\",\"system_name\":\"Misneden\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30000188,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-08-01T02:11:39.811Z\",\"system_name\":\"Hentogaira\",\"system_security\":\"0.6\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002557,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-31T18:00:06.264Z\",\"system_name\":\"Atgur\",\"system_security\":\"0.5\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003058,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-29T09:14:47.194Z\",\"system_name\":\"Olide\",\"system_security\":\"0.7\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30005334,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-28T23:28:39.525Z\",\"system_name\":\"Tierijev\",\"system_security\":\"0.8\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003046,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.5\",\"updated_at\":\"2020-07-28T14:20:51.847Z\",\"system_name\":\"Angymonne\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003514,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-07-27T18:47:08.094Z\",\"system_name\":\"Yeeramoun\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002760,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-26T11:44:38.056Z\",\"system_name\":\"Manjonakko\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002506,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-23T18:07:27.688Z\",\"system_name\":\"Osoggur\",\"system_security\":\"0.5\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30005052,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-07-21T17:37:44.002Z\",\"system_name\":\"Soumi\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003931,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-20T16:54:45.398Z\",\"system_name\":\"Sassecho\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005255,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-20T09:34:48.342Z\",\"system_name\":\"Saphthar\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30020141,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.9\",\"updated_at\":\"2020-07-19T11:16:57.684Z\",\"system_name\":\"Senda\",\"system_security\":\"0.9\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002795,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-18T01:59:01.724Z\",\"system_name\":\"Oshaima\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30000004,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-07-17T22:26:00.294Z\",\"system_name\":\"Jark\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004263,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-15T21:20:01.593Z\",\"system_name\":\"Feshur\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000062,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-15T15:49:03.146Z\",\"system_name\":\"Iosantin\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002241,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-13T01:22:41.989Z\",\"system_name\":\"Rimbah\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004981,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-12T11:24:07.265Z\",\"system_name\":\"Actee\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002242,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-07-10T19:06:05.853Z\",\"system_name\":\"Mamenkhanar\",\"system_security\":\"0.7\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003558,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-10T13:51:31.889Z\",\"system_name\":\"Madimal\",\"system_security\":\"0.7\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001376,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-09T16:04:24.621Z\",\"system_name\":\"Nourvukaiken\",\"system_security\":\"0.8\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30045329,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.4\",\"updated_at\":\"2020-07-08T10:41:47.622Z\",\"system_name\":\"Ichoriya\",\"system_security\":\"0.6\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30005252,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-07-07T23:49:41.522Z\",\"system_name\":\"Anzalaisio\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004257,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-07T17:15:51.416Z\",\"system_name\":\"Hakatiz\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004108,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-05T01:56:57.535Z\",\"system_name\":\"Chaneya\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000048,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-03T15:11:36.506Z\",\"system_name\":\"Ihal\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003482,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-02T20:56:41.226Z\",\"system_name\":\"Mista\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002225,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.8\",\"updated_at\":\"2020-07-01T14:11:27.451Z\",\"system_name\":\"Harva\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005263,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-01T13:43:12.530Z\",\"system_name\":\"Mozzidit\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005066,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-07-01T06:43:25.457Z\",\"system_name\":\"Kerying\",\"system_security\":\"0.2\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002986,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-28T17:43:41.096Z\",\"system_name\":\"Mendori\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001381,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.1\",\"updated_at\":\"2020-06-27T00:02:01.315Z\",\"system_name\":\"Arvasaras\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30001447,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-25T02:19:25.407Z\",\"system_name\":\"Taisy\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002700,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-24T13:40:05.882Z\",\"system_name\":\"Bawilan\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001390,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-24T09:42:32.895Z\",\"system_name\":\"Pakkonen\",\"system_security\":\"0.4\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003076,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-23T09:02:12.462Z\",\"system_name\":\"Gammel\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003050,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-23T06:32:08.087Z\",\"system_name\":\"Odixie\",\"system_security\":\"0.6\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30000163,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-22T19:28:52.910Z\",\"system_name\":\"Akora\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003073,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-21T07:12:31.404Z\",\"system_name\":\"Netsalakka\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001391,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-20T21:12:20.299Z\",\"system_name\":\"Piekura\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30002771,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-20T00:41:47.611Z\",\"system_name\":\"Kulelen\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30000005,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-19T14:36:55.956Z\",\"system_name\":\"Sasta\",\"system_security\":\"0.8\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005330,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-19T13:21:23.145Z\",\"system_name\":\"Arraron\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30000205,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-18T22:06:13.302Z\",\"system_name\":\"Obe\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003856,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-18T12:10:11.496Z\",\"system_name\":\"Athounon\",\"system_security\":\"0.1\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30004250,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-17T11:42:53.830Z\",\"system_name\":\"Chibi\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004268,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-17T08:56:42.286Z\",\"system_name\":\"Shenda\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005236,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-17T07:25:26.811Z\",\"system_name\":\"Noranim\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003829,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-16T22:17:39.177Z\",\"system_name\":\"Renarelle\",\"system_security\":\"0.3\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30005034,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-16T21:32:34.651Z\",\"system_name\":\"Bridi\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003074,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-16T21:31:28.344Z\",\"system_name\":\"Sasiekko\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003392,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-15T19:26:39.709Z\",\"system_name\":\"Eygfe\",\"system_security\":\"0.7\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30001445,\"status\":\"final_liminality\",\"derived_security_status\":\"0.0\",\"updated_at\":\"2020-06-15T03:38:02.163Z\",\"system_name\":\"Nalvula\",\"system_security\":\"0.4\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30010141,\"status\":\"final_liminality\",\"derived_security_status\":\"-0.2\",\"updated_at\":\"2020-06-14T01:12:53.428Z\",\"system_name\":\"Sakenta\",\"system_security\":\"1.0\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003809,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-13T20:25:21.879Z\",\"system_name\":\"Brellystier\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001718,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-13T05:28:45.485Z\",\"system_name\":\"Paye\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004256,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-11T13:37:54.195Z\",\"system_name\":\"Edilkam\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002645,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-11T00:28:57.560Z\",\"system_name\":\"Carrou\",\"system_security\":\"0.4\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30045338,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-10T22:28:25.084Z\",\"system_name\":\"Hikkoken\",\"system_security\":\"0.3\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30004301,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-10T16:44:37.396Z\",\"system_name\":\"Anath\",\"system_security\":\"0.1\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002575,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-10T05:41:23.824Z\",\"system_name\":\"Sotrenzur\",\"system_security\":\"0.3\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30003515,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-08T06:49:36.637Z\",\"system_name\":\"Anila\",\"system_security\":\"0.7\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004100,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-08T03:04:19.196Z\",\"system_name\":\"Halibai\",\"system_security\":\"0.7\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002397,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-08T01:10:38.296Z\",\"system_name\":\"Horaka\",\"system_security\":\"0.6\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30002662,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-07T11:22:11.884Z\",\"system_name\":\"Pulin\",\"system_security\":\"0.5\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30001383,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-07T06:16:44.145Z\",\"system_name\":\"Vaajaita\",\"system_security\":\"0.5\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003854,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T19:17:57.398Z\",\"system_name\":\"Alamel\",\"system_security\":\"0.2\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30003464,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T19:16:59.888Z\",\"system_name\":\"Aldik\",\"system_security\":\"0.7\",\"system_sovereignty\":\"minmatar\"},{\"system_id\":30000182,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T19:04:22.126Z\",\"system_name\":\"Inaya\",\"system_security\":\"0.6\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30001660,\"status\":\"edencom_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T17:38:27.602Z\",\"system_name\":\"Dabrid\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30001685,\"status\":\"triglavian_minor_victory\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T17:34:50.620Z\",\"system_name\":\"Ordat\",\"system_security\":\"0.3\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005029,\"status\":\"final_liminality\",\"derived_security_status\":\"-1.0\",\"updated_at\":\"2020-06-06T15:44:51.914Z\",\"system_name\":\"Vale\",\"system_security\":\"0.7\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30045322,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-06T01:44:55.204Z\",\"system_name\":\"Samanuni\",\"system_security\":\"0.7\",\"system_sovereignty\":\"caldari\"},{\"system_id\":30003885,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-05T17:09:39.066Z\",\"system_name\":\"Arzanni\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004248,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-05T00:49:40.255Z\",\"system_name\":\"Haimeh\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003495,\"status\":\"final_liminality\",\"derived_security_status\":\"-1.0\",\"updated_at\":\"2020-06-04T23:08:13.644Z\",\"system_name\":\"Raravoss\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003541,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T16:55:17.838Z\",\"system_name\":\"Faswiba\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002651,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T15:38:07.592Z\",\"system_name\":\"Fasse\",\"system_security\":\"0.4\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30004150,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Shaggoth\",\"system_security\":\"0.7\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30002251,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Sadye\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30005260,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Keri\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30000105,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Abha\",\"system_security\":\"0.4\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30004992,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Palmon\",\"system_security\":\"0.4\",\"system_sovereignty\":\"gallente\"},{\"system_id\":30002243,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Seiradih\",\"system_security\":\"0.6\",\"system_sovereignty\":\"amarr\"},{\"system_id\":30003553,\"status\":\"fortress\",\"derived_security_status\":null,\"updated_at\":\"2020-06-03T04:02:40.650Z\",\"system_name\":\"Warouh\",\"system_security\":\"0.5\",\"system_sovereignty\":\"amarr\"}];\r\n\t\r\n\tthis.invasions = _.keyBy(data, function(x) { return x.system_id; });\r\n\t\r\n\t/** Update the system */\r\n\tthis.mutate = function(system, systemID) {\r\n\t\tconst systemInvasion = this.invasions[systemID];\r\n\t\tif(systemInvasion) {\r\n\t\t\tif(systemInvasion.derived_security_status) { system.security = 1 * systemInvasion.derived_security_status; }\r\n\t\t\tsystem.pathSymbol = pathSymbolMap[systemInvasion.status];\r\n\t\t\tconst tip = textMap[systemInvasion.status] +\r\n\t\t\t\t(systemInvasion.derived_security_status ? '<br>Effective security lowered to ' + systemInvasion.derived_security_status : '');\r\n\t\t\tsystem.systemTypeModifiers.push('<span class=\"invasion ' + systemInvasion.status + '\" data-tooltip=\"' + tip + '\">' + system.pathSymbol + '</span>');\r\n\t\t}\r\n\t}\r\n}","var guidance = (function (undefined) {\r\n\t\r\n\r\n\tvar sorter = function (a, b) {\r\n\t\treturn parseFloat (a) - parseFloat (b);\r\n\t}\r\n\r\n\tfunction adjustCostForOptions(mapCost, toSystem) {\t\t\r\n\t\tvar system = systemAnalysis.analyse(30000000 + 1 * toSystem);\r\n\t\tif(!system) { return mapCost; }\r\n\t\tif(options.chain.routeIgnore.enabled && options.chain.routeIgnore.systems.indexOf(system.name) >= 0) {\r\n\t\t\tmapCost += 100;\t// Penalty for an avoided system\r\n\t\t}\r\n\t\tswitch(options.chain.routeSecurity) {\r\n\t\t\tcase 'highsec': return mapCost + (system.security < 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-high': return mapCost + (system.security >= 0.45 ? 100 : 0);\r\n\t\t\tcase 'avoid-null': return mapCost + (system.security <= 0.0 ? 100 : 0);\r\n\t\t\tdefault: return mapCost;\t// in case of some invalid option, default to shortest\r\n\t\t}\t\r\n\t}\r\n\t\r\n\tfunction adjustJumpCost(from, to, cost) {\r\n\t\treturn Guidance.jumpCostModifiers.reduce((cost, modifier) => modifier(from, to, cost), cost);\r\n\t}\r\n\r\n\t/** Find a path between the start and end nodes (which may be arrays), up to the path length limit */\r\n\tvar findPaths = function (map, start, end, limit) {\r\n\t\tif(!Array.isArray(start)) { start = [start]; } \r\n\t\tif(!Array.isArray(end)) { end = [end]; } \r\n\t\t\r\n\t\tstart = start.filter(function(x) { return map[x]; });\r\n\t\tend = end.filter(function(x) { return map[x]; });\r\n\t\t\r\n\t\tconst endsInStart = end.filter(function(x) { return start.indexOf(x) >= 0; });\r\n\t\tif(endsInStart.length) { return [endsInStart[0]]; }\r\n\t\t\r\n\t\tif(!(start.length && end.length)) { return null; }\t// both ends of path must be in network somewhere\r\n\r\n\t\tvar costs = {},\r\n\t\t    open = {'0': []},\r\n\t\t    predecessors = {},\r\n\t\t    keys;\r\n\t\t\r\n\t\tstart.forEach(function(x) { costs[x] = 0; open[0].push(x); });\r\n\r\n\t\tvar addToOpen = function (cost, vertex) {\r\n\t\t\tvar key = \"\" + cost;\r\n\t\t\tif (!open[key]) open[key] = [];\r\n\t\t\topen[key].push(vertex);\r\n\t\t}\r\n\r\n\t\twhile ((keys = Object.keys(open)).length) {\r\n\t\t\tkeys.sort(sorter);\r\n\r\n\t\t\tvar key = keys[0],\r\n\t\t\t    bucket = open[key],\r\n\t\t\t    node = bucket.shift(),\r\n\t\t\t    currentCost = parseFloat(key),\r\n\t\t\t    adjacentNodes = map[node] || {};\r\n\r\n\t\t\tif (!bucket.length) delete open[key];\r\n\t\t\tif(currentCost >= limit) { break; }\r\n\r\n\t\t\tfor (var vertexText in adjacentNodes) {\r\n\t\t\t\tconst vertex = 1 * vertexText;\r\n\t\t\t    if (adjacentNodes[vertex] !== undefined) {\r\n\t\t\t\t\tvar cost = 1 + adjustCostForOptions(adjacentNodes[vertex], vertex),\r\n\t\t\t\t\t    totalCost = cost + currentCost,\r\n\t\t\t\t\t    vertexCost = costs[vertex];\r\n\t\t\t\t\t\r\n\t\t\t\t\tcost = adjustJumpCost(node, vertex, cost);\r\n\r\n\t\t\t\t\tif ((cost > 0) && (vertexCost === undefined) || (vertexCost > totalCost)) {\r\n\t\t\t\t\t\tcosts[vertex] = totalCost;\r\n\t\t\t\t\t\taddToOpen(totalCost, vertex);\r\n\t\t\t\t\t\tpredecessors[vertex] = node;\r\n\t\t\t\t\t\tif(end.indexOf(vertex) >= 0) {\r\n\t\t\t\t\t\t\treturn extractShortest(predecessors, vertex);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\t// never hit any end node\r\n\t}\r\n\r\n\tvar extractShortest = function (predecessors, end) {\r\n\t\tvar nodes = [],\r\n\t\t    u = end;\r\n\r\n\t\twhile (u) {\r\n\t\t\tnodes.push(u);\r\n\t\t\tpredecessor = predecessors[u];\r\n\t\t\tu = predecessors[u];\r\n\t\t}\r\n\r\n\t\tnodes.reverse();\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\t/** Find the best path that connects the given nodes, in that order. The limit will be applied to each path segment, not the path as a whole. */\r\n\tvar findMultiNodePath = function (map, nodes, limit) {\r\n\t\tvar start = nodes.shift(),\r\n\t\t    end,\r\n\t\t    predecessors,\r\n\t\t    path = [],\r\n\t\t    shortest;\r\n\r\n\t\twhile (nodes.length) {\r\n\t\t\tend = nodes.shift();\r\n\t\t\tshortest = findPaths(map, start, end, limit);\r\n\r\n\t\t\tif (shortest) {\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tpath.push.apply(path, shortest.slice(0, -1));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn path.concat(shortest);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n\t\r\n\tvar Guidance = { kSpaceCache: {}, jumpCostModifiers: [] };\r\n\tGuidance.clearCache = function() { Guidance.kSpaceCache = {}; }\r\n\t\r\n\t/** Find the shortest path between start and end nodes on the given map.\r\n\tThe map should be a dictionary of node IDs where each entry is a dictionary of connected nodes and costs (see appData.map.shortest). An additional cost of 1 per jump will be added.\r\n\tYou may also specify a maximum path length limit, if no path under this length is found then no path will be returned, even if a longer one is available.\r\n\tStart and end nodes may be a single ID or an array of IDs. If arrays are used then a single shortest path between any combination of nodes will be returned */\r\n\tGuidance.findShortestPath = function (map, start, end, limit) {\r\n\t\tif(start > 30000000) { start -= 30000000; }\r\n\t\tif(end > 30000000) { end -= 30000000; }\r\n\t\t\r\n\t\tconst nodes = [start, end];\r\n\r\n\t\tconst cacheKey = nodes.join(',') + (limit ? '-' + limit : '');\r\n\t\tconst cachedPath = Guidance.kSpaceCache[cacheKey];\r\n\t\tif(cachedPath === undefined) {\r\n\t\t\treturn Guidance.kSpaceCache[cacheKey] = findPaths(map, start, end, limit);\r\n\t\t} else {\r\n\t\t\treturn cachedPath;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** Find the systems directly connected to this one. System IDs are in normal (+ 30000000) domain. */\r\n\tGuidance.connections = function(map, start) {\r\n\t\tif(start > 30000000) { start -= 30000000; }\r\n\t\treturn Object.keys(map[start] || {})\r\n\t\t\t.map(k => (k * 1))\r\n\t\t\t.map(k => {\r\n\t\t\t\tconst r = { systemID: k + 30000000 };\r\n\t\t\t\tif(0 > adjustJumpCost(start, k, 1)) { r.closed = true; }\r\n\t\t\t\treturn r;\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn Guidance;\r\n})();\r\n","/** Functions for rendering things relating to systems or parts of the chain */\r\nconst systemRendering = new function() { \r\n\t/** Render a path, as returned from guidance.findShortestPath */\r\n\tthis.renderPath = function(path) {\r\n\t\tif(path.length <= 1 || path.length > options.chain.routingLimit) { return '' + path.length - 1; }\r\n\t\telse {\r\n\t\t\tvar systemMarkup = path\r\n\t\t\t.slice(0, path.length - 1).reverse()\r\n\t\t\t.map(function(s) {\r\n\t\t\t\tconst systemID = 30000000 + 1 * s;\r\n\t\t\t\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\t\tconst securityClass = system.systemTypeClass;\r\n\t\t\t\treturn '<span class=\"' + securityClass + '\" data-tooltip=\"' + system.name + ' (' + system.security + ')\" onclick=\"tripwire.systemChange(' + systemID + ')\">' + system.pathSymbol + '</span>';\r\n\t\t\t});\r\n\t\t\tvar r = '<span class=\"path\">';\r\n\t\t\tfor(var i = 0; i < systemMarkup.length; i++) {\r\n\t\t\t\tif(i > 0 && 0 == i % 5) { r += '|'; }\r\n\t\t\t\t\r\n\t\t\t\tr += systemMarkup[i];\t\t\t\t \r\n\t\t\t}\r\n\t\t\treturn r + '</span>';\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.renderEffect = function(system, tag) {\r\n\t\treturn system.effectClass ? \"<\" + tag + \" class='whEffect' data-icon='\"+system.effectClass+\"' data-tooltip='\"+system.effect+\"'></\" + tag + \">\" : '';\r\n\t}\r\n\t\r\n\tthis.renderSystem = function(systemInfo, tag) {\r\n\t\ttag = tag || 'a';\r\n\t\tconst text = systemInfo.name || systemInfo.genericSystemType;\r\n\t\treturn '<' + tag + (tag === 'a' ? ' href=\".?system=' + systemInfo.name + '\"' : '') + '>' + text + '</' + tag + '> (' + this.renderEffect(systemInfo, 'span') + '<span class=\"' + systemInfo.systemTypeClass + '\">' + systemInfo.systemTypeName + '</span>)';\r\n\t}\r\n};","const ChainMapRendererBase = function(owner) {\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tif(!document.getElementById('map-container')) {\r\n\t\t\tconst newDiv = document.createElement('div');\r\n\t\t\tnewDiv.id = 'map-container';\r\n\t\t\tnewDiv.className = 'radial-map';\r\n\t\t\tdocument.getElementById('chainMap').appendChild(newDiv);\r\n\t\t}\r\n\t\tthis.container = document.getElementById('map-container');\r\n\t\tthis.container.style.display = '';\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tconst div = document.getElementById('map-container');\r\n\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\tthis.container = null;\r\n\t}\r\n\t\r\n\tthis.collapse = function(systemID, collapse) {\r\n\t\tif(collapse) { this.mapData.collapsed.push(systemID); }\r\n\t\telse {  this.mapData.collapsed = this.mapData.collapsed.filter(x => x != systemID); }\r\n\t\towner.updateCollapsed(this.mapData.collapsed);\r\n\t\tdrawInner(this.mapData.map, this.mapData.lines, this.mapData.collapsed);\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.mapData = {map: map, lines: lines, collapsed: collapsed};\r\n\t\t\r\n\t\t// Clear the map for a new one\r\n\t\t//this.switchFrom(); this.switchTo();\r\n\r\n\t\ttry { drawInner(map, lines, collapsed); }\r\n\t\tfinally { this.drawing = false; }\r\n\t}\r\n\t\r\n\t/** Get the factor by which the 'arc' (or coverage if linear) for the current level reduces.\r\n\tE.g. for a circle, the 3rd ring is 3/4 the size of the 4th so arcFactor(3) should return 3/4.\r\n\tBy default, all levels are the same 'size' */\r\n\tthis.arcFactor = function(level) { return 1; }\r\n\r\n\tconst _this = this;\r\n\tconst drawInner = function(map, lines, collapsed) {\r\n\t\tconst maps = [];\r\n\t\tconst nodesById = {};\r\n\t\t\r\n\t\t// First pass: arrange nodes into rings\r\n\t\tfor(var ri = 0; ri < map.rows.length; ri++) {\r\n\t\t\tconst item = map.rows[ri];\r\n\t\t\tconst inNode = item.c[0], id = inNode.v, parent = item.c[1].v;\r\n\t\t\t\r\n\t\t\tconst mapNode = { id: id, children: [], systemID: inNode.systemID, minArc: 0 };\r\n\t\t\t\r\n\t\t\tif(parent == null) {\r\n\t\t\t\tconst newMap =  { circles: [ { arc: 0, nodes: [ mapNode ] } ] };\r\n\t\t\t\tmapNode.map = newMap;\r\n\t\t\t\tmapNode.circle = 0;\r\n\t\t\t\tmaps.push(newMap);\r\n\t\t\t} else {\r\n\t\t\t\tconst parentNode = nodesById[parent];\r\n\t\t\t\tif(!parentNode) { throw 'Parent id ' + parent + ' not on map yet'; }\r\n\t\t\t\tparentNode.children.push(mapNode);\r\n\t\t\t\tmapNode.parent = parentNode;\r\n\t\t\t\tmapNode.connection = lines.filter(function(l) { return l[0] == id; })[0] || [id, parent, [], '?'];\r\n\t\t\t\tmapNode.styles = ['connection'].concat(mapNode.connection[2]);\r\n\t\t\t\tmapNode.map = parentNode.map;\r\n\t\t\t\tmapNode.circle = parentNode.circle + 1;\r\n\t\t\t\tif(mapNode.map.circles.length <= mapNode.circle) {\r\n\t\t\t\t\tmapNode.map.circles.push({ arc: 0, nodes:[mapNode] });\r\n\t\t\t\t} else { mapNode.map.circles[mapNode.circle].nodes.push(mapNode); }\r\n\t\t\t}\r\n\t\t\tnodesById[id] = mapNode;\r\n\t\t\tmapNode.markup = inNode.f;\r\n\t\t}\r\n\r\n\t\t// Second pass - for each map, find the allocation of arc needed for each node\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tfor(var ci = map.circles.length - 1; ci >= 1; ci--) {\t// don't need to calculate ring 0\r\n\t\t\t\tfor(var ni = 0; ni < map.circles[ci].nodes.length; ni++) {\r\n\t\t\t\t\tconst node = map.circles[ci].nodes[ni];\r\n\t\t\t\t\tnode.minArc *= _this.arcFactor(ci);\r\n\t\t\t\t\tif(node.minArc < 1 || collapsed.indexOf(node.systemID * 1) >= 0) { node.minArc = 1; }\r\n\t\t\t\t\tnode.parent.minArc += node.minArc;\r\n\t\t\t\t\tmap.circles[ci].arc += node.minArc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Third pass - lay out each ring based on the arc values\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\tvar mapDiv = document.getElementById(\"map\" + mi);\r\n\t\t\tif(!mapDiv) {\r\n\t\t\t\tmapDiv = document.createElement('div');\r\n\t\t\t\tmapDiv.id = \"map\" + mi;\r\n\t\t\t\tmapDiv.className = \"map-chain-wrapper\";\r\n\t\t\t}\r\n\t\t\tmapDiv.innerHTML = '<div class=\"map-outer-container\"><div class=\"map-inner-container\"><canvas class=\"map-drawing\" id=\"map-canvas-' + mi + '\"/></div></div>';\r\n\t\t\tconst innerContainer = mapDiv.firstChild.firstChild;\r\n\t\t\tdocument.getElementById('map-container').appendChild(mapDiv);\r\n\r\n\t\t\tconst range = _this.initialRads(map.circles[0].nodes[0].minArc);\r\n\t\t\tmap.bounds = makeDivsForRing(innerContainer, 0, map.circles[0].nodes, -range, range, collapsed);\r\n\t\t\tmap.radRange = { min: -range, max: range };\r\n\t\t\tmap.domNode = mapDiv;\r\n\t\t\tmap.innerContainer = innerContainer;\r\n\t\t}\r\n\r\n\t\t// Fourth pass: update div and canvas bounds, and draw rings/links\r\n\t\tconst CANVAS_SCALE = 1;\r\n\t\tfor(var mi = 0; mi < maps.length; mi++) {\r\n\t\t\tconst map = maps[mi];\r\n\t\t\t// Reset the width overrides so previous expansions aren't persisted if not needed any more\r\n\t\t\tmap.domNode.style.width = null;\r\n\t\t\tmap.domNode.style.height = null;\r\n\t\t\tconst finalPositions = {\r\n\t\t\t\tw: 200 + map.bounds.x[1] - map.bounds.x[0],\r\n\t\t\t\th: 100 + map.bounds.y[1] - map.bounds.y[0],\r\n\t\t\t\tcx: 100 - map.bounds.x[0],\r\n\t\t\t\tcy: 50 - map.bounds.y[0]\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Fill the space available, if we didn't already\r\n\t\t\tconst centringOptions = _this.centringOptions;\r\n\t\t\tif(centringOptions.x && maps.length == 1) {\t// only centre in X if it's the only map, otherwise let them flow\t\r\n\t\t\t\tconst parentWidth = -38 + _this.container.offsetWidth;\t// 20px for map margins, 18 for scrollbar\r\n\t\t\t\tif(finalPositions.w < parentWidth) {\r\n\t\t\t\t\tfinalPositions.cx += 0.5 * (parentWidth - finalPositions.w);\r\n\t\t\t\t\tfinalPositions.w = parentWidth;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\tif(centringOptions.y) {\r\n\t\t\t\tconst parentHeight = document.getElementById('chainParent').offsetHeight;\r\n\t\t\t\tif(finalPositions.h < parentHeight) {\r\n\t\t\t\t\tfinalPositions.cy += 0.5 * (parentHeight - finalPositions.h);\r\n\t\t\t\t\tfinalPositions.h = parentHeight;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// If there's enough space to centre the top level node now, do it\r\n\t\t\tif(centringOptions.y && centringOptions.rootNode && finalPositions.h >= 2 * (map.bounds.y[1] > -map.bounds.y[0] ? map.bounds.y[1] : -map.bounds.y[0])) {\r\n\t\t\t\tfinalPositions.cy = finalPositions.h / 2;\r\n\t\t\t}\r\n\t\t\tif(centringOptions.x && centringOptions.rootNode && finalPositions.w >= 2 * (map.bounds.x[1] > -map.bounds.x[0] ? map.bounds.x[1] : -map.bounds.x[0])) {\r\n\t\t\t\tfinalPositions.cx = finalPositions.w / 2;\r\n\t\t\t}\t\t\t\r\n\t\t\tmap.domNode.style.width = finalPositions.w + 'px';\r\n\t\t\tmap.domNode.style.height = finalPositions.h + 'px';\r\n\t\t\tconst outerContainer = map.domNode.firstChild;\r\n\t\t\touterContainer.style.left = finalPositions.cx + 'px';\r\n\t\t\touterContainer.style.top = finalPositions.cy + 'px';\r\n\t\t\tconst canvas = outerContainer.getElementsByTagName('canvas')[0];\r\n\t\t\tcanvas.width = CANVAS_SCALE * finalPositions.w;\r\n\t\t\tcanvas.style.width = finalPositions.w + 'px';\r\n\t\t\tcanvas.height = CANVAS_SCALE * finalPositions.h;\r\n\t\t\tcanvas.style.height = finalPositions.h + 'px';\r\n\t\t\tcanvas.style.left = -finalPositions.cx + 'px';\r\n\t\t\tcanvas.style.top = -finalPositions.cy + 'px';\r\n\t\t\tconst ctx = canvas.getContext('2d');\r\n\t\t\tctx.scale(CANVAS_SCALE, CANVAS_SCALE);\r\n\t\t\tctx.translate(finalPositions.cx, finalPositions.cy);\r\n\t\t\t\r\n\t\t\tfor(var ci = map.bounds.maxCi; ci >= 1; ci--) {\t// don't need to draw ring 0\r\n\t\t\t\tif(options.chain.gridlines) {\r\n\t\t\t\t\t_this.drawGridlines(ctx, ci, map.radRange);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst lineWeightFactor = options.chain.lineWeight || 1.0;\r\n\t\t\tfor(var ci = map.bounds.maxCi; ci >= 1; ci--) {\r\n\t\t\t\tif(ci >= map.circles.length) { continue; }\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tif(options.chain.aura) { // draw aura first\r\n\t\t\t\t\tdrawConnections(ctx, map.circles[ci].nodes, function(node) {\r\n\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\tctx.lineWidth = lineWeightFactor;\r\n\t\t\t\t\t\tconst auraColor = propertyFromCssClass(node.styles, 'color');\r\n\t\t\t\t\t\tctx.shadowBlur = 11 * lineWeightFactor;\r\n\t\t\t\t\t\tctx.shadowColor = auraColor;\r\n\t\t\t\t\t\tctx.strokeStyle = 'black';\r\n\t\t\t\t\t\tfor(let ai = 0; ai < 8; ai++)\r\n\t\t\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t\tctx.restore();\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdrawConnections(ctx, map.circles[ci].nodes, function(node) {\t\t\r\n\t\t\t\t\tctx.lineWidth = lineWeightFactor * parseInt(propertyFromCssClass(node.styles, 'border-width')) || 2;\r\n\t\t\t\t\tctx.strokeStyle = propertyFromCssClass(node.styles, 'border-top-color');\r\n\t\t\t\t\tctx.setLineDash ({ dashed: [5, 3] }[propertyFromCssClass(node.styles, 'border-top-style')] || []);\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t});\t\t\t\t\t\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\t\r\n\t\t}\r\n\t\t\r\n\t\t// Remove any maps which aren't in use any more\r\n\t\tfor(var mi = maps.length; ; mi++) {\r\n\t\t\tconst div = document.getElementById('map' + mi);\r\n\t\t\tif(div) { div.parentNode.removeChild(div); }\r\n\t\t\telse { break; }\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction drawConnections(ctx, nodes, drawFunction) {\r\n\t\tfor(var ni = 0; ni < nodes.length; ni++) {\r\n\t\t\tconst node = nodes[ni];\r\n\t\t\tif(!node.position) { continue; }\t// not drawn on map\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(node.position.x, node.position.y);\r\n\t\t\t_this.drawConnection(ctx, node);\r\n\t\t\tdrawFunction(node);\r\n\t\t}\t\t\r\n\t}\r\n\t\r\n\t/** The coordinate space for the full range. May be based on the total requested arc */\r\n\tthis.initialRads = function(minArc) { return Math.PI; }\r\n\t\r\n\t/** How many levels to skip to allow more space for the nodes. Only makes sense if each level is \"wider\" than the previous so it will have more space. */\r\n\tthis.skipLevels = function(ci, nodes, minRad, maxRad, parentCollapsed) { return 0; }\r\n\t\r\n\t/** Set the position of this node based on its level and radial position within the level\r\n\tA \"position\" property with x and y must be set. Other values used in drawConnection may also be set */\r\n\tthis.setPosition = function(node, ci, rad_centre) { throw 'must define setPosition'; }\r\n\t\r\n\t/** Draw the connection from this node to its parent. The current point will be the node's position. By default, draws a line */\r\n\tthis.drawConnection = function(ctx, node) {\r\n\t\tctx.lineTo(node.parent.position.x, node.parent.position.y);\t\t\t\r\n\t}\r\n\r\n\t/** Draw grid lines for this level */\r\n\tthis.drawGridlines = function(ctx, ci, radRange) { }\r\n\t\r\n\tthis.adjustAlignmentDelta = function(ci, rad_centre) { return 0; }\r\n\t\r\n\t/** Override to not centre the map and centre node */\r\n\tthis.centringOptions = { x: true, y: true, root_node: true };\r\n\t\r\n\t/** Add the nodes for this ring/level and all further rings to the container, and return the bounds of the space used by it\r\n\tCalled recursively for chain sub-sections\r\n\t@param ci The index of the current level\r\n\t@param nodes The node data (see chain-map) for nodes within this level\r\n\t@param minRad The minimum radial coordinate for this section of chain\r\n\t@param maxRad The maximum radial coordinate for this section of chain\r\n\t@param collapsed The list of systems which have been collapsed \r\n\t*/\r\n\tfunction makeDivsForRing(innerContainer, ci, nodes, minRad, maxRad, collapsed) {\r\n\t\tconst bounds = { x: [0, 0], y: [0, 0], maxCi: ci };\r\n\t\tif(!nodes.length) { return bounds; }\r\n\t\tconst parentCollapsed = collapsed.indexOf(1 * (nodes[0].parent || {}).systemID) >= 0;\r\n\t\tconst totalArc = parentCollapsed ? nodes.length : nodes.reduce(function(acc, x) { return acc + x.minArc; }, 0);\r\n\t\tconst rads_per_arc = (maxRad - minRad) / totalArc;\r\n\t\tvar rad_offset = minRad;\r\n\t\tfunction getNodeRadialPosition(node) {\r\n\t\t\tconst dr = (parentCollapsed ? 1 : node.minArc) * rads_per_arc,\r\n\t\t\t\trad_centre = rad_offset + (dr / 2);\r\n\t\t\treturn { dr: dr, rad_centre: rad_centre };\r\n\t\t}\r\n\t\tvar alignment_delta = _this.adjustAlignmentDelta(ci, getNodeRadialPosition(nodes[0]).rad_centre);\r\n\t\t\r\n\t\tci += _this.skipLevels(ci, nodes, minRad, maxRad, parentCollapsed);\r\n\r\n\t\t\r\n\t\tfor(var ni = 0; ni < nodes.length; ni++) {\r\n\t\t\tconst node = nodes[ni];\t\r\n\t\t\t\r\n\t\t\t// Make the node\r\n\t\t\tconst frag = document.createRange().createContextualFragment('<div class=\"node-wrapper\">' + node.markup + '</div>');\r\n\t\t\tnode.domNode = frag.firstChild;\r\n\t\t\tinnerContainer.appendChild(node.domNode);\r\n\t\t\tconst systemID = 1 * node.systemID;\r\n\t\t\t$(node.domNode).dblclick(() => _this.collapse(systemID, collapsed.indexOf(systemID) < 0));\r\n\t\t\t\r\n\t\t\t// Position the node\r\n\t\t\tconst nodeRadialPosition = getNodeRadialPosition(node);\r\n\t\t\t\r\n\t\t\t_this.setPosition(node, ci, nodeRadialPosition.rad_centre + alignment_delta);\r\n\t\t\t\r\n\t\t\tif(node.position.x < bounds.x[0]) { bounds.x[0] = node.position.x; }\r\n\t\t\tif(node.position.x > bounds.x[1]) { bounds.x[1] = node.position.x; }\r\n\t\t\tif(node.position.y < bounds.y[0]) { bounds.y[0] = node.position.y; }\r\n\t\t\tif(node.position.y > bounds.y[1]) { bounds.y[1] = node.position.y; }\r\n\t\t\t\r\n\t\t\tnode.domNode.style.left = node.position.x + 'px';\r\n\t\t\tnode.domNode.style.top = node.position.y + 'px';\r\n\t\t\t\r\n\t\t\tif(parentCollapsed) {\r\n\t\t\t\tnode.domNode.style.display = 'none';\r\n\t\t\t} else {\t\t\t\t\r\n\t\t\t\t// Do the segment of the next circle\r\n\t\t\t\tconst excess = (ci > 0 && nodeRadialPosition.dr > node.minArc * ci) ? nodeRadialPosition.dr - node.minArc * ci : 0;\r\n\t\t\t\tif(node.children.length) {\r\n\t\t\t\t\tconst nextBounds = makeDivsForRing(innerContainer, ci + 1, node.children, rad_offset + (0.5 * excess) + alignment_delta, rad_offset - (0.5 * excess) + alignment_delta + nodeRadialPosition.dr, collapsed);\r\n\t\t\t\t\tif(nextBounds.x[0] < bounds.x[0]) { bounds.x[0] = nextBounds.x[0]; }\r\n\t\t\t\t\tif(nextBounds.x[1] > bounds.x[1]) { bounds.x[1] = nextBounds.x[1]; }\r\n\t\t\t\t\tif(nextBounds.y[0] < bounds.y[0]) { bounds.y[0] = nextBounds.y[0]; }\r\n\t\t\t\t\tif(nextBounds.y[1] > bounds.y[1]) { bounds.y[1] = nextBounds.y[1]; }\r\n\t\t\t\t\tif(nextBounds.maxCi > bounds.maxCi) { bounds.maxCi = nextBounds.maxCi; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trad_offset += nodeRadialPosition.dr;\r\n\t\t}\r\n\t\t\r\n\t\treturn bounds;\r\n\t}\r\n};\r\n\r\n/** https://stackoverflow.com/questions/40978050 */\r\nfunction propertyFromCssClass(className, property) {\r\n\tif(Array.isArray(className)) { className = className.join(' '); }\r\n\tvar elem = document.getElementById('temp-div-' + className);\r\n\tif(!elem) {\r\n\t  elem = document.createElement(\"div\");\r\n\t  elem.id = 'temp-div-' + className;\r\n\t  elem.style.cssText = \"position:fixed;left:-100px;top:-100px;width:1px;height:1px;\";\r\n\t  elem.className = className + ' temp';\r\n\t  document.body.appendChild(elem);  // required in some browsers\r\n\t  }\r\n  const prop = getComputedStyle(elem).getPropertyValue(property);\r\n  //document.body.removeChild(tmp);\r\n  return prop;\r\n}\t","const ChainMapRendererOrgchartSide = function(owner) {\r\n\tChainMapRendererBase.apply(this, arguments);\r\n\t\r\n\tconst GRID_SIZE = { x: 70, y: 45 };\r\n\t\r\n\tthis.initialRads = function(minArc) { return minArc * 0.5; }\r\n\tthis.centringOptions = { y: true };\r\n\t\r\n\tfunction project(rad, ci) { return {\r\n\t\tx: ((ci == 0 ? -0.3 : 0) + ci) * GRID_SIZE.x * options.chain.nodeSpacing.x,\t// root is larger so give some extra space\r\n\t\ty: rad * GRID_SIZE.y * options.chain.nodeSpacing.y\t\r\n\t}; }\r\n\t\r\n\tthis.setPosition = function(node, ci, rad_centre) {\r\n\t\tnode.position = project(rad_centre, ci);\r\n\t}\r\n\t\r\n\tthis.drawConnection = function(ctx, node) {\r\n\t\tconst ave_x = 0.5 * (node.position.x + node.parent.position.x);\r\n\t\tconst cp1 = { x: node.parent.position.x, y: node.position.y };\r\n\t\tconst cp2 = { x: node.parent.position.x, y: node.position.y };\r\n\t\t\r\n\t\tctx.bezierCurveTo(cp2.x, cp2.y, cp1.x, cp1.y, node.parent.position.x, node.parent.position.y);\r\n\t}\r\n\t\r\n\tthis.drawGridlines = function(ctx, ci, radRange) {\r\n\t\tctx.beginPath();\r\n\t\tconst start = project(radRange.min, ci), end = project(radRange.max, ci);\r\n\t\tctx.moveTo(start.x, start.y);\r\n\t\tctx.lineTo(end.x, end.y);\r\n\t\t\r\n\t\tctx.strokeStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\tctx.stroke();\t\t\r\n\t\t\r\n\t\tctx.fillStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\tctx.font = '10px Sans-serif';\r\n\t\tctx.fillText(ci, start.x + 5, start.y);\r\n\t}\t\t\r\n};\r\n\r\nChainMapRendererOrgchartSide.prototype = new ChainMapRendererBase();","const ChainMapRendererOrgchartTop = function(owner) {\r\n\tChainMapRendererBase.apply(this, arguments);\r\n\t\r\n\tconst GRID_SIZE = { x: 55, y: 45 };\r\n\t\r\n\tthis.initialRads = function(minArc) { return minArc * 0.5; }\r\n\tthis.centringOptions = { x: true };\r\n\t\r\n\tfunction project(rad, ci) { return {\r\n\t\tx: rad * GRID_SIZE.x * options.chain.nodeSpacing.x,\r\n\t\ty: ((ci == 0 ? -0.3 : 0) + ci) * GRID_SIZE.y * options.chain.nodeSpacing.y\t// root is larger so give some extra space\r\n\t}; }\r\n\t\r\n\tthis.setPosition = function(node, ci, rad_centre) {\r\n\t\tnode.position = project(rad_centre, ci);\r\n\t\tnode.rad_centre = rad_centre;\r\n\t}\r\n\t\r\n\tthis.drawConnection = function(ctx, node) {\r\n\t\tconst endpoint_y = node.parent.position.y; // + 10 * (3 - Math.abs(node.rad_centre - node.parent.rad_centre));\r\n\t\tconst ave_y = 0.5 * (node.position.y + endpoint_y);\r\n\t\tconst cp1 = { x: node.position.x, y: endpoint_y };\r\n\t\tconst cp2 = { x: node.position.x, y: endpoint_y };\r\n\t\t\r\n\t\tctx.bezierCurveTo(cp2.x, cp2.y, cp1.x, cp1.y, node.parent.position.x, endpoint_y);\r\n\t}\r\n\t\r\n\tthis.drawGridlines = function(ctx, ci, radRange) {\r\n\t\tctx.beginPath();\r\n\t\tconst start = project(radRange.min, ci), end = project(radRange.max, ci);\r\n\t\tctx.moveTo(start.x, start.y);\r\n\t\tctx.lineTo(end.x, end.y);\r\n\t\t\r\n\t\tctx.strokeStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\tctx.stroke();\t\t\r\n\t\t\r\n\t\tctx.fillStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\tctx.font = '10px Sans-serif';\r\n\t\tctx.fillText(ci, start.x, start.y + 12);\r\n\t}\t\t\r\n};\r\n\r\nChainMapRendererOrgchartTop.prototype = new ChainMapRendererBase();","const ChainMapRendererOrgchart = function(owner) {\r\n\tconst _this = this;\r\n\t\r\n\t/** Initialiser - callback from chart onload */\r\n\tthis.init = function() {\r\n\t\t_this.map = new google.visualization.OrgChart(document.getElementById(\"chainMap\"));\r\n\t\t_this.options = {allowHtml: true, allowCollapse: true, size: \"medium\", nodeClass: \"node\"};\r\n\r\n\t\tgoogle.visualization.events.addListener(_this.map, \"collapse\", _this.collapseHandler);\r\n\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\r\n\t}\r\n\t\r\n\t/** Is this renderer ready to accept draw calls? */\r\n\tthis.ready = function() { return !this.drawing && !!this.map; }\r\n\t\r\n\t/** Switch to this renderer. The renderer can be in a blank state; draw() will be called after */\r\n\tthis.switchTo = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = '';\r\n\t\tif(!_this.map) { google.charts.setOnLoadCallback(this.init); }\r\n\t}\r\n\t\r\n\t/** Switch away from this renderer. All node divs should be removed from the DOM */\r\n\tthis.switchFrom = function() {\r\n\t\tdocument.getElementById('chainGrid').style.display = 'none';\r\n\t\t_this.map.draw(new google.visualization.DataView(new google.visualization.DataTable({cols:[{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}]})), _this.options);\t\t\r\n\t}\r\n\t\r\n\t/** Redraw the map, based on the given node set, line overrides and list of collapsed systems */\r\n\tthis.draw = function(map, lines, collapsed) {\r\n\t\tthis.drawing = true;\r\n\t\tthis.map.draw(newView(map), this.options); \r\n\t\t\r\n\t\tfor (var x in collapsed) {\r\n\t\t\tconst s = collapsed[x];\r\n\t\t\tconst nodeId = $(\"#chainMap [data-nodeid='\"+s+\"']\").attr(\"id\");\r\n\t\t\tif (nodeId) {\r\n\t\t\t\tconst nodeVal = nodeId.split(\"node\")[1];\r\n\t\t\t\tthis.map.collapse(nodeVal - 1, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tupdateLines(map, lines);\r\n\t\tthis.drawing = false;\r\n\t};\r\n\t\r\n\tconst newView = function(json) {\r\n\t\tconst view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\treturn view;\r\n\t};\r\n\t\r\n\tconst updateLines = function(map, lines) {\r\n\t\t_this.lastLineData = { map: map, lines: lines };\r\n\t\tfunction drawNodeLine(system, parent, mode, signatureID) {\r\n\t\t\t/*\tfunction for drawing colored lines  */\r\n\t\t\tif(typeof mode == 'string') { mode = [mode]; }\r\n\r\n\t\t\tfunction addModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.addClass(c); }); }\r\n\t\t\tfunction removeModes(jquerySelector, prefixes) { return doModeClasses(jquerySelector, prefixes, function(s, c) { s.removeClass(c); }); }\r\n\t\t\tfunction doModeClasses(jquerySelector, prefixes, classFunc) {\r\n\t\t\t\tprefixes = prefixes || [];\r\n\t\t\t\tprefixes.push('');\r\n\t\t\t\tprefixes.forEach(function(prefix) { \r\n\t\t\t\t\tmode.forEach( function(mode) { classFunc(jquerySelector, (prefix.length ? prefix + '-' : '') + mode); });\r\n\t\t\t\t});\r\n\t\t\t\treturn jquerySelector;\r\n\t\t\t}\r\n\r\n\t\t\t// Find node in chainmap\r\n\t\t\t//var $node = $(\"#chainMap [data-nodeid='\"+system+\"']\").parent();\r\n\t\t\tvar $node = $(\"#chainMap #node\"+system).parent();\r\n\r\n\t\t\tif ($node.length == 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar nodeIndex = Math.ceil(($node[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// applly to my top line\r\n\t\t\tvar $connector = addModes($($node.parent().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[nodeIndex]), [ 'left', 'right' ]);\r\n\r\n\t\t\t// Find parent node\r\n\t\t\t//var $parent = $(\"#chainMap [data-nodeid='\"+parent+\"']\").parent();\r\n\t\t\tvar $parent = $(\"#chainMap #node\"+parent).parent();\r\n\r\n\t\t\tif ($parent.length == 0 || $connector.length == 0)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t// Find the col of my top line\r\n\t\t\tvar nodeCol = 0, connectorCell = $connector[0].cellIndex;\r\n\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\tnodeCol += this.colSpan;\r\n\r\n\t\t\t\tif (index == connectorCell) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Get node # in this line\r\n\t\t\tvar parentIndex = Math.ceil(($parent[0].cellIndex + 1) / 2 - 1);\r\n\r\n\t\t\t// Compensate for non-parent nodes (slight performance hit ~10ms)\r\n\t\t\tvar newparentIndex = parentIndex;\r\n\t\t\tfor (var i = 0; i <= parentIndex; i++) {\r\n\t\t\t\tvar checkSystem = 0;//$node.parent().prev().prev().prev().find(\"td:has([data-nodeid]):eq(\"+i+\")\").find(\"[data-nodeid]\").data(\"nodeid\");\r\n\t\t\t\t$node.parent().prev().prev().prev().find(\"td > [data-nodeid]\").each(function(index) {\r\n\t\t\t\t\tif (index == i) {\r\n\t\t\t\t\t\tcheckSystem = $(this).attr(\"id\").replace(\"node\", \"\");//$(this).data(\"nodeid\");\r\n\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif ($.map(map.rows, function(node) { return node.c[1].v == checkSystem ? node : null; }).length <= 0) {\r\n\t\t\t\t\tnewparentIndex--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex = newparentIndex;\r\n\r\n\t\t\t// Apply to parent bottom line\r\n\t\t\tvar $connecte = addModes($($node.parent().prev().prev().children(\"td.google-visualization-orgchart-lineleft, td.google-visualization-orgchart-lineright\")[parentIndex]), [ 'left', 'right'] );\r\n\r\n\t\t\t// the beans\r\n\t\t\tvar col = 0, parent = false, me = false;\r\n\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index, value) {\r\n\t\t\t\tcol += this.colSpan;\r\n\r\n\t\t\t\tif (me && parent) {\r\n\t\t\t\t\t// All done - get outta here\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else if (typeof($connecte[0]) != \"undefined\" && $connecte[0].cellIndex == index) {\r\n\t\t\t\t\tparent = true;\r\n\r\n\t\t\t\t\taddModes($(this), ['left']);\r\n\r\n\t\t\t\t\t// remove bottom border that points to the right\r\n\t\t\t\t\tif (!me && col != nodeCol) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom']);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// parent and node are same - we are done\r\n\t\t\t\t\tif (nodeCol == col) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (col == nodeCol) {\r\n\t\t\t\t\tme = true;\r\n\r\n\t\t\t\t\taddModes($(this), [ 'bottom' ]);\r\n\t\t\t\t} else if (me || parent) {\r\n\t\t\t\t\tvar tempCol = 0, breaker = false, skip = false;\r\n\r\n\t\t\t\t\t$node.parent().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\ttempCol += this.colSpan;\r\n\r\n\t\t\t\t\t\tif (tempCol == col && ($(this).hasClass(\"google-visualization-orgchart-lineleft\") || $(this).hasClass(\"google-visualization-orgchart-lineright\"))) {\r\n\t\t\t\t\t\t\tif (parent == false) {\r\n\t\t\t\t\t\t\t\t// Stop looking cuz there is another node between us and parent\r\n\t\t\t\t\t\t\t\tbreaker = true;\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t} else if (parent == true) {\r\n\t\t\t\t\t\t\t\t// Lets make sure there isnt a node between the parent and me\r\n\t\t\t\t\t\t\t\tremoveModes($connecte, [ 'left', 'right' ]);\r\n\r\n\t\t\t\t\t\t\t\t$node.parent().prev().prev().find(\"td\").each(function(index) {\r\n\t\t\t\t\t\t\t\t\tif (index >= $connecte[0].cellIndex) {\r\n\t\t\t\t\t\t\t\t\t\t// there is a node after parent but before me\r\n\t\t\t\t\t\t\t\t\t\tremoveModes($(this), [ 'bottom' ]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tskip = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (breaker) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!skip) {\r\n\t\t\t\t\t\taddModes($(this), ['bottom'] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var x in lines) {\r\n\t\t\tdrawNodeLine(lines[x][0], lines[x][1], lines[x][2].concat(['connection']), lines[x][3]);\r\n\t\t}\r\n\t};\r\n\r\n\tthis.collapseHandler = function() {\t\t\r\n\t\tif(_this.drawing) { return; }\r\n\t\t\r\n\t\tconst collapsed = _this.map.getCollapsedNodes();\r\n\t\tconst collapsedSystems = [];\r\n\t\tfor (x in collapsed) {\r\n\t\t\tvar systemID = $(\"#chainMap #node\"+(collapsed[x] +1)).data(\"nodeid\");\r\n\t\t\tcollapsedSystems.push(systemID);\r\n\t\t}\r\n\t\towner.updateCollapsed(collapsedSystems);\r\n\t\t\r\n\t\tif(_this.lastLineData) { updateLines(_this.lastLineData.map, _this.lastLineData.lines); }\r\n\t}\r\n\r\n\r\n};","const ChainMapRendererRadial = function(owner) {\r\n\tChainMapRendererBase.apply(this, arguments);\r\n\t\r\n\tconst CIRCLE_SIZE = { x: 70, y: 60, first_ring_delta: 0.3,\r\n\t\tringX: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.x * options.chain.nodeSpacing.x},\r\n\t\tringY: function(ci) { return ci == 0 ? 0 : (ci + this.first_ring_delta) * this.y * options.chain.nodeSpacing.y},\r\n\t };\r\n\t\r\n\tthis.arcFactor = function(ci) { return ci / (ci + 1.0); }\r\n\t\r\n\tthis.skipLevels = function(ci, nodes, minRad, maxRad, parentCollapsed) { \r\n\t\tconst max_nodes_per_rad = 1.4;\r\n\t\tlet skipped = 0;\r\n\t\tif(ci > 0 && !parentCollapsed) {\r\n\t\t\twhile(nodes.length > max_nodes_per_rad * ci * (maxRad - minRad) && ++skipped < 1) { }\r\n\t\t}\r\n\t\treturn skipped; \r\n\t}\r\n\t\r\n\tthis.setPosition = function(node, ci, rad_centre) {\r\n\t\tnode.radPosition = { r: ci, theta: rad_centre };\r\n\t\tnode.position = radToCartesian(node.radPosition);\t\t\r\n\t}\r\n\t\r\n\tthis.drawConnection = function(ctx, node) {\r\n\t\tconst cp1 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (node.radPosition.theta + 2 * node.parent.radPosition.theta) / 3.0 });\r\n\t\tconst cp2 = radToCartesian({ r: node.radPosition.r - 0.5, theta: (2 * node.radPosition.theta + node.parent.radPosition.theta) / 3.0 });\r\n\t\t\r\n\t\tif(node.circle > 1) {\t\t\t\t\r\n\t\t\tctx.bezierCurveTo(cp2.x, cp2.y, cp1.x, cp1.y, node.parent.position.x, node.parent.position.y);\r\n\t\t} else {\r\n\t\t\tctx.lineTo(node.parent.position.x, node.parent.position.y);\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tthis.adjustAlignmentDelta = function(ci, rad_centre) {\r\n\t\treturn ci == 1 ? -rad_centre\t// First node on first ring should be axis aligned\r\n\t\t: 0;\r\n\t}\r\n\t\r\n\tthis.drawGridlines = function(ctx, ci) {\r\n\t\tctx.beginPath();\r\n\t\tif(ctx.ellipse) {\r\n\t\t\tctx.lineWidth = 0.5;\r\n\t\t\tctx.setLineDash([]);\r\n\t\t\tctx.ellipse(0, 0, CIRCLE_SIZE.ringX(ci), CIRCLE_SIZE.ringY(ci), 0, 0, Math.PI * 2);\r\n\t\t}\r\n\t\tctx.strokeStyle = propertyFromCssClass('grid-default', 'color');\r\n\t\tctx.stroke();\t\t\r\n\t}\t\t\r\n\t\r\n\tfunction radToCartesian(rad) {\r\n\t\treturn { \r\n\t\t\tx: CIRCLE_SIZE.ringX(rad.r) * Math.sin(rad.theta), \r\n\t\t\ty: CIRCLE_SIZE.ringY(rad.r) * Math.cos(rad.theta)\r\n\t\t};\r\n\r\n\t}\r\n};\r\n\r\nChainMapRendererRadial.prototype = new ChainMapRendererBase();","var chain = new function() {\r\n\tvar chain = this;\r\n\tthis.map, this.view, this.drawing, this.data = {};\r\n\t\r\n\t// Third party suppliers should have:\r\n\t//  findLinks(systemId, ids) - Find links from the given system coming from the third party. ids contain a parent and a child ID; the child ID should be incremented for every new connection\r\n\t\r\n\tthirdPartySuppliers = [ eveScout ];\r\n\r\n\t// Renderer should have:\r\n\t//  ready() - Whether the renderer is initialised and can accept draw calls\r\n\t// switchTo() - Make this renderer active. The renderer can be in a blank state; draw() will be called after\r\n\t// switchFrom() - Switch away from this renderer. All node divs should be removed from the DOM, other items can be removed or made invisible\r\n\t// draw(map, lines, collapsedSystems) - Redraw the map, based on the given node set, line overrides and list of collapsed systems \r\n\t// collapse(systemID, toggle) - marks the system as collapsed/not collapsed\r\n\t// If the renderer allows collapsing of nodes then it will call updateCollapsed on the owner (the chain) with a list of collapsed systems in the current tab\r\n\t\r\n\tconst renderers = { \r\n\t\torgChart: new ChainMapRendererOrgchart(this),\r\n\t\torgChartTop: new ChainMapRendererOrgchartTop(this),\r\n\t\torgChartSide: new ChainMapRendererOrgchartSide(this),\r\n\t\tradial: new ChainMapRendererRadial(this)\r\n\t};\r\n\t\r\n\tthis.renderer = renderers[options.chain.renderer];\r\n\tthis.renderer.switchTo();\r\n\t\r\n\tthis.useRenderer = function(name) {\r\n\t\tif(!renderers[name]) { throw 'Unknown renderer ' + name; }\r\n\t\tif(chain.renderer != renderers[name]) {\r\n\t\t\tchain.renderer.switchFrom();\r\n\t\t\tchain.renderer = renderers[name];\r\n\t\t\tchain.renderer.switchTo();\r\n\t\t\tchain.redraw();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.activity = function(data) {\r\n\t\t/*\tfunction for adding recent activity to chain map nodes\t*/\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.activity;\r\n\r\n\t\t// Hide all activity colored dots instead of checking each one\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap .nodeActivity span\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   elements[i].className = elements[i].className + \" invisible\";\r\n\t\t}\r\n\r\n\t\t// Loop through passed data and show dots by system\r\n\t\tvar elements = document.querySelectorAll(\"#chainMap [data-nodeid]\");\r\n\t\tfor (var i = 0, l = elements.length; i < l; ++i) {\r\n\t\t   var systemID = elements[i].getAttribute(\"data-nodeid\");\r\n\t\t   if (data[systemID]) {\r\n\t\t\t   var shipJumps = data[systemID].shipJumps;\r\n\t\t\t   var podKills = data[systemID].podKills;\r\n\t\t\t   var shipKills = data[systemID].shipKills;\r\n\t\t\t   var npcKills = data[systemID].npcKills;\r\n\t\t\t   var node = elements[i].getElementsByClassName(\"nodeActivity\")[0];\r\n\r\n\t\t\t   if (shipJumps > 0) {\r\n\t\t\t\t   var jumps = node.getElementsByClassName(\"jumps\")[0];\r\n\t\t\t\t   jumps.className = jumps.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   jumps.setAttribute(\"data-tooltip\", shipJumps + \" Jumps\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (podKills > 0) {\r\n\t\t\t\t   var pods = node.getElementsByClassName(\"pods\")[0];\r\n\t\t\t\t   pods.className = pods.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   pods.setAttribute(\"data-tooltip\", podKills + \" Pod Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (shipKills > 0) {\r\n\t\t\t\t   var ships = node.getElementsByClassName(\"ships\")[0];\r\n\t\t\t\t   ships.className = ships.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   ships.setAttribute(\"data-tooltip\", shipKills + \" Ship Kills\");\r\n\t\t\t   }\r\n\r\n\t\t\t   if (npcKills > 0) {\r\n\t\t\t\t   var npcs = node.getElementsByClassName(\"npcs\")[0];\r\n\t\t\t\t   npcs.className = npcs.className.replace(/invisible/g, \"\");\r\n\t\t\t\t   npcs.setAttribute(\"data-tooltip\", npcKills + \" NPC Kills\");\r\n\t\t\t   }\r\n\t\t   }\r\n\t\t}\r\n\r\n\t\tif (SystemActivityToolTips.attachedElements && SystemActivityToolTips.attachedElements.length > 0) {\r\n\t\t\tSystemActivityToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeActivity > span[data-tooltip]:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.occupied = function(data) {\r\n\t\t/*\tfunction for showing occupied icon  */\r\n\r\n\t\t// Hide all icons instead of checking each one\r\n\t\t$(\"#chainMap [data-icon='user'], #chainMap [data-icon='user'] + .badge\").addClass(\"invisible\");\r\n\r\n\t\t// Loop through passed data and show icons\r\n\t\tfor (var x in data) {\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user']\").removeClass(\"invisible\");\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+data[x].systemID+\"'] [data-icon='user'] + .badge\").removeClass(\"invisible\").html(data[x].count);\r\n\t\t}\r\n\r\n\t\tOccupiedToolTips.attach($(\"#chainMap [data-icon='user']:not(.invisible)\"));\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.flares = function(data) {\r\n\t\t/*\tfunction for coloring chain map nodes via flares  */\r\n\t\t//var data = typeof(data) !== \"undefined\" ? data : this.data.flares;\r\n\r\n\t\t// Remove all current node coloring instead of checking each one\r\n\t\t$(\"#chainMap div.node\").removeClass(\"redNode yellowNode greenNode\");\r\n\r\n\t\t// Remove all coloring from chain grid\r\n\t\t$(\"#chainGrid tr\").removeClass(\"red yellow green\");\r\n\r\n\t\t// Loop through passed data and add classes by system\r\n\t\tif (data) {\r\n\t\t\tfor (var x in data.flares) {\r\n\t\t\t\tvar systemID = data.flares[x].systemID;\r\n\t\t\t\tvar flare = data.flares[x].flare;\r\n\r\n\t\t\t\tvar row = ($(\"#chainMap [data-nodeid=\"+systemID+\"]\").addClass(flare+\"Node\").parent().index() - 1) / 3 * 2;\r\n\r\n\t\t\t\tif (row > 0) {\r\n\t\t\t\t\t$(\"#chainGrid tr:eq(\"+row+\")\").addClass(flare).next().addClass(flare);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tthis.grid = function() {\r\n\t\t/*  function for showing/hiding grid lines  */\r\n\t\t// This is an optional feature\r\n\t\tif (options.chain.gridlines == false) {\r\n\t\t\t$(\"#chainGrid tr\").addClass(\"hidden\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t$(\"#chainGrid tr\").removeClass(\"hidden\");\r\n\t\t//$(\"#chainGrid\").css(\"width\", \"100%\");\r\n\r\n\t\t// Calculate how many rows have systems, max 0 hack to prevent negative numbers, and rows above this number get hidden\r\n\t\tvar rows = Math.max(0, $(\".google-visualization-orgchart-table tr:has(.node)\").length * 2 - 1);\r\n\t\t$(\"#chainGrid tr:gt(\"+rows+\")\").addClass(\"hidden\");\r\n\t}\r\n\r\n\tthis.nodes = function(map) {\r\n\t\tvar chain = {cols: [{label: \"System\", type: \"string\"}, {label: \"Parent\", type: \"string\"}], rows: []};\r\n\t\tvar frigTypes = [\"Q003\", \"E004\", \"L005\", \"Z006\", \"M001\", \"C008\", \"G008\", \"A009\", \"SML\" ];\r\n\t\tvar connections = [];\r\n\t\tvar chainMap = this;\r\n\r\n\t\tfunction formatStatics(statics) {\r\n\t\t\tif(!statics) { return ''; }\r\n\t\t\telse if(statics.length > 4) { return '<span class=\"multi-static\">+</span>'; }\r\n\t\t\t\r\n\t\t\tconst shortCodeMap = { 'High-Sec': 'H', 'Low-Sec': 'L', 'Null-Sec': 'N', 'Triglavian':'',\r\n\t\t\t\t'Class-1': '1', 'Class-2': '2', 'Class-3': '3', 'Class-4': '4', 'Class-5' : 5, 'Class-6': 6\r\n\t\t\t};\r\n\t\t\tconst classMap = { H: 'hisec', L: 'lowsec', N: 'nullsec', '': 'triglavian' };\r\n\t\t\treturn statics.map(function(s) {\r\n\t\t\t\tconst text = shortCodeMap[appData.wormholes[s].leadsTo];\r\n\t\t\t\tconst className = classMap[text] || 'class-' +  text;\r\n\t\t\t\tconst tip = appData.wormholes[s].leadsTo + ' via ' + s;\r\n\t\t\t\treturn '<span class=\"' + className + '\" data-tooltip=\"' + tip + '\">' + text + '</span>';\r\n\t\t\t}).join('');\r\n\t\t}\r\n\r\n\t\tfunction topLevel(systemID, id) {\r\n\t\t\tif (!systemID || !tripwire.systems[systemID])\r\n\t\t\t\treturn false;\r\n\t\t\tconst tab = options.chain.tabs[options.chain.active];\r\n\t\t\tconst tabName = tab && tab.systemID != 0 && 0 > tab.systemID.indexOf(',') ? options.chain.tabs[options.chain.active].name : undefined;\r\n\t\t\treturn makeSystemNode(systemID, id, null, null, tabName, '&nbsp;', ['top-level']);\r\n\t\t}\r\n\r\n\t\tfunction makeSystemNode(systemID, id, whId, inSigId, systemName, nodeTypeMarkup, additionalClasses) {\r\n\t\t\t// System type switch\r\n\t\t\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\tvar systemType = \"<span class='\" + system.systemTypeClass + \"'>\" + system.systemTypeName + system.systemTypeModifiers.join('') + \"</span>\";\r\n\t\t\t\r\n\t\t\tsystemName = _.escape(systemName);\r\n\t\t\tconst systemNameText = \r\n\t\t\t\toptions.chain.sigNameLocation == 'name' ? (systemName ? systemName : system.name ? system.name : '&nbsp;') :\r\n\t\t\t\toptions.chain.sigNameLocation == 'name_prefix' ?\r\n\t\t\t\t\t(systemName ? systemName + (system.name ? ' - ' + system.name : '') : (system.name ? system.name : '&nbsp;')) :\r\n\t\t\t\t(system.name ? system.name : '&nbsp;');\t\r\n\r\n\t\t\tvar node = {v: id, systemID: systemID };\r\n\t\t\tvar chainNode = \"<div id='node\"+id+\"' data-nodeid='\"+systemID+\"'\"\r\n\t\t\t\t+(whId ? \" data-sigid='\"+whId+\"'\" : '')\r\n\t\t\t\t+(inSigId ? \" data-inSigid='\"+inSigId+\"'\" : '')\r\n\t\t\t\t+\" class='node \" + ((additionalClasses || []).join(' ')) + \"'>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeIcons'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: left;'>\"\r\n\t\t\t\t\t\t\t+ systemRendering.renderEffect(system, 'i')\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\t\"<div style='float: right;'>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<i data-icon='user' class='invisible'></i>\"\r\n\t\t\t\t\t\t\t+\t\t\t\"<span class='badge invisible'></span>\"\r\n\t\t\t\t\t\t\t+\t\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeClass'>\"+systemType+\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeSystem'>\"\r\n\t\t\t\t\t\t\t+\t\t(system.name ? \"<a href='.?system=\"+system.name+\"'>\"+systemNameText+\"</a>\" : systemNameText)\r\n\t\t\t\t\t\t\t+\t\"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<h4 class='nodeType'>\" + nodeTypeMarkup + \"</h4>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='statics'>\"\r\n\t\t\t\t\t\t\t+ formatStatics(system.name ? system.statics : [])\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\t\"<div class='nodeActivity'>\"\r\n\t\t\t\t\t\t\t+\t\t\"<span class='jumps invisible'>&#9679;</span>&nbsp;<span class='pods invisible'>&#9679;</span>&nbsp;&nbsp;<span class='ships invisible'>&#9679;</span>&nbsp;<span class='npcs invisible'>&#9679;</span>\"\r\n\t\t\t\t\t\t\t+\t\"</div>\"\r\n\t\t\t\t\t\t\t+\"</div>\";\r\n\r\n\t\t\tnode.f = chainNode;\r\n\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\t\r\n\t\tfunction makeCalcChildNode(childID, node, targetSystem) {\r\n\t\t\tvar path = guidance.findShortestPath(tripwire.map.shortest, targetSystem - 30000000, node.child.systemID - 30000000);\r\n\t\t\tif(!path) { return null; }\r\n\t\t\t\r\n\t\t\tvar calcNode = { calculated: true};\r\n\t\t\tcalcNode.life = \"Gate\";\r\n\t\t\tcalcNode.parent = {};\r\n\t\t\tcalcNode.parent.id = node.child.id;\r\n\t\t\tcalcNode.parent.systemID = node.child.systemID;\r\n\t\t\tcalcNode.parent.name = node.child.name;\r\n\t\t\tcalcNode.parent.type = node.child.type;\r\n\t\t\tcalcNode.parent.nth = node.child.nth;\r\n\r\n\t\t\tcalcNode.child = {};\r\n\t\t\tcalcNode.child.id = ++childID;\r\n\t\t\tcalcNode.child.systemID = targetSystem;\r\n\t\t\tcalcNode.child.name = tripwire.systems[targetSystem].name;\r\n\t\t\tcalcNode.child.path = path;\r\n\t\t\tcalcNode.child.jumps = path.length - 1;\r\n\t\t\tcalcNode.child.nth = null;\t\t\t\r\n\t\t\t\r\n\t\t\treturn { childID, calcNode };\r\n\t\t}\r\n\r\n\t\tfunction findLinks(system) {\r\n\t\t\tif (system[0] <= 0) return false;\r\n\r\n\t\t\tvar parentID = parseInt(system[1]), childID = chainList.length;\r\n\t\t\tconst connectedTo = [];\t// Local cache, in addition to usedLinks, for extra link sources\r\n\r\n\t\t\t/** Add the 'current' and 'favourite' calculated nodes if appropriate */\r\n\t\t\tconst addCalcChildNodes = function(node) {\r\n\t\t\t\tif ($(\"#show-viewing\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[viewingSystemID].class && !tripwire.systems[node.child.systemID].class && viewingSystemID != node.child.systemID ) {\r\n\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, viewingSystemID);\r\n\t\t\t\t\tif(calcNode) {\r\n\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(\"#show-favorite\").hasClass(\"active\") && tripwire.systems[node.child.systemID] && !tripwire.systems[node.child.systemID].class) {\r\n\t\t\t\t\tfor (var x in options.favorites) {\r\n\t\t\t\t\t\tif (tripwire.systems[options.favorites[x]].regionID >= 11000000 || tripwire.systems[node.child.systemID].regionID >= 11000000 || options.favorites[x] == node.child.systemID)\r\n\t\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\tvar calcNode = makeCalcChildNode(childID, node, options.favorites[x]);\r\n\t\t\t\t\t\tif(calcNode) {\r\n\t\t\t\t\t\t\tchildID = calcNode.childID;\r\n\r\n\t\t\t\t\t\t\tchainLinks.push(calcNode.calcNode);\r\n\t\t\t\t\t\t\tchainList.push([0, childID]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t};\r\n\r\n\t\t\tfor (var x in chainData) {\r\n\t\t\t\tvar wormhole = chainData[x];\t\t\t\t\r\n\t\t\t\tif ($.inArray(wormhole.id, usedLinks) == -1) {\r\n\t\t\t\t\tvar sig1, sig2, sig1Type, sig2Type,\r\n\t\t\t\t\t\tparent, child, parentType, childType;\r\n\t\t\t\t\tif (wormhole.parent == \"secondary\") {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsig1 = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\tsig2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsig1Type = wormhole.type; sig2Type = 'K162';\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (sig1 && sig1.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig1; child = sig2;\r\n\t\t\t\t\t\tparentType = sig2Type; childType = sig1Type;\r\n\t\t\t\t\t} else if(sig2 && sig2.systemID == system[0]) {\r\n\t\t\t\t\t\tparent = sig2; child = sig1;\r\n\t\t\t\t\t\tchildType = sig2Type; parentType = sig1Type;\r\n\t\t\t\t\t} else { continue; }\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar node = {};\r\n\t\t\t\t\tnode.id = wormhole.id;\r\n\t\t\t\t\tnode.life = wormhole.life;\r\n\t\t\t\t\tnode.mass = wormhole.mass;\r\n\t\t\t\t\tnode.time = parent.modifiedTime;\r\n\r\n\t\t\t\t\tnode.parent = {};\r\n\t\t\t\t\tnode.parent.id = parentID;\r\n\t\t\t\t\tnode.parent.systemID = tripwire.systems[parent.systemID] ? parent.systemID : parent.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.parent.name = child.name;\r\n\t\t\t\t\tnode.parent.type = parentType;\r\n\t\t\t\t\tnode.parent.nth = null;\r\n\t\t\t\t\tnode.parent.signatureID = child.signatureID;\r\n\t\t\t\t\tnode.parent.sigIndex = child.id;\r\n\r\n\t\t\t\t\tnode.child = {};\r\n\t\t\t\t\tnode.child.id = ++childID;\r\n\t\t\t\t\tnode.child.systemID = tripwire.systems[child.systemID] ? child.systemID : child.systemID + \"|\" + Math.floor(Math.random() * Math.floor(10000));\r\n\t\t\t\t\tnode.child.name = parent.name;\r\n\t\t\t\t\tnode.child.type = childType;\r\n\t\t\t\t\tnode.child.nth = null;\r\n\t\t\t\t\tnode.child.signatureID = parent.signatureID;\r\n\t\t\t\t\tnode.child.sigIndex = parent.id;\r\n\r\n\t\t\t\t\tchainLinks.push(node);\r\n\t\t\t\t\tchainList.push([node.child.systemID, node.child.id, system[2]]);\r\n\t\t\t\t\tusedLinks.push(node.id);\r\n\t\t\t\t\tif(tripwire.systems[child.systemID]) { connectedTo.push(1 * child.systemID); }\t// cast to number - sigs have the system as a string\r\n\t\t\t\t\t// usedLinks[system[2]].push(node.id);\r\n\t\t\t\t\t\r\n\t\t\t\t\taddCalcChildNodes(node);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthirdPartySuppliers.forEach(function(supplier) {\t\t\t\t\r\n\t\t\t\tconst ids = { parentID: parentID, nextChildID: ++childID };\r\n\t\t\t\tconst supplierNodes = supplier.findLinks(1 * system[0], ids);\r\n\t\t\t\tif(!supplierNodes) { return; }\r\n\t\t\t\tchildID = ids.nextChildID - 1;\r\n\r\n\t\t\t\tfor(var ti = 0; ti < supplierNodes.length; ti++) {\r\n\t\t\t\t\tvar supplierNode = supplierNodes[ti];\r\n\t\t\t\t\tif(0 > usedLinks.indexOf(supplierNode.id)) {\r\n\t\t\t\t\t\tif(0 > connectedTo.indexOf(supplierNode.child.systemID)) { // not in our map already\r\n\t\t\t\t\t\t\tsupplierNode.thirdParty = supplier.nodeNameSuffix;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tchainLinks.push(supplierNode);\r\n\t\t\t\t\t\t\tchainList.push([supplierNode.child.systemID, supplierNode.child.id, system[2]]);\r\n\t\t\t\t\t\t\tconnectedTo.push(supplierNode.child.systemID);\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\taddCalcChildNodes(supplierNode);\t\t\r\n\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Always want to do this, even if we didn't add it, because in that case the link is overridden by one on this mask, so it is 'used' even if not made visible\r\n\t\t\t\t\t\tusedLinks.push(supplierNode.id);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tif ($(\"#chainTabs .current\").length > 0) {\r\n\t\t\tvar systems = $(\"#chainTabs .current .name\").data(\"tab\").toString().split(\",\");\r\n\t\t\tvar chainList = [];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tif (systems == 0) {\r\n                                let i = 0;\r\n                                Object.keys(map).slice()/*.reverse()*/.forEach(x => {\r\n\t\t\t\t        const parent = tripwire.client.signatures[map[x].initialID];\r\n\t\t\t\t        const child = tripwire.client.signatures[map[x].secondaryID];\r\n                                        if (parent && tripwire.systems[parent.systemID] && typeof(tripwire.systems[parent.systemID].class) == \"undefined\") {\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t// usedLinks[parent.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(parent.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([parent.systemID, i, parent.systemID]);\r\n                                        } else if (child && tripwire.systems[child.systemID] && typeof(tripwire.systems[child.systemID].class) == \"undefined\") {\r\n\t\t\t\t  \t        i++;\r\n\t\t\t\t  \t\t// usedLinks[child.systemID] = [];\r\n\t\t\t\t\t\tchain.rows.push({c: [topLevel(child.systemID, i), {v: null}]});\r\n\t\t\t\t\t\tchainList.push([child.systemID, i, child.systemID]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfor (var x in systems) {\r\n\t\t\t\t\t// usedLinks[systems[x]] = [];\r\n\t\t\t\t\tchain.rows.push({c: [topLevel(systems[x], parseInt(x) + 1), {v: null}]});\r\n\t\t\t\t\tchainList.push([systems[x], parseInt(x) + 1, systems[x]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; i++) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t$(\"#chainError\").hide();\r\n\r\n\t\t\tvar row = {c: []};\r\n\t\t\tvar systemID = viewingSystemID;\r\n\r\n\t\t\trow.c.push(topLevel(systemID, 1), {v: null});\r\n\r\n\t\t\tchain.rows.push(row);\r\n\r\n\t\t\tvar chainList = [[systemID, 1]];\r\n\t\t\tvar chainData = map;\r\n\t\t\tvar chainLinks = [];\r\n\t\t\tvar usedLinks = [];\r\n\r\n\t\t\tfor (var i = 0; i < chainList.length; ++i) {\r\n\t\t\t\tfindLinks(chainList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst systemsInChainMap = {};\r\n\t\t\r\n\t\tfor (var x in chainLinks) {\r\n\t\t\tvar node = chainLinks[x];\r\n\t\t\tvar row = {c: []};\r\n\t\t\t\r\n\t\t\tconst sigText = options.chain[\"node-reference\"] == \"id\" ? (node.child.signatureID ? node.child.signatureID.substring(0, 3) : \"???\") :\r\n\t\t\t\t\t(node.child.type || \"(?)\");\r\n\t\t\tconst nodeTypeMarkup = node.child.path ? \r\n\t\t\t\tsystemRendering.renderPath(node.child.path) :\r\n\t\t\t\t(node.child.sigIndex ? \"<a href='#' onclick='sigDialog.openSignatureDialog({data: { signature: \" + node.child.sigIndex + \", mode: \\\"update\\\" }}); return false;'>\" : '') + _.escape(\r\n\t\t\t\t\tnode.child.name && options.chain.sigNameLocation == 'ref' ? node.child.name :\r\n\t\t\t\t\tnode.child.name && options.chain.sigNameLocation == 'ref_prefix' ? node.child.name + ' - ' + sigText :\r\n\t\t\t\t\tsigText\r\n\t\t\t\t) + (node.child.sigIndex ? '</a>' : '');\r\n\t\t\tconst additionalClasses = node.calculated ? ['calc'] : systemsInChainMap[node.child.systemID] ? [ 'loop' ] : [];\r\n\t\t\tif(node.thirdParty) { additionalClasses.push('third-party', 'third-party-' + node.thirdParty); }\r\n\r\n\t\t\t// Connection modifiers\r\n\t\t\tvar modifiers = [];\t\t\t\r\n\t\t\tif (node.life == \"critical\") { modifiers.push('eol'); }\r\n\t\t\tif (node.mass == \"critical\") { modifiers.push('critical'); }\r\n\t\t\telse if (node.mass == \"destab\") { modifiers.push('destab'); }\r\n\t\t\t\r\n\t\t\tconst connectionWormhole = wormholeAnalysis.wormholeFromTypePair(node.parent.type, node.child.type) || \r\n\t\t\t\twormholeAnalysis.likelyWormhole(node.parent.systemID, node.child.systemID);\r\n\t\t\tif(connectionWormhole.jump) { \r\n\t\t\t\tmodifiers.push('jm-' + (connectionWormhole.jump / 1e6) + 'kt'); \r\n\t\t\t\tif(connectionWormhole.jump == 5000000) { modifiers.push('frig'); }\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst parentModifiers = (systemsInChainMap[node.parent.systemID] || { chainModifiers:[]}).chainModifiers;\r\n\t\t\trow.chainModifiers = modifiers.concat(parentModifiers.filter(function(p) { return modifiers.indexOf(p) < 0; }));\r\n\t\t\t\r\n\t\t\trow.chainModifiers.forEach(function(cm) { modifiers.push(cm + '-chain')});\r\n\t\t\t\r\n\t\t\t// Update result set (rows/connections)\r\n\t\t\tconst child = makeSystemNode(node.child.systemID, node.child.id, node.id, node.child.sigIndex, node.child.name, nodeTypeMarkup, additionalClasses.concat(modifiers));\r\n\r\n\t\t\tvar parent = {v: node.parent.id};\r\n\r\n\t\t\trow.c.push(child, parent);\r\n\t\t\tchain.rows.push(row);\r\n\t\t\tconnections.push(Array(child.v, parent.v, modifiers, node.id));\r\n\t\t\t\r\n\t\t\tconst parentPathHome = (systemsInChainMap[node.parent.systemID] || { pathHome:[]}).pathHome;\r\n\t\t\trow.pathHome = parentPathHome.concat(node.child);\r\n\t\t\t\r\n\t\t\tif(!node.calculated) { \r\n\t\t\t\tsystemsInChainMap[node.child.systemID] = row; // store for loops/chain modifiers\r\n\t\t\t}\t\r\n\t\t}\r\n\r\n\t\t// Apply critical/destab line colors\r\n\t\tconnections.reverse(); // so we apply to outer systems first\r\n\r\n\t\tconst exits = Object.keys(systemsInChainMap).filter(function(x) { return x < 31000000; });\r\n\t\treturn {map: chain, lines: connections, systemsInChainMap: systemsInChainMap, exits: exits};\r\n\t}\r\n\r\n\r\n\tthis.setActiveTab = function(newIndex) {\r\n\t\t$(\"#chainTabs .tab\").removeClass(\"current\");\r\n\t\toptions.chain.active = newIndex;\r\n\t\tif(newIndex != null) {\r\n\t\t\t$(\"#chainTabs .tab\").eq(newIndex).addClass('current');\r\n\t\t}\r\n\t\t\r\n\t\toptions.save();\r\n\t\tchain.redraw();\r\n\t\ttripwire.parse(tripwire.client, \"refresh\");\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.useRenderer(options.chain.renderer);\r\n\t\t\r\n\t\tvar data = $.extend(true, {}, this.data);\r\n\t\tdata.map = $.extend(true, {}, data.rawMap);\r\n\r\n\t\tthis.draw(data);\r\n\t}\r\n\t\r\n\tvar drawRetryTimer = null;\r\n\r\n\tthis.draw = function(data) {\r\n\t\tvar data = typeof(data) !== \"undefined\" ? data : {};\r\n\t\tclearTimeout(drawRetryTimer);\r\n\r\n\t\t// We need to make sure Google chart is ready and we have signature data for this system before we begin, otherwise delay\r\n\t\tif (!this.renderer.ready() || (Object.keys(data.map||{}).length && !tripwire.client.signatures)) {\r\n\t\t\tdrawRetryTimer = setTimeout(function() { chain.draw(data) }, 100);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.map) {\r\n\t\t\tthis.drawing = true;\r\n\r\n\t\t\tthis.data.rawMap = $.extend(true, {}, data.map);\r\n\r\n\t\t\t// if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout == false)) {\r\n\t\t\t// \tif (options.masks.active != \"273.0\") {\r\n\t\t\t// \t\tfor (var i in data.map) {\r\n\t\t\t// \t\t\tif (data.map[i].mask == \"273.0\") {\r\n\t\t\t// \t\t\t\tdelete data.map[i];\r\n\t\t\t// \t\t\t}\r\n\t\t\t// \t\t}\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\r\n\t\t\t// Sort so we keep the chain map order the same\r\n\t\t\tObject.sort(data.map, \"id\");\r\n\r\n\t\t\t$.extend(data, this.nodes(data.map)); // 250ms -> <100ms\r\n\t\t\t$.extend(this.data, data);\r\n\t\t\t\r\n\t\t\tconst collapsedSystems = options.chain.tabs[options.chain.active] ? (options.chain.tabs[options.chain.active].collapsed || []) : [];\r\n\r\n\t\t\tthis.renderer.draw(data.map, data.lines, collapsedSystems); // 150ms\r\n\t\t\t//this.map.draw(this.newView(data.map), this.options); // 150ms\r\n\r\n//\t\t\tthis.renderer.lines(data); // 300ms\r\n\t\t\tthis.grid(); // 4ms\r\n\r\n\t\t\t// Apply current system style\r\n\t\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\"); // 0.1ms\r\n\r\n\t\t\t// Remove old system effect tooltips and add current ones\r\n\t\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t\t}\r\n\t\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\")); // 0.30ms\r\n\t\t\tWormholeRouteToolTips.attach($(\"#chainMap .path span[data-tooltip]\"));\r\n\t\t\tSystemActivityToolTips.attach($(\"#chainMap .nodeClass span[data-tooltip]\"));\r\n\t\t\t\r\n\t\t\tthis.drawing = false;\r\n\t\t\t\r\n\t\t\tsystemPanel.update();\r\n\t\t}\r\n\r\n\t\t// Gather latest system activity\r\n\t\tif (!this.data.activity || new Date() > this.data.activity.expires) {\r\n\t\t\tdata.activity = {};\r\n\t\t\ttripwire.esi.universeJumps()\r\n\t\t\t\t.done(function(results, status, request) {\r\n\t\t\t\t\tdata.activity.expires = new Date(request.getResponseHeader(\"expires\"));\r\n\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\tshipJumps: results[x].ship_jumps\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\t return tripwire.esi.universeKills()\r\n\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t$.each(results, function(x) {\r\n\t\t\t\t\t\t\t\tif (data.activity[results[x].system_id]) {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].podKills = results[x].pod_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].shipKills = results[x].ship_kills;\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id].npcKills = results[x].npc_kills;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tdata.activity[results[x].system_id] = {\r\n\t\t\t\t\t\t\t\t\t\tsystemID: results[x].system_id,\r\n\t\t\t\t\t\t\t\t\t\tpodKills: results[x].pod_kills,\r\n\t\t\t\t\t\t\t\t\t\tshipKills: results[x].ship_kills,\r\n\t\t\t\t\t\t\t\t\t\tnpcKills: results[x].npc_kills,\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function() {\r\n\t\t\t\t\tchain.data.activity = chain.activity(data.activity);\r\n\t\t\t\t});\r\n\t\t} else if (data.map) {\r\n\t\t\tchain.activity(this.data.activity);\r\n\t\t}\r\n\r\n\t\tif (data.occupied) { // 3ms\r\n\t\t\tthis.data.occupied = this.occupied(data.occupied);\r\n\t\t}\r\n\r\n\t\tif (data.flares) { // 20ms\r\n\t\t\tthis.data.flares = this.flares(data.flares);\r\n\t\t}\r\n\t}\r\n\r\n\tthis.updateCollapsed = function(collapsedSystems) {\r\n\t\tif (options.chain.tabs[options.chain.active]) {\r\n\t\t\toptions.chain.tabs[options.chain.active].collapsed = collapsedSystems;\r\n\t\t}\r\n\t\t\r\n\t\t// Apply current system style\r\n\t\t$(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']\").parent().addClass(\"currentNode\");\r\n\r\n\t\tif (WormholeTypeToolTips.attachedElements && WormholeTypeToolTips.attachedElements.length > 0) {\r\n\t\t\tWormholeTypeToolTips.detach($(\"#chainMap .whEffect\"));\r\n\t\t}\r\n\t\tWormholeTypeToolTips.attach($(\"#chainMap .whEffect[data-icon]\"));\r\n\r\n\t\tchain.activity(chain.data.activity);\r\n\r\n\t\tchain.occupied(chain.data.occupied);\r\n\r\n\t\tchain.flares(chain.data.flares);\r\n\r\n\t\tchain.grid();\r\n\r\n\t\toptions.save();\r\n\t}\r\n\r\n}\r\n","var guidance_profiles = {\r\n\tblueLootSystems: [17,40,41,55,72,53,74,160,162,163,196,197,164,181,187,133,159,903,905,1002,1013,1021,1026,1032,1038,1045,1290,1359,1390,1361,1397,1395,1391,1676,1679,1677,1840,1842,1847,1848,1852,1854,1855,1858,1866,1868,1873,1874,1881,1883,1894,1896,1897,1901,1902,1907,1914,1918,1922,1931,1932,1938,1946,1951,1952,1958,1959,1961,1939,1978,2415,2418,2414,2558,2559,2560,2568,2569,2571,2572,2769,2815,2816,2771,2800,2975,2977,2980,2988,2993,2992,3017,3018,3024,3030,3048,3055,3025,3029,3053,3271,3275,3279,3280,3281,3283,3284,3287,3305,3307,3312,3317,3318,3321,3322,3324,3329,3333,3335,3338,3339,3342,3344,3361,3363,2058,2065,2067,3394,3404,3412,3447,3449,3467,3469,3389,3402,3413,3409,2059,2190,2252,3553,3554,3555,3556,2191,2193,2187,4077,4078,4079,4084,4111,4112,4114,4083,4239,4240,4241,4288,4291,4296,4621,4623,5010,5011,5020,5009,5018,5017,5030,5031,5034,5035,5039,5040,5043,5052,5054,5276,5275],\r\n\tchainExits: []\r\n}","const systemPanel = new function() {\r\n\tthis.update = function() {\r\n\t\t// Update dependent controls: Path to chain/home\r\n\t\tconst exits = chain.data.exits;\r\n\t\tvar html = [\r\n\t\t\trenderRoute((exits || []).map(function(x) { return x  - 30000000; }), true, 'chain', 'To chain'), \r\n\t\t\trenderRoute(guidance_profiles.blueLootSystems, false, 'blue-loot', 'Blue loot buyer')\r\n\t\t].filter(function(x) { return x; }).join('');\r\n\t\t$(\"#infoExtra\").html(html);\r\n\t\tTooltips.attach($(\"#infoExtra [data-tooltip]\"));\r\n\t};\r\n\t\r\n\tfunction renderRoute(targets, addPathHome, cssClass, categoryText) {\r\n\t\tconst path = targets ? guidance.findShortestPath(tripwire.map.shortest, viewingSystemID - 30000000, targets) : null;\r\n\t\tif(path) {\r\n\t\t\tconst inChain = path.length <= 1;\r\n\t\t\tconst exitSystem = path[path.length - 1] + 30000000;\r\n\t\t\tconst prefixText = inChain ? 'In chain: ' : (path.length - 1) + 'j from ' ;\r\n\t\t\tconst pathHomeText = addPathHome ? chain.data.systemsInChainMap[exitSystem].pathHome.slice().reverse()\r\n\t\t\t\t.map(function(n) { return '<a href=\".?system=' + tripwire.systems[n.systemID].name + '\">' + (n.name || tripwire.systems[n.systemID].name || '???') + '</a>'; })\r\n\t\t\t\t.join(' &gt; ') : '<a href=\".?system=' + tripwire.systems[exitSystem].name + '\">' + tripwire.systems[exitSystem].name + '</a>';\r\n\t\t\t\tconst pathToChainText = inChain ? '' : '<br/>' + systemRendering.renderPath(path.slice().reverse());\r\n\t\t\t\treturn '<div class=\"' + cssClass + '\">' + categoryText + ': ' + prefixText + pathHomeText + pathToChainText + '</div>';\r\n\t\t} else { return null; }\r\n\t}\r\n\r\n}();","tripwire.active = function(data) {\r\n    var editSigs = [];\r\n    var editComments = [];\r\n\r\n    for (var x in data) {\r\n        var activity = JSON.parse(data[x].activity);\r\n        editSigs.push(parseInt(activity.editSig));\r\n        editComments.push(parseInt(activity.editComment));\r\n\r\n        if (activity.editSig) {\r\n            $(\"#sigTable tr[data-id='\"+activity.editSig+\"']\")\r\n                //.attr('data-tooltip', sig.editing)\r\n                //.attr(\"title\", sig.editing)\r\n                .addClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#001b47\"}, 1000); //35240A - Yellow\r\n        }\r\n\r\n        if (activity.editComment && $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"'] .cke\").length > 0) {\r\n            $(\"#commentWrapper .comment[data-id='\"+activity.editComment+\"']\")\r\n                .addClass(\"editing\")\r\n                .find(\".commentStatus\").html(data[x].characterName + \" is editing\").fadeIn();\r\n        }\r\n    }\r\n\r\n    $(\"#sigTable tr.editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editSigs) == -1) {\r\n            $(\"#sigTable tr[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                //.attr('data-tooltip', '')\r\n                //.removeAttr(\"title\")\r\n                .removeClass(\"editing\")\r\n                .find(\"td\")\r\n                .animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n        }\r\n    });\r\n\r\n    $(\"#commentWrapper .editing\").each(function() {\r\n        if ($.inArray($(this).data(\"id\"), editComments) == -1) {\r\n            $(\"#commentWrapper .editing[data-id='\"+$(this).data(\"id\")+\"']\")\r\n                .removeClass(\"editing\")\r\n                .find(\".commentStatus\").fadeOut(function() {$(this).html(\"\")});\r\n        }\r\n    });\r\n}\r\n","// Hanldes adding to Signatures section\r\n// ToDo: Use native JS\r\ntripwire.makeSigInfo = function(sig, wormhole) {\r\n\twormhole = wormhole ||\t// allow to be passed in to save this lookup\r\n\t\tObject.values(tripwire.client.wormholes).find(function (wh) { return wh.initialID == sig.id || wh.secondaryID == sig.id});\r\n\tif (!wormhole) return false;\r\n\tvar otherSignature = sig.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\tif (!otherSignature) return false;\r\n\r\n\tlet leadsTo;\r\n\tif (sig.name) {\r\n\t  leadsTo = tripwire.systems[otherSignature.systemID] ?\r\n\t\t\"<a href='.?system=\"+tripwire.systems[otherSignature.systemID].name+\"'>\"+_.escape(sig.name)+\"</a> &ndash; \" + systemRendering.renderSystem(systemAnalysis.analyse(otherSignature.systemID), 'a') : \r\n\t\t_.escape(sig.name);\r\n\t} else if (appData.genericSystemTypes[otherSignature.systemID]) {\r\n\t\tleadsTo = appData.genericSystemTypes[otherSignature.systemID];\r\n\t} else if (tripwire.systems[otherSignature.systemID]) {\r\n\t\tleadsTo = systemRendering.renderSystem(systemAnalysis.analyse(otherSignature.systemID), 'a');\r\n\t} else {\r\n\t\tleadsTo = \"\";\r\n\t}\r\n\r\n\tconst wormholeTypeText = wormhole.type || \"???\";\r\n\treturn {\r\n\t\tid: sig.id,\r\n\t\tleadsTo: leadsTo,\r\n\t\twormhole: wormhole,\r\n\t\tformattedType: (wormhole[wormhole.parent+\"ID\"] == sig.id ? wormholeTypeText : (wormhole.parent ? \"[\" + wormholeTypeText + \"]\" : \"\")),\r\n\t\tlifeText: { critical: 'EOL', stable: 'Stable' }[wormhole.life] || wormhole.life,\r\n\t}\r\n}\r\n\r\ntripwire.addSig = function(add, option, disabled) {\r\n    var option = option || {};\r\n    var animate = typeof(option.animate) !== 'undefined' ? option.animate : true;\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n\tconst returnLinkText = add.signatureID ? '<a class=\"return-link\" href=\"#\" onclick=\"tripwire.setReturnSig(event, ' + add.id + ')\">&gt;&gt; Set ' + \r\n\t\t\t\tadd.signatureID.substring(0, 3).toUpperCase() + '-' + add.signatureID.substring(3) +\r\n\t\t\t\t' as return</a>'\r\n\t\t\t\t: '';\r\n\r\n    if (add.type == \"wormhole\") {\r\n\t\tconst sigInfo = tripwire.makeSigInfo(add);\r\n\t\tif(!sigInfo) return false;\r\n\t\t\r\n\t\twormhole = sigInfo.wormhole;\r\n\t\t\r\n\t\tconst leadsToText = sigInfo.leadsTo ? sigInfo.leadsTo : \r\n\t\t\tadd.signatureID && add.signatureID.length && add.signatureID[0] != '?' ? returnLinkText\r\n\t\t\t: '';\t\r\n\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+formatSignatureID(add.signatureID)+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+sigInfo.formattedType+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+leadsToText+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+sigInfo.lifeText+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n\t\tconst leadsToText = add.type === 'unknown' ? returnLinkText : \r\n\t\t\t(add.name ? linkSig(add.name) : '');\r\n        var row = \"<tr data-id='\"+add.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+formatSignatureID(add.signatureID)+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+add.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(add.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(add)+\"'><span data-age='\"+add.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+leadsToText+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    $(\"#sigTable\").append(tr);\r\n\r\n    // Add counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(add.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            // .countdown('pause')\r\n            .addClass('critical')\r\n            // .countdown('resume');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(add.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    if (animate) {\r\n        $(tr)\r\n            .find('td')\r\n            .wrapInner('<div class=\"hidden\" />')\r\n            .parent()\r\n            .find('td > div')\r\n            .slideDown(700, function(){\r\n                $set = $(this);\r\n                $set.replaceWith($set.contents());\r\n            });\r\n\r\n        $(tr).find(\"td\").animate({backgroundColor: \"#004D16\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000, null, function() {$(this).css({backgroundColor: \"\"});});\r\n    }\r\n}\r\n\r\ntripwire.setReturnSig = function(event, sigToRemoveId) {\r\n\tevent.preventDefault();\r\n\tconst sigToUpdate = tripwire.signatures.returnSig;\r\n\tconst sigToRemove = tripwire.client.signatures[sigToRemoveId];\r\n\t\r\n\tif(!(sigToUpdate && sigToRemove)) { return; }\r\n\t\r\n\tsigDialog.overwriteSignature(sigToRemoveId, function(data) {\r\n\t\tsigToUpdate.signatureID = sigToRemove.signatureID;\r\n\t\t// we need the wormhole part to make refresh.php not think the sig isn't a wormhole any more\r\n\t\tconst payload = {\"signatures\": {\"update\": [ { wormhole: 'dummy', signatures: [ sigToUpdate ] } ] }};\r\n\t\ttripwire.refresh('refresh', payload);\r\n\t});\r\n}","// Handles API updates\r\ntripwire.API = function() {\r\n    this.indicator;\r\n    this.APIrefresh;\r\n\r\n    this.API.expire = function() {\r\n        var options = {since: tripwire.API.APIrefresh, until: null, format: \"MS\", layout: \"-{mnn}{sep}{snn}\"};\r\n        $(\"#APItimer\").countdown(\"option\", options);\r\n    }\r\n\r\n    this.API.refresh = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: false,\r\n            dataType: \"JSON\",\r\n            data: \"indicator=\"+tripwire.API.indicator\r\n        }).done(function(data) {\r\n            if (data && data.APIrefresh) {\r\n                tripwire.API.indicator = data.indicator;\r\n                tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n                activity.refresh(); //Refresh graph\r\n\r\n                var options = {until: tripwire.API.APIrefresh, since: null, layout: \"{mnn}{sep}{snn}\"};\r\n                $(\"#APItimer\").countdown(\"option\", options);\r\n                setTimeout(\"tripwire.API.refresh();\", $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30);\r\n            } else if ($(\"#APItimer\").countdown(\"option\", \"layout\") !== \"-{mnn}{sep}{snn}\" && $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) > 120) {\r\n                setTimeout(\"tripwire.API.refresh();\", ($.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30) * 1000);\r\n            } else {\r\n                setTimeout(\"tripwire.API.refresh();\", 15000);\r\n            }\r\n        });\r\n    }\r\n\r\n    this.API.init = function() {\r\n        $.ajax({\r\n            url: \"api_update.php\",\r\n            cache: true,\r\n            dataType: \"JSON\",\r\n            data: \"init=true\"\r\n        }).done(function(data) {\r\n            tripwire.API.indicator = data.indicator;\r\n            tripwire.API.APIrefresh = new Date(data.APIrefresh);\r\n\r\n            $(\"#APItimer\").countdown({until: tripwire.API.APIrefresh, onExpiry: tripwire.API.expire, alwaysExpire: true, compact: true, format: \"MS\", serverSync: tripwire.serverTime.getTime, onTick: function(t) { $(\"#APIclock\").val(t[5] + 1).trigger(\"change\"); }})\r\n            var timer = $(\"#APItimer\").countdown(\"option\", \"layout\") === \"-{mnn}{sep}{snn}\" ? 15 : $.countdown.periodsToSeconds($(\"#APItimer\").countdown('getTimes')) - 30;\r\n            setTimeout(\"tripwire.API.refresh();\", timer * 1000);\r\n        });\r\n    }\r\n\r\n    this.API.init();\r\n}\r\n// tripwire.API();\r\n","const automapState = {\r\n\tpendingDecision: false\r\n};\r\n\r\ntripwire.autoMapper = function(from, to) {\r\n\tconsole.log('Automapper: Jump from ' + from + ' to ' + to);\r\n\t\r\n    var pods = [33328, 670];\r\n    var undo = [];\r\n\r\n    // Make sure the automapper is turned on & not disabled\r\n    if (!$(\"#toggle-automapper\").hasClass(\"active\") || $(\"#toggle-automapper\").hasClass(\"disabled\"))\r\n        return false;\r\n\r\n\t// Not waiting on a decision for the previous jump\r\n\tif(automapState.pendingDecision) {\r\n\t\tconsole.info('Not automapping because there is an automap dialog up');\r\n\t\treturn false;\r\n\t}\r\n\r\n    // Make sure from and to are valid systems\r\n    if (!tripwire.systems[from] || !tripwire.systems[to])\r\n        return false;\r\n\r\n    // Make sure from and to are not the same system\r\n    if (from == to)\r\n        return false;\r\n\t\r\n\t// Not into a special region e.g. abyssal space\r\n\tif(tripwire.systems[from].regionID > 12000000 || tripwire.systems[to].regionID > 12000000) {\r\n\t\tconsole.info('Not automapping into abyssal or other special space');\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t// Not into a special system\r\n\tconst noMapSystems = [30000142, 30002187];\t// Jita/Amarr\r\n\tif(noMapSystems.indexOf(from) >= 0 || noMapSystems.indexOf(to) >= 0) {\t\r\n\t\tconsole.info('Not automapping into likely pod-out destination');\r\n\t\treturn false;\r\n\t}\r\n\r\n    // Is pilot in a station?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.stationID) {\r\n\t\tconsole.log('Automapper: Not recording because you are in a station');\r\n        return false;\r\n\t}\r\n\t\r\n    // Is pilot in a pod?\r\n    if (tripwire.client.EVE && tripwire.client.EVE.shipTypeID && $.inArray(parseInt(tripwire.client.EVE.shipTypeID), pods) >= 0) {\r\n    \tconsole.log('Automapper: Not recording because you are in a pod');\r\n\t\treturn false;\r\n\t}\r\n\t\r\n    // Is this a gate?\r\n    if (typeof(tripwire.map.shortest[from - 30000000]) != \"undefined\" && typeof(tripwire.map.shortest[from - 30000000][to - 30000000]) != \"undefined\") {\r\n\t\tconsole.log('Automapper: Not recording because this jump is a stargate');\r\n        return false;\r\n\t}\r\n\r\n     // Is this an existing connection?\r\n     if ($.map(tripwire.client.wormholes,\r\n               function(wormhole) {\r\n                 const initial = tripwire.client.signatures[wormhole.initialID];\r\n                 const secondary = tripwire.client.signatures[wormhole.secondaryID];\r\n                 return initial && secondary &&\r\n                   ((initial.systemID == from && secondary.systemID == to) ||\r\n                    (initial.systemID == to && secondary.systemID == from))  ? wormhole : null;\r\n               }).length > 0) {\r\n\t\tconsole.log('Automapper: Not recording because the connection exists');\r\n       return false;\r\n     }\r\n\t \r\n\t // Are both systems already in chain? Loops do happen but it's much more likely ESI missed a jump\r\n\t function inChain(systemID) { return chain.data.map.rows.filter(r => r.c[0].systemID == systemID).length > 0; }\r\n\tif(inChain(from) && inChain(to)) {\r\n\t\tconsole.info('Not automapping because both systems are already in chain');\r\n\t\treturn false;\r\n\t}\t \r\n\r\n    var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"automap\": { \"character\": tripwire.client.EVE.characterID } };\r\n\r\n    var wormholes = wormholesForJump(from, to, tripwire.client.wormholes, tripwire.client.signatures);\r\n\t\r\n    if (wormholes.length) {\r\n        if (wormholes.length > 1) {\r\n\t\t\tconsole.log('Automapper: Multiple sigs matched, asking which one to update');\r\n            $(\"#dialog-select-signature\").dialog({\r\n                autoOpen: true,\r\n                title: \"Which Signature?\",\r\n                width: 390,\r\n                buttons: {\r\n                    Cancel: function() {\r\n                        $(this).dialog(\"close\");\r\n                    },\r\n                    Ok: function() {\r\n                        var i = $(\"#dialog-select-signature [name=sig]:checked\").val();\r\n                        var wormhole = wormholes[i];\r\n                        var signature = tripwire.client.signatures[wormhole.initialID];\r\n                        var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id\r\n                                },\r\n                                {\r\n                                    \"id\": signature2.id,\r\n                                    \"systemID\": to\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        var success = function(data) {\r\n                            if (data.resultSet && data.resultSet[0].result == true) {\r\n                                undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n                                $(\"#dialog-select-signature\").dialog(\"close\");\r\n                            }\r\n                        }\r\n\r\n                        tripwire.refresh('refresh', payload, success);\r\n                    }\r\n                },\r\n                open: function() {\r\n\t\t\t\t\tautomapState.pendingDecision = true;\r\n                    $(\"#dialog-select-signature .optionsTable tbody\").empty();\r\n\t\t\t\t\t\r\n\t\t\t\t\tfunction formatSystem(systemID) {\r\n\t\t\t\t\t\tconst system = systemAnalysis.analyse(systemID);\r\n\t\t\t\t\t\treturn systemRendering.renderSystem(system);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tdocument.getElementById('select-sig-from').innerHTML = formatSystem(from);\r\n\t\t\t\t\tdocument.getElementById('select-sig-to').innerHTML = formatSystem(to);\r\n\r\n                    $.each(wormholes, function(i) {\r\n                        const signature = tripwire.client.signatures[wormholes[i].initialID];\r\n\t\t\t\t\t\tconst sigInfo = tripwire.makeSigInfo(signature, wormholes[i]);\r\n\t\t\t\t\t\t\r\n                        const tr = \"<tr>\"\r\n                          + \"<td><input type='radio' name='sig' value='\"+i+\"' id='sig\"+i+\"' /></td>\"\r\n\t\t\t\t\t\t  + \"<td class='centerAlign'>\" + formatSignatureID(signature.signatureID) + \"</td>\"\r\n\t\t\t\t\t\t  + \"<td class='centerAlign'>\" + sigInfo.formattedType + \"</td>\"\r\n\t\t\t\t\t\t  + \"<td class='centerAlign'>\" + sigInfo.leadsTo + \"</td>\"\r\n\t\t\t\t\t\t  + \"<td class='centerAlign \" + wormholes[i].life + \"'>\" + sigInfo.lifeText + \"</td>\"\r\n\t\t\t\t\t\t  + \"<td class='centerAlign \" + wormholes[i].mass + \"'>\" + wormholes[i].mass + \"</td>\"\r\n                          + \"</tr>\";\r\n\t\t\t\t\t\t  \r\n\t\t\t\t\t\tconst trElem = $(tr);\r\n                        $(trElem).find('td').wrapInner(\"<label for='sig\"+i+\"' />\");\r\n                        $(\"#dialog-select-signature .optionsTable tbody\").append(trElem);\r\n                    });\r\n                }, close: function() {\r\n\t\t\t\t\tautomapState.pendingDecision = false;\r\n\t\t\t\t}\r\n            });\r\n        } else {\r\n            var wormhole = wormholes[0];\r\n            var signature = tripwire.client.signatures[wormhole.initialID];\r\n            var signature2 = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\tconsole.log('Automapper: Single signature: w=' + JSON.stringify(wormhole) + ' s1=' + signature.id + '/' + signature.signatureID + ' s2=' + signature2.id + '/' + signature2.signatureID );\r\n\r\n            payload.signatures.update.push({\r\n                \"wormhole\": {\r\n                    \"id\": wormhole.id\r\n                },\r\n                \"signatures\": [\r\n                    {\r\n                        \"id\": signature.id\r\n                    },\r\n                    {\r\n                        \"id\": signature2.id,\r\n                        \"systemID\": to\r\n                    }\r\n                ]\r\n            });\r\n            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, signature2]});\r\n        }\r\n    } else {\r\n        // Nothing matches, create a new wormhole\r\n\t\tconsole.log('Automapper: No signatures match, creating a new unknown hole');\r\n        payload.signatures.add.push({\r\n            \"wormhole\": {\r\n                \"type\": null,\r\n                \"parent\": \"initial\",\r\n                \"life\": \"stable\",\r\n                \"mass\": \"stable\"\r\n            },\r\n            \"signatures\": [\r\n                {\r\n                    \"systemID\": from,\r\n                    \"type\": \"wormhole\"\r\n                },\r\n                {\r\n                    \"systemID\": to,\r\n                    \"type\": \"wormhole\"\r\n                }\r\n            ]\r\n        });\r\n    }\r\n\r\n    if (payload.signatures.add.length || payload.signatures.update.length) {\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                if (data.results) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                    }\r\n                }\r\n\r\n                if (undo.length) {\r\n                    if (viewingSystemID in tripwire.signatures.undo) {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', payload, success);\r\n    }\r\n}\r\n\r\nfunction wormholesForJump(from, to, wormholes, signatures) {\r\n\tconst toSystem = systemAnalysis.analyse(to);\r\n    const toType = toSystem.genericSystemType[0];\r\n\tconst toClass = (toSystem.class || [])[0];\r\n\treturn Object.values(wormholes).filter(function(wormhole) {\r\n        if ( ( signatures[wormhole.initialID] !== undefined ) && ( signatures[wormhole.secondaryID] !== undefined ) ) {\r\n            // Find wormholes that have no set Leads To system, and their initial system is from the wormhole we just jumped from\r\n            if (signatures[wormhole.initialID].systemID == from && !appData.systems[signatures[wormhole.secondaryID].systemID]) {\r\n\t\t\t\tconst holeTargetTypeName = appData.genericSystemTypes[signatures[wormhole.secondaryID].systemID];\r\n\t\t\t\tconst holeClasses = systemAnalysis.classForTypeName(holeTargetTypeName);\r\n\t\t\t\tif(holeTargetTypeName === toType) {\r\n\t\t\t\t\t// Find wormholes where Leads To is the type we jumped into\r\n\t\t\t\t\treturn true;\r\n                } else if (holeClasses && 0 <= holeClasses.indexOf(toClass)) {\r\n                    // Find wormholes that Leads To is generically set to the class we just jumped into\r\n                    return true;\r\n                } else if (wormhole.type && appData.wormholes[wormhole.type] && appData.wormholes[wormhole.type].leadsTo == toType) {\r\n                    // Find wormholes that Type is known to lead to the class we just jumped into\r\n                    return true;\r\n                } else if (signatures[wormhole.secondaryID].systemID === null && (!wormhole.type || !appData.wormholes[wormhole.type])) {\r\n                    // Find wormholes that don't have a Type or any kind of Leads To entered\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\t","$(\"body\").on(\"dblclick\", \".comment\", function(e) {\r\n\te.preventDefault();\r\n\tdocument.getSelection().removeAllRanges();\r\n\t$(this).find(\".commentEdit\").click();\r\n})\r\n\r\n$(\"body\").on(\"click\", \".commentEdit\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t$comment.find(\".commentToolbar\").hide();\r\n\r\n\tCKEDITOR.replace($comment.find(\".commentBody\").attr(\"id\"), CKConfig).on(\"instanceReady\", function() {\r\n\t\t$comment.find(\".commentStatus\").html(\"\");\r\n\t\t$comment.find(\".commentFooter\").show();\r\n\t\t$comment.find(\".commentFooter .commentControls\").show();\r\n\t});\r\n\r\n\ttripwire.activity.editComment = $comment.data(\"id\");\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSave, .commentCancel\", function(e) {\r\n\te.preventDefault();\r\n\tvar $this = $(this);\r\n\tif ($this.attr(\"disabled\")) return false;\r\n\r\n\tvar $comment = $this.closest(\".comment\");\r\n\t$this.attr(\"disabled\", \"true\");\r\n\r\n\tif ($this.hasClass(\"commentSave\")) {\r\n\t\tvar data = {\"mode\": \"save\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? 0 : viewingSystemID, \"comment\": CKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].getData()};\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: \"comments.php\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: data,\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data) {\r\n\t\t\tif (data && data.result == true) {\r\n\t\t\t\t$comment.find(\".commentModified\").html(\"Edited by \" + data.comment.modifiedByName + \" at \" + data.comment.modifiedDate);\r\n\t\t\t\t$comment.find(\".commentCreated\").html(\"Posted by \" + data.comment.createdByName + \" at \" + data.comment.createdDate);\r\n\t\t\t\tTooltips.attach($comment.find(\"[data-tooltip]\"));\r\n\r\n\t\t\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(false);\r\n\t\t\t\t$comment.attr(\"data-id\", data.comment.id);\r\n\t\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tCKEDITOR.instances[$comment.find(\".commentBody\").attr(\"id\")].destroy(true);\r\n\r\n\t\tif (!$comment.attr(\"data-id\")) {\r\n\t\t\t$comment.remove();\r\n\t\t} else {\r\n\t\t\t$comment.find(\".commentToolbar\").show();\r\n\t\t\t$comment.find(\".commentFooter\").hide();\r\n\t\t\t$this.removeAttr(\"disabled\");\r\n\t\t}\r\n\t}\r\n\r\n\t$comment.find(\".commentStatus\").html(\"\");\r\n\r\n\tdelete tripwire.activity.editComment;\r\n\ttripwire.refresh('refresh');\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentDelete\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteComment\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#notesWidget\")},\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar $comment = $(this).data(\"comment\");\r\n\t\t\t\t\tvar data = {\"mode\": \"delete\", \"commentID\": $comment.data(\"id\")};\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"comments.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\t\tif (data && data.result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteComment\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$comment.remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t$(\"#dialog-deleteComment\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteComment\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteComment\").data(\"comment\", $comment).dialog(\"open\");\r\n\t}\r\n});\r\n\r\n$(\"body\").on(\"click\", \"#add-comment\", function(e) {\r\n\te.preventDefault();\r\n\r\n\t// Prevent multiple editors\r\n\tif ($(\".cke\").length) return false;\r\n\r\n\tvar $comment = $(\".comment:last\").clone();\r\n\tvar commentID = $(\".comment:visible:last .commentBody\").attr(\"id\") ? $(\".comment:visible:last .commentBody\").attr(\"id\").replace(\"comment\", \"\") + 1 : 0;\r\n\t$(\".comment:last\").before($comment);\r\n\r\n\t$comment.find(\".commentBody\").attr(\"id\", \"comment\" + commentID);\r\n\t$comment.removeClass(\"hidden\").find(\".commentEdit\").click();\r\n});\r\n\r\n$(\"body\").on(\"click\", \".commentSticky\", function(e) {\r\n\te.preventDefault();\r\n\tvar $comment = $(this).closest(\".comment\");\r\n\r\n\tvar data = {\"mode\": \"sticky\", \"commentID\": $comment.data(\"id\"), \"systemID\": $comment.find(\".commentSticky\").hasClass(\"active\") ? viewingSystemID : 0};\r\n\r\n\t$.ajax({\r\n\t\turl: \"comments.php\",\r\n\t\ttype: \"POST\",\r\n\t\tdata: data,\r\n\t\tdataType: \"JSON\"\r\n\t}).done(function(data) {\r\n\t\tif (data && data.result == true) {\r\n\t\t\t$comment.find(\".commentSticky\").hasClass(\"active\") ? $comment.find(\".commentSticky\").removeClass(\"active\") : $comment.find(\".commentSticky\").addClass(\"active\");\r\n\t\t}\r\n\t});\r\n});\r\n\r\nfunction commentSortHandler(sortOrder) {\r\n\tconst sortElem = document.getElementById('comment-sort');\r\n\tconst containerElem = document.getElementById('comment-container');\r\n\tsortOrder = sortOrder || sortElem.nextSort || tripwire.cookies.getCookie('commentSort') || 'asc';\r\n\t\r\n\tswitch(sortOrder) {\r\n\t\tcase 'asc':\r\n\t\t\tsortElem.nextSort = 'desc';\r\n\t\t\tsortElem.setAttribute('data-icon', 'sort-asc');\r\n\t\t\tcontainerElem.style.flexDirection = 'column';\r\n\t\t\tbreak;\r\n\t\tcase 'desc':\r\n\t\t\tsortElem.nextSort = 'asc';\r\n\t\t\tsortElem.setAttribute('data-icon', 'sort-desc');\r\n\t\t\tcontainerElem.style.flexDirection = 'column-reverse';\r\n\t\t\tbreak;\r\n\t\tdefault: throw 'sort order somehow wrong';\r\n\t}\r\n\t\r\n\ttripwire.cookies.setCookie('commentSort', sortOrder, 3650);\r\n}\r\n\r\n$(\"body\").on(\"click\", \"#comment-sort\", function(e) {\r\n\tcommentSortHandler(undefined);\r\n});\r\n\r\ncommentSortHandler();","// Handles removing from Signatures section\r\ntripwire.deleteSig = function(key) {\r\n    var tr = $(\"#sigTable tr[data-id='\"+key+\"']\");\r\n\r\n    //Append empty space to prevent non-coloring\r\n    $(tr).find('td:empty, a:empty').append(\"&nbsp;\");\r\n\r\n    $(tr)\r\n        .find('td')\r\n        .wrapInner('<div />')\r\n        .parent()\r\n        .find('td > div').animate({backgroundColor: \"#4D0000\"}, 1000).delay(1000).animate({backgroundColor: \"#111\"}, 1000)\r\n        .slideUp(700, function(){\r\n            // Remove countdown reference\r\n            $(tr).find('span[data-age]').countdown(\"destroy\");\r\n\r\n            $(this).parent().parent().remove();\r\n            $(\"#sigTable\").trigger(\"update\");\r\n        });\r\n}\r\n","// Handles changing Signatures section\r\n// ToDo: Use native JS\r\ntripwire.editSig = function(edit, disabled) {\r\n    var disabled = disabled || false;\r\n    var wormhole = {};\r\n\r\n    if (edit.type == \"wormhole\") {\r\n\t\tconst sigInfo = tripwire.makeSigInfo(edit);\t// see addSignature.js\r\n\t\tif(!sigInfo) return false;\r\n\t\t\r\n\t\twormhole = sigInfo.wormhole;\r\n\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+formatSignatureID(edit.signatureID)+\"</td>\"\r\n            + \"<td class='type-tooltip \"+ options.signatures.alignment.sigType +\"' data-tooltip=\\\"\"+this.whTooltip(wormhole)+\"\\\">\"+sigInfo.formattedType+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"'>\"+(sigInfo.leadsTo || \"\")+\"</td>\"\r\n            + \"<td class='\"+wormhole.life+\" \"+ options.signatures.alignment.sigLife +\"'>\"+sigInfo.lifeText+\"</td>\"\r\n            + \"<td class='\"+wormhole.mass+\" \"+ options.signatures.alignment.sigMass +\"'>\"+wormhole.mass+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    } else {\r\n        var row = \"<tr data-id='\"+edit.id+\"' data-tooltip='' \"+ (disabled ? 'disabled=\"disabled\"' : '') +\">\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigID +\"'>\"+formatSignatureID(edit.signatureID)+\"</td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.sigType +\"'>\"+edit.type+\"</td>\"\r\n            + \"<td class='age-tooltip \"+ options.signatures.alignment.sigAge + (parseInt(edit.lifeLength) === 0 ? \" disabled\" : \"\") +\"' data-tooltip='\"+this.ageTooltip(edit)+\"'><span data-age='\"+edit.lifeTime+\"'></span></td>\"\r\n            + \"<td class='\"+ options.signatures.alignment.leadsTo +\"' colspan='3'>\"+(edit.name?linkSig(edit.name):'')+\"</td>\"\r\n            + \"</tr>\";\r\n\r\n        var tr = $(row);\r\n    }\r\n\r\n    Tooltips.attach($(tr).find(\"[data-tooltip]\"));\r\n\r\n    // Destroy the pervious countdown to prevent errors on a non-existant DOM element\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").find('span[data-age]').countdown(\"destroy\");\r\n    $(\"#sigTable tr[data-id='\"+edit.id+\"']\").replaceWith(tr);\r\n\r\n    $(\"#sigTable\").trigger(\"update\");\r\n    // Update counter\r\n    if (wormhole.life == \"critical\") {\r\n        $(tr).find('span[data-age]').countdown({until: moment.utc(edit.lifeLeft).toDate(), onExpiry: this.pastEOL, alwaysExpire: true, compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime})\r\n            .addClass('critical');\r\n    } else {\r\n        $(tr).find('span[data-age]').countdown({since: moment.utc(edit.lifeTime).toDate(), compact: true, format: this.ageFormat, serverSync: this.serverTime.getTime});\r\n    }\r\n\r\n    $(tr).effect(\"pulsate\");\r\n}\r\n","tripwire.esi = function() {\r\n    var baseUrl = \"https://esi.evetech.net\";\r\n    var userAgent = \"Tripwire Client \" + tripwire.version + \" (\" + window.location.hostname + \") - \" + window.navigator.userAgent;\r\n    var locationTimer, shipTimer, onlineTimer;\r\n    this.esi.connection = true;\r\n    this.esi.characters = {};\r\n    this.esi.oauth = { subject: \"\", accessToken: \"\"};\r\n\r\n    var scopeError = function(characterID) {\r\n        $(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").find(\".alert\").show();\r\n    }\r\n\r\n\tvar isExpired = function(tokenExpire) {\r\n\t\treturn moment.utc(tokenExpire).subtract(5, \"minutes\").isBefore(moment());\r\n\t}\r\n\r\n\tfunction updateTracking(character) {\r\n\t\t// Send to Tripwire server on next refresh call\r\n\t\ttripwire.data.tracking[character.characterID] = {\r\n\t\t\tcharacterID: character.characterID,\r\n\t\t\tcharacterName: character.characterName,\r\n\t\t\tsystemID: character.systemID,\r\n\t\t\tsystemName: character.systemName,\r\n\t\t\tstationID: character.stationID,\r\n\t\t\tstationName: character.stationName,\r\n\t\t\tshipID: character.shipID,\r\n\t\t\tshipName: character.shipName,\r\n\t\t\tshipTypeID: character.shipTypeID,\r\n\t\t\tshipTypeName: character.shipTypeName,\r\n\t\t\tmassOptions: tripwire.massOptions,\r\n\t\t\tcharacterOptions: options.tracking.characterOptions[character.characterID]\r\n\t\t};\t\t\t\t\r\n\t}\r\n\tthis.esi.updateTracking = updateTracking;\t// so it can be called outside\r\n\r\n    this.esi.location = function() {\r\n        clearTimeout(locationTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            const xhr = $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/location/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, jqXHR) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.locationDate = moment(jqXHR.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.systemID != data.solar_system_id) {\r\n                        character.systemID = data.solar_system_id || null;\r\n\t\t\t\t\t\tconst system = systemAnalysis.analyse(data.solar_system_id);\r\n                        character.systemName = system ? system.name : null;\r\n\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".system\").html(systemRendering.renderSystem(system) || \"&nbsp;\");\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tupdateTracking(character);\r\n                    }\r\n\r\n                    if (character.stationID != data.station_id) {\r\n                        character.stationID = data.station_id || null;\r\n\r\n                        if (data.station_id) {\r\n                            tripwire.esi.stationLookup(data.station_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.stationName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".station\").html(data.name.substring(0, 17) + \"...\" || \"&nbsp;\").attr(\"data-tooltip\", data.name);\r\n                                    Tooltips.attach($(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"'] .station[data-tooltip]\"));\r\n\r\n                                    updateTracking(character);\r\n                                });\r\n                        } else {\r\n                            character.stationName = null;\r\n                            // $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".station\").html(\"&nbsp;\").attr(\"data-tooltip\", \"&nbsp;\");\r\n                            Tooltips.detach($(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"'] .station[data-tooltip]\"));\r\n\t\t\t\t\t\t\tupdateTracking(character);\r\n                        }\r\n                    }\r\n\r\n                    if (options.tracking.active == this.characterID) {\r\n                        tripwire.EVE(tripwire.esi.characters[options.tracking.active]);\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, jqXHR) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n            xhr.always(function(){\r\n                const warn = xhr.getResponseHeader('warning');\r\n                if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n            });\r\n        }\r\n\r\n        locationTimer = setTimeout(\"tripwire.esi.location()\", 5000);\r\n    }\r\n\r\n    this.esi.ship = function() {\r\n        clearTimeout(shipTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            // Check for expiring token\r\n            if (isExpired(character.tokenExpire)) {\r\n                tripwire.data.esi = {\"expired\": true};\r\n                continue;\r\n            }\r\n\r\n            const xhr = $.ajax({\r\n                url: baseUrl + \"/v1/characters/\"+ characterID +\"/ship/?\" + $.param({\"token\": character.accessToken, \"user_agent\": userAgent}),\r\n                // headers: {\"Authorization\": \"Bearer \"+ character.accessToken, \"X-User-Agent\": userAgent},\r\n                type: \"GET\",\r\n                dataType: \"JSON\",\r\n                characterID: characterID\r\n            }).done(function(data, status, jqXHR) {\r\n                var character = tripwire.esi.characters[this.characterID];\r\n\r\n                if (character) {\r\n                    character.shipDate = moment(jqXHR.getResponseHeader(\"last-modified\"), \"ddd, DD MMMM YYYY HH:mm:ss\").format();\r\n\r\n                    if (character.shipID != data.ship_item_id) {\r\n                        character.shipID = data.ship_item_id || null;\r\n\t\t\t\t\t\ttripwire.resetMassOptions();\r\n\t\t\t\t\t\tupdateTracking(character);\r\n                    }\r\n\r\n                    if (character.shipName != data.ship_name) {\r\n                        character.shipName = data.ship_name || null;\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".shipname\").html(data.ship_name || \"&nbsp;\");\r\n\t\t\t\t\t\tupdateTracking(character);\r\n                    }\r\n\r\n                    if (character.shipTypeID != data.ship_type_id) {\r\n                        character.shipTypeID = data.ship_type_id || null;\r\n\r\n                        if (data.ship_type_id) {\r\n                            tripwire.esi.typeLookup(data.ship_type_id, this.characterID)\r\n                                .always(function(data) {\r\n                                    var character = tripwire.esi.characters[this.reference];\r\n\r\n                                    character.shipTypeName = data.name || null;\r\n                                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference +\"']\").find(\".ship\").html(data.name || \"&nbsp;\");\r\n\t\t\t\t\t\t\t\t\tupdateTracking(character);\r\n                                });\r\n                        } else {\r\n                            character.shipTypeName = null;\r\n                            $(\"#tracking .tracking-clone[data-characterid='\"+ this.characterID +\"']\").find(\".ship\").html(\"&nbsp;\");\r\n\t\t\t\t\t\t\tupdateTracking(character);\r\n                        }\r\n                    }\r\n                }\r\n            }).fail(function(data) {\r\n                if (data.status == 403) {\r\n                    tripwire.refresh(\"refresh\", {\"esi\": {\"expired\": true}});\r\n                }\r\n            }).always(function(data, status, jqXHR) {\r\n                if (status != \"success\" && status != \"abort\" && tripwire.esi.connection == true) {\r\n                    tripwire.esi.connection = false;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Failed\", \"red\", false, \"esiConnectionError\");\r\n                } else if (status == \"success\" && tripwire.esi.connection == false) {\r\n                    tripwire.esi.connection = true;\r\n                    $(\"#esiConnectionSuccess, #esiConnectionError\").click();\r\n                    Notify.trigger(\"ESI Connection Resumed\", \"green\", 5000, \"esiConnectionSuccess\");\r\n                }\r\n            });\r\n            xhr.always(function(){\r\n                const warn = xhr.getResponseHeader('warning');\r\n                if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n            });\r\n\r\n        }\r\n\r\n        shipTimer = setTimeout(\"tripwire.esi.ship()\", 5000);\r\n    }\r\n\r\n    this.esi.online = function() {\r\n        clearTimeout(onlineTimer);\r\n\r\n        for (characterID in tripwire.esi.characters) {\r\n            var character = tripwire.esi.characters[characterID];\r\n\r\n            tripwire.esi.characterStatus(character.characterID, character)\r\n                .done(function(data) {\r\n                    if (data.online) {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"critical\").addClass(\"stable\");\r\n                    } else {\r\n                        $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                    }\r\n                }).fail(function(data) {\r\n                    if (data && data.status == 403) {\r\n                        scopeError(this.reference.characterID);\r\n                    }\r\n                    $(\"#tracking .tracking-clone[data-characterid='\"+ this.reference.characterID +\"']\").find(\".online\").removeClass(\"stable\").addClass(\"critical\");\r\n                });\r\n        }\r\n\r\n        onlineTimer = setTimeout(\"tripwire.esi.online()\", 60000);\r\n    }\r\n\r\n    this.esi.typeLookup = function(typeID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v3/universe/types/\"+ typeID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.stationLookup = function(stationID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/stations/\"+ stationID +\"/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.setDestination = function(destinationID, characterID, clear_waypoints, beginning) {\r\n        clear_waypoints = clear_waypoints ? clear_waypoints : false;\r\n        beginning = beginning ? beginning : false;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/ui/autopilot/waypoint/?\" + $.param({destination_id: destinationID, clear_other_waypoints: clear_waypoints, add_to_beginning: beginning}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.showInfo = function(targetID, characterID) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/ui/openwindow/information/?\" + $.param({target_id: targetID}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"POST\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.characterStatus = function(characterID, reference) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/characters/\" + characterID + \"/online/?\" + $.param({\"token\": tripwire.esi.characters[characterID].accessToken, \"user_agent\": userAgent}),\r\n            // headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.characters[characterID].accessToken, \"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.eveStatus = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/status/?\" + $.param({\"user_agent\": userAgent}),\r\n            // headers: {\"X-User-Agent\": userAgent},\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.idLookup = function(eveIDs) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/names/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"POST\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            processData: false,\r\n            data: JSON.stringify(eveIDs)\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.characterLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/latest/characters/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.corporationLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v4/corporations/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.allianceLookup = function(eveID, reference, async) {\r\n        var async = typeof(async) !== 'undefined' ? async : true;\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v3/alliances/\" + eveID + \"/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            async: async,\r\n            eveID: eveID,\r\n            reference: reference\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.search = function(searchString, categories, strict) {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/latest/characters/\" + tripwire.esi.oauth.subject + \"/search/?\" + $.param({\"user_agent\": userAgent}),\r\n            headers: {\"Authorization\": \"Bearer \"+ tripwire.esi.oauth.accessToken},\r\n            type: \"GET\",\r\n            dataType: \"JSON\",\r\n            contentType: \"application/json\",\r\n            data: {\"search\": searchString, \"categories\": categories, \"strict\": strict}\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.universeJumps = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v1/universe/system_jumps/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    this.esi.universeKills = function() {\r\n        const xhr = $.ajax({\r\n            url: baseUrl + \"/v2/universe/system_kills/?\" + $.param({\"user_agent\": userAgent}),\r\n            type: \"GET\",\r\n            dataType: \"JSON\"\r\n        });\r\n        return xhr.always(function(){\r\n            const warn = xhr.getResponseHeader('warning');\r\n            if (warn) console.warn('ESI API Warning: ', warn, this.url);\r\n        });\r\n    }\r\n\r\n    // Wrapper to make lookups easier\r\n    this.esi.fullLookup = function(eveIDs) {\r\n        var promise = $.Deferred();\r\n\r\n        tripwire.esi.idLookup(eveIDs)\r\n            .done(function(data) {\r\n                for (item in data) {\r\n                    if (data[item].category == \"character\") {\r\n                        tripwire.esi.characterLookup(data[item].id, data[item], false)\r\n                            .done(function(characterData) {\r\n                                $.extend(data[item], characterData);\r\n                                tripwire.esi.corporationLookup(characterData.corporation_id, this.reference, false)\r\n                                    .done(function(corporationData) {\r\n                                        data[item].corporation = corporationData;\r\n                                        if (corporationData.alliance_id) {\r\n                                            tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                                .done(function(allianceData) {\r\n                                                    data[item].alliance = allianceData;\r\n                                                });\r\n                                        }\r\n                                    });\r\n                            });\r\n                    } else if (data[item].category == \"corporation\") {\r\n                        tripwire.esi.corporationLookup(data[item].id, data[item], false)\r\n                            .done(function(corporationData) {\r\n                                $.extend(data[item], corporationData);\r\n                                if (corporationData.alliance_id) {\r\n                                    tripwire.esi.allianceLookup(corporationData.alliance_id, this.reference, false)\r\n                                        .done(function(allianceData) {\r\n                                            data[item].alliance = allianceData;\r\n                                        });\r\n                                }\r\n                            })\r\n                    }\r\n                }\r\n\r\n                promise.resolve(data);\r\n            });\r\n\r\n        return promise;\r\n    }\r\n\r\n    // Parse main account oauth information out of refresh data. This is used\r\n    // to make authenticated ESI requests for enpoints that are not specific to\r\n    // tracking characters, e.g., mask access management.\r\n    this.esi.parseOauth = function(data) {\r\n        const _data = data || {}\r\n        tripwire.esi.oauth = {\r\n            subject: _data.subject,\r\n            accessToken: _data.accessToken\r\n        };\r\n    }\r\n\r\n    this.esi.parse = function(characters) {\r\n        for (characterID in tripwire.esi.characters) {\r\n            if (!(characterID in characters)) {\r\n                delete tripwire.esi.characters[characterID];\r\n                tracking.remove(characterID);\r\n                if (options.tracking.active == characterID) {\r\n                    tripwire.EVE(false, true);\r\n                    $(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n                }\r\n            }\r\n        }\r\n\r\n        for (characterID in characters) {\r\n            if (options.tracking.active == \"new\") {\r\n                options.tracking.active = characterID;\r\n            }\r\n\r\n            if (!(characterID in tripwire.esi.characters)) {\r\n                var $clone = tracking.add(characters[characterID]);\r\n\t\t\t\t\r\n                if (options.tracking.active == characterID) {\r\n                    $clone.addClass(\"active\");\r\n                    $(\"#removeESI\").removeAttr(\"disabled\");\r\n                }\r\n\r\n            }\r\n\r\n            tripwire.esi.characters[characterID] = characters[characterID];\r\n        }\r\n\t\t\r\n\t\tset_tracking_text();\r\n\r\n        tripwire.esi.ship();\r\n        tripwire.esi.location();\r\n        tripwire.esi.online();\r\n    }\r\n}\r\ntripwire.esi();\r\n","// Handles data from EVE in-game data\r\ntripwire.EVE = function(EVE, characterChange) {\r\n    var systemChange = this.client.EVE && this.client.EVE.systemChange || false;\r\n\r\n    if (EVE) {\r\n        // Automapper\r\n        if (!characterChange) {\r\n            // Did the system change or did it previously and we have yet to try an autoMapper call?\r\n            if ((this.client.EVE && this.client.EVE.systemID != EVE.systemID) || systemChange == true) {\r\n                systemChange = true;\r\n\r\n                // Check if location was updated after the last ship update\r\n                // if (moment(EVE.locationDate).isAfter(moment(this.client.EVE.shipDate))) {\r\n                    systemChange = false;\r\n                    tripwire.autoMapper(this.client.EVE.systemID, EVE.systemID);\r\n                // }\r\n            }\r\n        }\r\n\r\n        // System follower\r\n        if (!characterChange && options.buttons.follow && (this.client.EVE && this.client.EVE.systemID != EVE.systemID) && $(\".ui-dialog:visible\").length == 0) {\r\n            tripwire.systemChange(EVE.systemID);\r\n        }\r\n\r\n        if (!$(\"#search\").hasClass(\"active\")) {\r\n            $(\"#currentSpan\").show();\r\n        }\r\n\r\n        // Enable auto-mapper\r\n        $(\"#toggle-automapper\").removeClass(\"disabled\");\r\n\r\n        // Update current system\r\n        if (EVE.systemID) {\r\n            // add system to Leads To dropdown\r\n            if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n                $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"addToSelect\", tripwire.systems[EVE.systemID]);\r\n            }\r\n            $(\"#EVEsystem\").html(systemRendering.renderSystem(systemAnalysis.analyse(EVE.systemID)));\r\n        }\r\n    } else {\r\n        // Update current system\r\n        $(\"#EVEsystem\").html(\"Not tracking\");\r\n        $(\"#currentSpan\").hide();\r\n        // Disable automapper\r\n        $(\"#toggle-automapper\").addClass(\"disabled\");\r\n        // remove system from Leads To dropdown\r\n        if ($(\"#dialog-signature [data-autocomplete='sigSystems']\").hasClass(\"custom-combobox\")) {\r\n            $(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete(\"removeFromSelect\");\r\n        }\r\n    }\r\n\r\n    this.client.EVE = {\r\n        characterID: EVE.characterID,\r\n        characterName: EVE.characterName,\r\n        systemID: EVE.systemID,\r\n        systemName: EVE.systemName,\r\n        shipTypeID: EVE.shipTypeID,\r\n        shipTypeName: EVE.shipTypeName,\r\n        stationID: EVE.stationID,\r\n        stationName: EVE.stationName,\r\n        locationDate: EVE.locationDate,\r\n        shipDate: EVE.shipDate,\r\n        systemChange: systemChange\r\n    };\r\n}\r\n","appData.genericSystemTypes = [\r\n\t\"Null-Sec\", \"Low-Sec\", \"High-Sec\",\r\n\t\"Class-1\", \"Class-2\", \"Class-3\", \"Class-4\", \"Class-5\", \"Class-6\", \"Class-13\", \r\n\t\"Triglavian\",\r\n\t\"Unknown\", \"Unknown (small)\", \"Dangerous\",\r\n\t\"Class-14\", \"Class-15\", \"Class-16\", \"Class-17\", \"Class-18\", \r\n\t];","tripwire.parse = function(server, mode) {\r\n    var data = $.extend(true, {}, server);\r\n\r\n    var updateSignatureTable = false;\r\n\tconst newSigsInSystem = { };\r\n\r\n    if (options.chain.active == null || (options.chain.tabs[options.chain.active] && options.chain.tabs[options.chain.active].evescout != true)) {\r\n        if (options.masks.active != \"273.0\") {\r\n            for (var key in data.signatures) {\r\n                if (data.signatures[key].mask == \"273.0\") {\r\n                    delete data.signatures[key];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (mode == 'refresh') {\r\n        // preserve client.EVE across refresh otherwise tracking/automapper will be confused\r\n        var EVE = this.client.EVE;\r\n        this.client = server;\r\n        this.client.EVE = EVE;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n\t\t\tnewSigsInSystem[key] = data.signatures[key];\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\r\n            // Check for differences\r\n            if (!tripwire.signatures.list[key]) {\r\n\t\t\t\ttripwire.signatures.list[key] = data.signatures[key];\t// To reduce race condition chance\r\n                this.addSig(data.signatures[key], {animate: true}, disabled);\r\n                updateSignatureTable = true;\r\n            } else if (tripwire.signatures.list[key].modifiedTime !== data.signatures[key].modifiedTime) {\r\n                var edit = false;\r\n                for (column in data.signatures[key]) {\r\n                    if (data.signatures[key][column] != tripwire.signatures.list[key][column] && column != \"editing\") {\r\n                        edit = true;\r\n                    }\r\n                }\r\n\r\n                if (edit) {\r\n                    this.editSig(data.signatures[key], disabled);\r\n                } else {\r\n                    // this.sigEditing(data.signatures[key]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Sigs needing removal\r\n        for (var key in tripwire.signatures.list) {\r\n            if (!data.signatures[key]) {\r\n                this.deleteSig(key);\r\n            }\r\n        }\r\n    } else if (mode == 'init' || mode == 'change') {\r\n        this.client = server;\r\n\r\n        for (var key in data.signatures) {\r\n            if (data.signatures[key].systemID != viewingSystemID) {\r\n                continue;\r\n            }\r\n\t\t\tnewSigsInSystem[key] = data.signatures[key];\r\n            var disabled = data.signatures[key].mask == \"273.0\" && options.masks.active != \"273.0\" ? true : false;\r\n\t\t\t\r\n\t\t\tif(!tripwire.signatures.list[key]) {\r\n\t\t\t\tthis.addSig(data.signatures[key], {animate: false}, disabled);\r\n\t\t\t\tupdateSignatureTable = true;\r\n\t\t\t}\r\n            if (data.signatures[key].editing) {\r\n                this.sigEditing(data.signatures[key]);\r\n            }\r\n        }\r\n    } else { return; }\t// unknown type of parse request so do nothing\r\n\r\n    if (updateSignatureTable) {\r\n        $(\"#sigTable\").trigger(\"update\");\r\n    }\r\n    tripwire.signatures.list = data.signatures;\r\n\ttripwire.signatures.currentSystem = newSigsInSystem;\r\n\t\t\r\n    // set the sig count in the UI\r\n    var signatureCount = 0;\r\n    $.map(data.signatures, function(signature) {signature.systemID == viewingSystemID ? signatureCount++ : null;});\r\n    $(\"#signature-count\").html(signatureCount);\r\n}\r\n\r\n/** Find if there is an unknown return sig. The markup is always generated (in addSignature.js) */\r\ntripwire.updateReturnStatus = function() {\r\n\tconst inSigId = $(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']:not(.calc)\").attr('data-insigid');\r\n\tconst wormholeId = $(\"#chainMap [data-nodeid='\"+viewingSystemID+\"']:not(.calc)\").attr('data-sigid');\r\n\tconst wormhole = tripwire.client.wormholes[wormholeId] || {};\r\n\t// One of the two ends should be in this system, In sig will be the wrong end, so find the other end\r\n\tconst returnSigId = wormhole.initialID == inSigId ? wormhole.secondaryID : wormhole.initialID;\r\n\ttripwire.signatures.returnSig = tripwire.signatures.list[returnSigId];\r\n\tconst needReturn = tripwire.signatures.returnSig && (tripwire.signatures.returnSig.signatureID == '???' || tripwire.signatures.returnSig.signatureID == '' || tripwire.signatures.returnSig.signatureID === null || tripwire.signatures.returnSig.signatureID === undefined);\r\n\tdocument.getElementById('sigTableWrapper').className = needReturn ? 'return-visible' : 'return-invisible';\t\r\n}","// Handles pasting sigs from EVE\r\ntripwire.pasteSignatures = function() {\r\n    var processing = false;\r\n\r\n    var rowParse = function(row) {\r\n        var scanner = {};\r\n        var columns = row.split(\"\t\"); // Split by tab\r\n        var validScanGroups = [\r\n            // English (en-us)\r\n            \"Cosmic Signature\",\r\n            \"Cosmic Anomaly\",\r\n\r\n            // French (fr)\r\n            \"Signature cosmique\",\r\n            \"Anomalie cosmique\",\r\n\r\n            // German (de)\r\n            \"Kosmische Anomalie\",\r\n            \"Kosmische Signatur\",\r\n\r\n            // Japanese (ja)\r\n            \"\",\r\n            \"\",\r\n\r\n            // Korean (ko)\r\n            \" \",\r\n            \" \",\r\n\r\n            // Russian (ru)\r\n            \" \",\r\n            \" \",\r\n        ];\r\n\r\n        var validTypes = {\r\n            // English (en-us)\r\n            \"Combat Site\": \"Combat\",\r\n            \"Data Site\": \"Data\",\r\n            \"Gas Site\": \"Gas\",\r\n            \"Ore Site\": \"Ore\",\r\n            \"Relic Site\": \"Relic\",\r\n            \"Wormhole\": \"Wormhole\",\r\n\r\n            // French (fr)\r\n            \"Site de combat\": \"Combat\",\r\n            \"Site de donnes\": \"Data\",\r\n            \"Site de collecte de gaz\": \"Gas\",\r\n            \"Site de minerai\": \"Ore\",\r\n            \"Site de reliques\": \"Relic\",\r\n            \"Trou de ver\": \"Wormhole\",\r\n\r\n            // German (de)\r\n            \"Kampfgebiet\": \"Combat\",\r\n            \"Datengebiet\": \"Data\",\r\n            \"Gasgebiet\": \"Gas\",\r\n            \"Mineraliengebiet\": \"Ore\",\r\n            \"Reliktgebiet\": \"Relic\",\r\n            \"Wurmloch\": \"Wormhole\",\r\n\r\n            // Japanese (ja)\r\n            \"\": \"Combat\",\r\n            \"\": \"Data\",\r\n            \"\": \"Gas\",\r\n            \"\": \"Ore\",\r\n            \"\": \"Relic\",\r\n            \"\": \"Wormhole\",\r\n\r\n            // Korean (ko)\r\n            \" \": \"Combat\",\r\n            \" \": \"Data\",\r\n            \" \": \"Gas\",\r\n            \" \": \"Ore\",\r\n            \" \": \"Relic\",\r\n            \"\": \"Wormhole\",\r\n\r\n            // Russian (ru)\r\n            \" \": \"Combat\",\r\n            \" \": \"Data\",\r\n            \" \": \"Gas\",\r\n            \" \": \"Ore\",\r\n            \" \": \"Relic\",\r\n            \"\": \"Wormhole\",\r\n        };\r\n\r\n        for (var x in columns) {\r\n            if (columns[x].match(/^([A-Z]{3}[-]\\d{3})$/)) {\r\n                scanner.id = columns[x].split(\"-\");\r\n                continue;\r\n            }\r\n\r\n            if (columns[x].match(/(\\d([.|,]\\d)?[ ]?(%))/) || columns[x].match(/(\\d[.|,]?\\d+\\s?(UA|AU|AE|km|m|..||))/i)) { // Exclude scan % || AU\r\n                continue;\r\n            }\r\n\r\n            if ($.inArray(columns[x], validScanGroups) != -1) {\r\n                scanner.scanGroup = columns[x];\r\n                continue;\r\n            }\r\n\r\n            if (validTypes[columns[x]]) {\r\n                scanner.type = validTypes[columns[x]];\r\n                continue;\r\n            }\r\n\r\n            if (columns[x] != \"\") {\r\n                scanner.name = columns[x].trim();\r\n            }\r\n        }\r\n\r\n        if (!scanner.id || scanner.id.length !== 2) {\r\n            return false;\r\n        }\r\n\r\n        return scanner;\r\n    }\r\n\r\n    this.pasteSignatures.parsePaste = function(paste) {\r\n        var paste = paste.split(\"\\n\");\r\n        var payload = {\"signatures\": {\"add\": [], \"update\": []}, \"systemID\": viewingSystemID};\r\n        var undo = [];\r\n        processing = true;\r\n\r\n        for (var i in paste) {\r\n            var scanner = rowParse(paste[i]);\r\n\r\n            if (scanner.id) {\r\n                var signature = $.map(tripwire.client.signatures, function(signature) { if (signature.signatureID && signature.signatureID.toUpperCase() == scanner.id[0] + scanner.id[1] && signature.systemID == viewingSystemID) return signature; })[0];\r\n                if (signature) {\r\n                    // Update signature (only non-wormholes can be updated to a wormhole)\r\n                    if (scanner.type == \"Wormhole\" && signature.type != \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        payload.signatures.update.push({\r\n                            \"wormhole\": {\r\n                                \"id\": wormhole.id || null,\r\n                                \"type\": wormhole.type || null,\r\n                                \"life\": wormhole.life || \"stable\",\r\n                                \"mass\": wormhole.mass || \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"id\": signature.id,\r\n                                    \"signatureID\": signature.signatureID,\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": signature.name\r\n                                },\r\n                                {\r\n                                    \"id\": otherSignature.id || null,\r\n                                    \"signatureID\": otherSignature.signatureID || null,\r\n                                    \"systemID\": otherSignature.systemID || null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"name\": otherSignature.name\r\n                                }\r\n                            ]\r\n                        });\r\n\r\n                        if (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[otherSignature.id]]});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t}\r\n                    // Make sure we are only updating when we have new info (we never turn wormholes into regular signatures)\r\n                    } else if (signature.type != \"wormhole\" && ((scanner.type && scanner.type.toLowerCase() != signature.type) || (scanner.name && scanner.name != signature.name))) {\r\n                        payload.signatures.update.push({\r\n                            \"id\": signature.id,\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                        undo.push(tripwire.client.signatures[signature.id]);\r\n                    }\r\n                } else {\r\n                    // Add signature\r\n                    if (scanner.type == \"Wormhole\") {\r\n                        payload.signatures.add.push({\r\n                            \"wormhole\": {\r\n                                \"type\": null,\r\n                                \"parent\": \"initial\",\r\n                                \"life\": \"stable\",\r\n                                \"mass\": \"stable\"\r\n                            },\r\n                            \"signatures\": [\r\n                                {\r\n                                    \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                                    \"systemID\": viewingSystemID,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                },\r\n                                {\r\n                                    \"signatureID\": null,\r\n                                    \"systemID\": null,\r\n                                    \"type\": \"wormhole\",\r\n                                    \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                                }\r\n                            ]\r\n                        });\r\n                    } else {\r\n                        payload.signatures.add.push({\r\n                            \"signatureID\": scanner.id[0] + scanner.id[1],\r\n                            \"systemID\": viewingSystemID,\r\n                            \"type\": scanner.type || 'unknown',\r\n                            \"name\": scanner.name,\r\n                            \"lifeLength\": options.signatures.pasteLife * 60 * 60\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (payload.signatures.add.length || payload.signatures.update.length) {\r\n            var success = function(data) {\r\n                if (data.resultSet && data.resultSet[0].result == true) {\r\n                    $(\"#undo\").removeClass(\"disabled\");\r\n\r\n                    if (data.results) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"add\", signatures: data.results});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"add\", signatures: data.results}];\r\n                        }\r\n                    }\r\n\r\n                    if (undo.length) {\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"update\", signatures: undo});\r\n\t\t\t\t\t\t} else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"update\", signatures: undo}];\r\n\t\t\t\t\t\t}\r\n                    }\r\n\r\n                    sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                }\r\n            }\r\n\r\n            var always = function(data) {\r\n                processing = false;\r\n            }\r\n\r\n            tripwire.refresh('refresh', payload, success, always);\r\n        } else {\r\n            processing = false;\r\n        }\r\n    }\r\n\r\n    this.pasteSignatures.init = function() {\r\n        $(document).keydown(function(e)\t{\r\n            if ((e.metaKey || e.ctrlKey) && (e.keyCode == 86 || e.keyCode == 91) && !processing) {\r\n                //Abort - user is in input or textarea\r\n                if ($(document.activeElement).is(\"textarea, input\")) return;\r\n\r\n                $(\"#clipboard\").focus();\r\n            }\r\n        });\r\n\r\n        $(\"body\").on(\"click\", \"#fullPaste\", function(e) {\r\n            e.preventDefault();\r\n\r\n            var paste = $(this).data(\"paste\").split(\"\\n\");\r\n            var pasteIDs = [];\r\n            var removes = [];\r\n            var undo = [];\r\n\r\n            for (var i in paste) {\r\n                if (scan = rowParse(paste[i])) {\r\n                    pasteIDs.push((scan.id[0] + scan.id[1]).toLowerCase());\r\n                }\r\n            }\r\n\r\n            for (var i in tripwire.client.signatures) {\r\n                var signature = tripwire.client.signatures[i];\r\n\r\n                if (signature.systemID == viewingSystemID && signature.signatureID && $.inArray(signature.signatureID.toLowerCase(), pasteIDs) === -1 && signature.signatureID !== \"???\") {\r\n                    if (signature.type == \"wormhole\") {\r\n                        var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0] || {};\r\n                        var otherSignature = wormhole.id ? (signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID]) : {};\r\n                        if (wormhole.type !== \"GATE\") {\r\n                            removes.push(wormhole);\r\n                            undo.push({\"wormhole\": wormhole, \"signatures\": [signature, otherSignature]});\r\n                        }\r\n                    } else {\r\n                        removes.push(signature.id);\r\n                        undo.push(signature);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (removes.length > 0) {\r\n                var payload = {\"signatures\": {\"remove\": removes}};\r\n\r\n                var success = function(data) {\r\n                    if (data.resultSet && data.resultSet[0].result == true) {\r\n                        $(\"#undo\").removeClass(\"disabled\");\r\n                        if (viewingSystemID in tripwire.signatures.undo) {\r\n                            tripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n                        } else {\r\n                            tripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n                        }\r\n\r\n                        sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                    }\r\n                }\r\n\r\n                tripwire.refresh('refresh', payload, success);\r\n            }\r\n        });\r\n\r\n        $(\"#clipboard\").on(\"paste\", function(e) {\r\n            e.preventDefault();\r\n            var paste = window.clipboardData ? window.clipboardData.getData(\"Text\") : (e.originalEvent || e).clipboardData.getData('text/plain');\r\n\r\n            $(\"#clipboard\").blur();\r\n            Notify.trigger(\"Paste detected<br/>(<a id='fullPaste' href=''>Click to delete missing sigs</a>)\");\r\n            $(\"#fullPaste\").data(\"paste\", paste);\r\n            tripwire.pasteSignatures.parsePaste(paste);\r\n        });\r\n    }\r\n\r\n    this.pasteSignatures.init();\r\n}\r\ntripwire.pasteSignatures();\r\n","tripwire.redo = function() {\r\n    if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n        $(\"#redo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.redo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var redoItem = tripwire.signatures.redo[viewingSystemID][lastIndex];\r\n        var undo = $.map(redoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(redoItem.action) {\r\n            case \"add\":\r\n                data.signatures.add = data.signatures.add.concat(redoItem.signatures);\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(redoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(redoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.redo[viewingSystemID].pop();\r\n\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.undo) {\r\n                    if (redoItem.action == \"add\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": data.results});\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID].push({\"action\": redoItem.action, \"signatures\": undo});\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID].push({action: redoItem.action, signatures: redoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (redoItem.action == \"add\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": data.results}];\r\n                    } else if (redoItem.action == \"update\") {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{\"action\": redoItem.action, \"signatures\": undo}];\r\n                    } else {\r\n                        tripwire.signatures.undo[viewingSystemID] = [{action: redoItem.action, signatures: redoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.redo[viewingSystemID].length > 0) {\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","// Handles pulling TQ status & player count\r\ntripwire.serverStatus = function() {\r\n    this.data;\r\n    this.timer;\r\n\r\n    clearTimeout(tripwire.serverStatus.timer);\r\n\r\n    tripwire.esi.eveStatus()\r\n        .always(function(data) {\r\n            if (data && data.players && data.players > 0) {\r\n                if (!tripwire.serverStatus.data || tripwire.serverStatus.data.players !== data.players) {\r\n                    $('#serverStatus').html(\"<span class='\"+(data.players > 0 ? 'stable' : 'critical')+\"'>TQ</span>: \"+Intl.NumberFormat().format(data.players));\r\n\r\n                    if (tripwire.serverStatus.data) {\r\n                        $(\"#serverStatus\").effect('pulsate', {times: 5});\r\n                    }\r\n                }\r\n\r\n                tripwire.serverStatus.data = data;\r\n            } else {\r\n                $('#serverStatus').html(\"<span class='critical'>TQ</span>\");\r\n            }\r\n\r\n            tripwire.serverStatus.timer = setTimeout(\"tripwire.serverStatus();\", 15000);\r\n        });\r\n}\r\ntripwire.serverStatus();\r\n\r\ntripwire.updateServerTime = function() {\r\n\tdocument.getElementById('serverTime').innerText = moment.utc().format('HH:mm')\r\n};\r\nsetInterval(tripwire.updateServerTime, 5000);\r\ntripwire.updateServerTime();","tripwire.sync = function(mode, data, successCallback, alwaysCallback) {\t\r\n    var data = typeof(data) === \"object\" ? $.extend(true, {}, data) : {};\r\n\r\n    // Grab any pending changes\r\n    $.extend(true, data, tripwire.data);\r\n\r\n    // Remove old timer to prevent multiple\r\n    if (this.timer) clearTimeout(this.timer);\r\n    if (this.xhr) {\r\n\t\tconsole.log('Awaiting existing XHR ' + this.xhr.data.mode + ': ', this.xhr);\r\n\t\ttripwire.data = data;\r\n\t\tthis.timer = setTimeout(function() { tripwire.sync(mode, data, successCallback, alwaysCallback); }, 50);\r\n\t\treturn false;\r\n\t}\r\n\r\n    if (mode == 'refresh' || mode == 'change') {\r\n        data.signatureCount = tripwire.serverSignatureCount;\r\n        data.signatureTime = maxTimeByProperty(this.client.signatures, \"modifiedTime\");\r\n\r\n        data.flareCount = chain.data.flares ? chain.data.flares.flares.length : 0;\r\n        data.flareTime = chain.data.flares ? chain.data.flares.last_modified : 0;\r\n\r\n        data.commentCount = Object.keys(this.comments.data||{}).length;\r\n        data.commentTime = maxTimeByProperty(this.comments.data, \"modified\");\r\n\r\n        data.activity = this.activity;\r\n    } else {\r\n        // Expand Tripwire with JSON data from EVE Data Dump and other static data\r\n        $.extend(this, appData);\r\n\r\n        this.aSigSystems = Object.assign(\r\n\t\t\t// Using the index as a key here because numeric keys always come first and we want these before real systems\r\n\t\t\t// see https://stackoverflow.com/questions/47881998/\r\n\t\t\tappData.genericSystemTypes.reduce(function(o, s, i) { o[i] = systemAnalysis.analyse(s); o[i].name = s; return o; }, {} ),\r\n\t\t\tthis.systems);\r\n\t\t\r\n        $(\".systemsAutocomplete\").inlinecomplete({source: this.systems, renderer: 'system', maxSize: 10, delay: 0});\r\n    }\r\n\r\n    data.mode = mode != \"init\" ? \"refresh\" : \"init\";\r\n    data.systemID = viewingSystemID;\r\n    data.systemName = viewingSystem;\r\n    data.instance = tripwire.instance;\r\n    data.version = tripwire.version;\r\n\r\n    this.xhr = $.ajax({\r\n        url: \"refresh.php\",\r\n        data: data,\r\n        type: \"POST\",\r\n        dataType: \"JSON\",\r\n        cache: false\r\n    }).done(function(data) {\r\n        if (data) {\r\n            tripwire.server = data;\r\n            if(data.signatures) { // Save this count before we delete entries\r\n                tripwire.serverSignatureCount = Object.keys(data.signatures||{}).length;\r\n            }\r\n\r\n            if (data.wormholes) {\r\n                // Purge bad wormhole signatures\r\n                var wormholeInitialIDs = {};\r\n                var wormholeSecondaryIDs = {};\r\n                Object.values(data.wormholes).forEach(function (wh) {\r\n                    wormholeInitialIDs[parseInt(wh.initialID)] = wh.id;\r\n                    wormholeSecondaryIDs[parseInt(wh.secondaryID)] = wh.id;\r\n                })\r\n                for (var i in data.signatures) {\r\n                  if (data.signatures[i].type == \"wormhole\") {\r\n                    var id = data.signatures[i].id;\r\n                    if (wormholeInitialIDs[id] === undefined && wormholeSecondaryIDs[id] === undefined) {\r\n                      delete data.signatures[i];\r\n                    }\r\n                  }\r\n                }\r\n            }\r\n\r\n            if (data.esi) {\r\n                tripwire.esi.parse(data.esi);\r\n            }\r\n\r\n            if (data.oauth) {\r\n                tripwire.esi.parseOauth(data.oauth);\r\n            }\r\n\r\n            if (data.sync) {\r\n                tripwire.serverTime.time = new Date(data.sync);\r\n            }\r\n\r\n            if (data.signatures) {\r\n                tripwire.parse(data, mode);\r\n            }\r\n\r\n            if (data.comments) {\r\n                tripwire.comments.parse(data.comments);\r\n            }\r\n\r\n            if (data.wormholes || data.occupied || data.flares) {\r\n                tripwire.chainMap.parse({\"map\": data.wormholes || null, \"occupied\": data.occupied || null, \"flares\": data.flares || null});\r\n            } else if (chain.data.occupied && chain.data.occupied.length && !data.occupied) {\r\n                // send update to remove all occupied system indicators\r\n                tripwire.chainMap.parse({\"occupied\": []});\r\n            }\r\n\r\n\t\t\ttripwire.updateReturnStatus();\r\n\r\n            tripwire.active(data.activity);\r\n\r\n            if (data.notify && !$(\"#serverNotification\")[0]) Notify.trigger(data.notify, \"yellow\", false, \"serverNotification\");\r\n\t\t\t\r\n\t\t\t$('[data-command=ping]')[data.discord_integration ? 'show' : 'hide']();\r\n        }\r\n\r\n        tripwire.data = {tracking: {}, esi: {}};\r\n        successCallback ? successCallback(data) : null;\r\n    }).always(function(data, status) {\r\n        tripwire.timer = setTimeout(\"tripwire.refresh();\", tripwire.refreshRate);\r\n\r\n        alwaysCallback ? alwaysCallback(data) : null;\r\n\r\n        if (data.status == 403) {\r\n            window.location.href = \".\";\r\n        } else if (status != \"success\" && status != \"abort\" && tripwire.connected == true) {\r\n            tripwire.connected = false;\r\n            $(\"#ConnectionSuccess\").click();\r\n            Notify.trigger(\"Error syncing with server\", \"red\", false, \"connectionError\");\r\n        } else if (status == \"success\" && tripwire.connected == false) {\r\n            tripwire.connected = true;\r\n            $(\"#connectionError\").click();\r\n            Notify.trigger(\"Successfully reconnected with server\", \"green\", 5000, \"connectionSuccess\");\r\n        }\r\n\t\t\r\n\t\ttripwire.xhr = null;\r\n    });\r\n\tthis.xhr.data = data;\r\n\t\r\n    return true;\r\n};\r\n\r\nfunction maxTimeByProperty(obj, prop) {\r\n\tvar maxTimeString = \"\", maxTime;\r\n\r\n\tfor (var key in obj) {\r\n\t\tif (!maxTime || maxTime < new Date(obj[key][prop])) {\r\n\t\t\tmaxTime = new Date(obj[key][prop]);\r\n\t\t\tmaxTimeString = obj[key][prop];\r\n\t\t}\r\n\t}\r\n\treturn maxTimeString;\r\n}\r\n\r\ntripwire.sync(\"init\");\r\n","// Change the currently viewed system\r\ntripwire.systemChange = function(systemID, mode) {\r\n\tconst system = systemAnalysis.analyse(systemID);\r\n\tif(!system) { return; }\r\n\t\t\r\n    if (mode != \"init\") {\r\n        $(\"#infoSecurity\").removeClass();\r\n        $(\"#infoStatics\").empty();\r\n\r\n        viewingSystem = system.name;\r\n        viewingSystemID = systemID;\r\n\r\n        // Reset activity\r\n        activity.refresh(true);\r\n\r\n        // Reset signatures\r\n        $(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n        $(\"#sigTable tbody\").empty();\r\n        $(\"#signature-count\").html(0);\r\n        tripwire.signatures.list = {};\r\n        tripwire.client.signatures = null;\r\n\r\n        // Reset chain map\r\n        chain.redraw();\r\n\r\n        // Reset comments\r\n        $(\"#notesWidget .content .comment:visible\").remove();\r\n        tripwire.comments.data = null;\r\n\r\n        // Change the URL & history\r\n        history.replaceState(null, null, \"?system=\"+viewingSystem);\r\n\r\n        tripwire.refresh(\"change\");\r\n    }\r\n\r\n    // Change the title\r\n    document.title = system.name + \" - \" + app_name;\r\n\r\n    $(\"#infoSystem\").text(system.name);\r\n\r\n    // Current system favorite\r\n    $.inArray(parseInt(viewingSystemID), options.favorites) != -1 ? $(\"#system-favorite\").attr(\"data-icon\", \"star\").addClass(\"active\") : $(\"#system-favorite\").attr(\"data-icon\", \"star-empty\").removeClass(\"active\");\r\n\t\r\n    if (system.class) {\r\n        // Security\r\n        $(\"#infoSecurity\").html(\"<span class='\" + system.systemTypeClass+\" pointer'>Class \" + system.class + \"</span>\");\r\n\r\n        // Effects\r\n        if (system.effect) {\r\n            var tooltip = \"<table cellpadding=\\\"0\\\" cellspacing=\\\"1\\\">\";\r\n            for (var x in tripwire.effects[system.effect]) {\r\n                var effect = tripwire.effects[system.effect][x].name;\r\n                var base = tripwire.effects[system.effect][x].base;\r\n                var bad = tripwire.effects[system.effect][x].bad;\r\n                var whClass = system.class > 6 ? 6 : system.class;\r\n                var modifier = 0;\r\n\r\n                switch (Math.abs(base)) {\r\n                    case 15:\r\n                        modifier = base > 0 ? 7 : -7;\r\n                        break;\r\n                    case 30:\r\n                        modifier = base > 0 ? 14 : -14;\r\n                        break;\r\n                    case 60:\r\n                        modifier = base > 0 ? 28 : -28;\r\n                        break;\r\n                }\r\n\r\n                tooltip += \"<tr><td>\" + effect + \"</td><td style=\\\"padding-left: 25px; text-align: right;\\\" class=\\\"\" + (bad ? \"critical\" : \"stable\") + \"\\\">\";\r\n                tooltip += base + (modifier * (whClass -1)) + \"%</td></tr>\";\r\n            }\r\n            tooltip += \"</table>\";\r\n            $(\"#infoSecurity\").append(\"&nbsp;<span class='pointer' data-tooltip='\" + tooltip + \"'>\" + system.effect + \"</span>\");\r\n        }\r\n\r\n        // Statics\r\n        for (var x in system.statics) {\r\n            var type = system.statics[x];\r\n            var wormhole = appData.wormholes[type];\r\n            var color = \"wh\";\r\n\r\n            switch (wormhole.leadsTo) {\r\n                case \"High-Sec\":\r\n                    color = \"hisec\";\r\n                    break;\r\n                case \"Low-Sec\":\r\n                    color = \"lowsec\";\r\n                    break;\r\n                case \"Null-Sec\":\r\n                    color = \"nullsec\";\r\n                    break;\r\n            }\r\n\r\n            $(\"#infoStatics\").append(\"<div><span class='\"+ color +\"'>&#9679;</span> <b class='\"+ color +\"'>\"+ wormhole.leadsTo +\"</b> via <span>\"+ wormholeRendering.renderWormholeType(wormhole, type, system) +\"</span></div>\");\r\n        }\r\n\r\n        // Faction\r\n        $(\"#infoFaction\").html(\"&nbsp;\");\r\n    } else {\r\n        // Security\r\n\t\tconst securityText = {HS: 'High-Sec', LS: 'Low-Sec', NS: 'Null-Sec', 'Trig': 'Triglavian' }[system.systemTypeName];\r\n       $(\"#infoSecurity\").addClass(system.systemTypeClass).html(securityText + \" \" + system.baseSecurity.toFixed(2) + system.systemTypeModifiers.join(' '));\r\n\r\n        // Faction\r\n        if(fw) { $(\"#infoFaction\").html(fw.factionMarkup(system)); }\r\n\t\t\r\n\t\t// Gates\r\n\t\tconst connections = guidance.connections(tripwire.map.shortest, viewingSystemID);\r\n\t\tif(connections.length) {\r\n\t\t\t$('#infoStatics').append('<p><b>Gates</b>: ' + connections.map(c => {\r\n\t\t\t\tconst system = systemAnalysis.analyse(c.systemID);\r\n\t\t\t\treturn c.closed ? '<s>' + system.name + '</s> (closed)' : systemRendering.renderSystem(system); \r\n\t\t\t}).join(', ') + '</p>');\r\n\t\t}\r\n\t\t\r\n\t\t// Route to favourites\r\n\t\tfor (var fi in options.favorites) {\r\n\t\t\tconst f = options.favorites[fi];\r\n\t\t\tconst path = guidance.findShortestPath(tripwire.map.shortest, f, viewingSystemID);\r\n\t\t\tif(path) { $('#infoStatics').append('<p><b><a href=\".?system=' + tripwire.systems[f].name + '\">' +tripwire.systems[f].name + '</a></b>: ' + systemRendering.renderPath(path) + '</p>'); }\r\n\t\t}\r\n    }\r\n\r\n\tTooltips.attach($(\"#infoStatics [data-tooltip]\"));\r\n    Tooltips.attach($(\"#infoSecurity [data-tooltip]\"));\r\n\r\n    // Region\r\n    $(\"#infoRegion\").text(tripwire.regions[system.regionID].name);\r\n\r\n    // Info Links\r\n    $(\"#infoWidget .infoLink\").each(function() {\r\n        this.href = $(this).data(\"href\").replace(/\\$systemName/gi, system.name).replace(/\\$systemID/gi, systemID);\r\n    });\r\n\r\n    // Reset undo/redo\r\n    tripwire.signatures.undo[systemID] && tripwire.signatures.undo[systemID].length > 0 ? $(\"#undo\").removeClass(\"disabled\") : $(\"#undo\").addClass(\"disabled\");\r\n    tripwire.signatures.redo[systemID] && tripwire.signatures.redo[systemID].length > 0 ? $(\"#redo\").removeClass(\"disabled\") : $(\"#redo\").addClass(\"disabled\");\r\n\r\n    // Reset delete signature icon\r\n    $(\"#sigTable tr.selected\").length == 0 ? $(\"#signaturesWidget #delete-signature\").addClass(\"disabled\") : $(\"#signaturesWidget #delete-signature\").removeClass(\"disabled\");\r\n}\r\n\r\nsetTimeout(() => tripwire.systemChange(viewingSystemID, \"init\"), 0);\r\n","var tutorial;\r\n\r\n// infoWidget\r\n$(\"#infoWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#infoWidget\"),\r\n                intro: \"<h4>System information widget</h4><br/><p>Displays information on the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoGeneral\"),\r\n                intro: \"<p>This section includes:<br/>System Name<br/>Security Rating<br/>Region<br/>Owning Faction Name</p><br/><p>If the selected system is a wormhole with a system effect, that will also be shown - hover over it to view the effect breakdown.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#activityGraph\"),\r\n                intro: \"<p>For K space systems, a graph is shown here containing hourly ship jump and kill information from the EVE API.</p><br/><p>Each category can be toggled by clicking the keys above the graph, and the time period selected with the links below.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoStatics\"),\r\n                intro: \"<p>If a wormhole system is selected, its static wormhole types will appear here. (A static is a wormhole which is always present; when it is closed or expires, a new one will spawn.)</p><br/><p>In K space, the route to each of your favorite systems is shown here.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#favorite-control-wrapper\"),\r\n                intro: \"<p>Use the star to toggle whether this is a 'favorite' system. It shows orange when the current system is a favorite. The other button shows the Favorites panel which will show you all your favorite systems.</p><br/><p>'Favorite' systems in K space can be shown in the chain map, and in the routing panel to the lower left.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#show-favorite\"),\r\n                intro: \"<p>Use this toggle to show favorite systems and their routes on the chain map.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoExtra\"),\r\n                intro: \"<p>For K space systems, the shortest route to the currently visible chain will be shown here, along with the route within the chain.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#infoLinks\"),\r\n                intro: \"<p>These are some quick links to various sites for this specific system.</p>\"\r\n            },\t\t\t\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// signaturesWidget\r\n$(\"#signaturesWidget .tutorial\").click(function() {\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#signaturesWidget\"),\r\n                intro: \"<h4>System signatures widget</h4><br/><p>Displays all signatures and wormholes in the currently <b>selected</b> Tripwire system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-signature\"),\r\n                intro: \"<p>Add new signatures and wormholes manually by clicking the + icon.</p><br/><p>Copy & Paste EVE scanner results anywhere once Tripwire has focus to add or update signatures, repeated pastes will only update with new information.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#delete-signature\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>DELETE</b> to delete <b>selected</b> signatures from this system.</p><br/><p>Click on a row to select it, click multiple rows to delete multiple signatures at once, click a selected row again to unselect it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#signature-count\"),\r\n                intro: \"<p>This shows the current count of signatures, including wormholes, in the selected system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#undo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Z</b> to undo the last changes you made in this sytem (this includes clipboard pasted changes).</p><br/><p>You can undo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#redo\"),\r\n                intro: \"<p>Click here or use the keyboard shortcut <b>CTRL-Y</b> to redo the last changes you made in this system (this includes clipboard pasted changes).</p><br/><p>You can redo multiple times as history is kept in the browser.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#toggle-automapper\"),\r\n                intro: \"<p>Click here to toggle the Auto-mapper feature on (orange) or off.</p><br/><p>This feature only works when an in-game character is being actively tracked, otherwise this icon appears disabled.</p><br/><p>The automapper will watch for a change in your in-game system not via a star gate and try to automatically add or update wormholes.</p><br/><p>First it tries to seach for wormholes already added but missing a leads to system, this includes via wormhole type (B274) or with a leads to of 'High-Sec' for example.</p><br/><p>Next it searches for wormholes without any type or leads to at all.</p><br/><p>Finally if there are no wormholes or they all have a leads to system already, it will add a new wormhole.</p><br/><p>If at any time if finds multiple wormholes it can update, a dialog window will appear asking which wormhole you want to update.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#sigTable\"),\r\n                intro: \"<p>Each column can be sorted by clicking the column label, sort by multiple columns by holding the shift key.</p><br/><p>Right-click a column to change the text-alignment.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n});\r\n\r\n// notesWidget\r\n$(\"#notesWidget .tutorial\").click(function(e) {\r\n    e.preventDefault();\r\n\r\n    tutorial = introJs().setOptions({\r\n        showStepNumbers: false,\r\n        exitOnEsc: false,\r\n        exitOnOverlayClick: false,\r\n        skipLabel: \"Abort\",\r\n        steps: [\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<h4>System notes widget</h4><br/><p>Displays comments based on the currently <b>selected</b> Tripwire system.</p><br/><p>The rest of this tutorial will guide you through actually adding a comment, but don't worry we will switch you to your private Tripwire mask so we don't disturb anyone else.</p><br/><p>When you finish or leave this tutorial we will switch you back to your previous Tripwire mask.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#add-comment\"),\r\n                intro: \"<p>Now click the + icon to begin adding a new comment in this system (\" + viewingSystem + \").</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Type some basic text now and click save.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This is our newly created comment. Hover over the comment with your mouse to see additional information and controls.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>You can click the 'pin' or 'sticky' button to toggle showing this comment for every system, not just this system.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Use the <b>Edit</b> to modify a comment and <b>Delete</b> to remove a comment.</p><br/><p>You can also quickly edit any comment by simply doubling clicking anywhere on it.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>Click on the <b>Edit</b> now on our comment.</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>The toolbar at the top allows you to customize your notes.</p><br/><p>You can also click on the <b>Maximize/Minimize</b> button (the far right toolbar icon) to edit this comment in full screen mode.</p><br/><p>In full screen mode you will see 1 new button added to the toolbar to view the source code of the comment where you can write HTML, CSS, and even Javascript in your notes!</p>\"\r\n            },\r\n            {\r\n                element: document.querySelector(\"#notesWidget\"),\r\n                intro: \"<p>This concludes the tutorial, we will now switch you back to your previous Tripwire mask and delete the comment we created.</p>\"\r\n            }\r\n        ]\r\n    }).start();\r\n\r\n    tutorial.onchange(function(element) {\r\n        switch(tutorial._currentStep) {\r\n            case 1:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n\r\n                console.log(\"switch mask to private\");\r\n                tutorial.previousMask = options.masks.active;\r\n                options.masks.active = options.character.id + \".1\";\r\n                options.save();\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[2].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(3);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget #add-comment\").on(\"click\", tutorial.stepFunc);\r\n                break;\r\n            case 2:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    tutorial.comment = $(this).closest(\".comment\");\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[3].element = tutorial.comment[0];\r\n                        tutorial._options.steps[4].element = tutorial.comment.find(\".commentSticky\")[0];\r\n                        tutorial._options.steps[5].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial._options.steps[6].element = tutorial.comment.find(\".commentControls\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(4);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentSave\", tutorial.stepFunc);\r\n                break;\r\n            case 6:\r\n                $(\".introjs-prevbutton, .introjs-nextbutton\").hide();\r\n                $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n\r\n                tutorial.stepFunc = function() {\r\n                    setTimeout(function() {\r\n                        tutorial._options.steps[7].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial._options.steps[8].element = $(\"#notesWidget\").find(\".comment:has(.cke_toolbar)\")[0];\r\n                        tutorial.setOption(\"steps\", tutorial._options.steps);\r\n\r\n                        tutorial.exiting = false;\r\n                        tutorial.exit().start().goToStep(8);\r\n                        tutorial.exiting = true;\r\n                    }, 200);\r\n                }\r\n\r\n                $(\"#notesWidget\").on(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n                break;\r\n        }\r\n    });\r\n\r\n    tutorial.onexit(function() {\r\n        if (tutorial.exiting) {\r\n            $(\".commentCancel:visible\").click();\r\n            // delete the tutorial comment that was created\r\n            if (tutorial.comment) {\r\n                var data = {\"mode\": \"delete\", \"commentID\": tutorial.comment.data(\"id\")};\r\n\r\n                $.ajax({\r\n                    url: \"comments.php\",\r\n                    type: \"POST\",\r\n                    data: data,\r\n                    dataType: \"JSON\"\r\n                }).done(function(data) {\r\n                    if (data && data.result == true) {\r\n                        tutorial.comment.remove();\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (tutorial.previousMask) {\r\n                setTimeout(function() {\r\n                    console.log(\"change mask back, delete comment\", tutorial.previousMask);\r\n                    options.masks.active = tutorial.previousMask;\r\n                    options.save();\r\n                }, 200);\r\n            }\r\n\r\n            // remove event listeners\r\n            $(\"#notesWidget #add-comment\").off(\"click\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentSave\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".commentEdit\", tutorial.stepFunc);\r\n            $(\"#notesWidget\").off(\"click\", \".cke_toolgroup:has(.cke_button__toolbarswitch)\", tutorial.stepFunc);\r\n        }\r\n    });\r\n\r\n    tutorial.previousMask;\r\n    tutorial.comment;\r\n    tutorial.stepFunc;\r\n    tutorial.exiting = true;\r\n});\r\n","tripwire.undo = function() {\r\n    if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n        $(\"#undo\").addClass(\"disabled\");\r\n        var lastIndex = tripwire.signatures.undo[viewingSystemID].length -1;\r\n        var data = {\"systemID\": viewingSystemID, \"signatures\": {\"add\": [], \"remove\": [], \"update\": []}};\r\n\r\n        var undoItem = tripwire.signatures.undo[viewingSystemID][lastIndex];\r\n        var redo = $.map(undoItem.signatures, function(signature) {\r\n            // grab the current signature so we can restore the way it is now\r\n            if (signature.wormhole && tripwire.client.wormholes[signature.wormhole.id]) {\r\n                // it was a wormhole and still is\r\n                return {\"wormhole\": tripwire.client.wormholes[signature.wormhole.id], \"signatures\": [tripwire.client.signatures[signature.signatures[0].id], tripwire.client.signatures[signature.signatures[1].id]]};\r\n            } else if (tripwire.client.signatures[signature.id] && tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n                // it was a regular signature but is now a wormhole\r\n                var wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n                return {\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]};\r\n            } else if (signature.wormhole && tripwire.client.signatures[signature.signatures[0].id]) {\r\n                // it was a wormhole but is now a regular signature\r\n                return tripwire.client.signatures[signature.signatures[0].id];\r\n            } else {\r\n                // it was a regular signature and still is\r\n                return tripwire.client.signatures[signature.id];\r\n            }\r\n        });\r\n\r\n        switch(undoItem.action) {\r\n            case \"add\":\r\n                data.signatures.remove = data.signatures.remove.concat($.map(undoItem.signatures, function(signature) { return signature.wormhole ? signature.wormhole : signature.id }));\r\n                break;\r\n            case \"remove\":\r\n                data.signatures.add = data.signatures.add.concat(undoItem.signatures);\r\n                break;\r\n            case \"update\":\r\n                data.signatures.update = data.signatures.update.concat(undoItem.signatures);\r\n                break;\r\n        }\r\n\r\n        var success = function(data) {\r\n            if (data.resultSet && data.resultSet[0].result == true) {\r\n                tripwire.signatures.undo[viewingSystemID].pop();\r\n\r\n                $(\"#redo\").removeClass(\"disabled\");\r\n                if (viewingSystemID in tripwire.signatures.redo) {\r\n                    if (undoItem.action == \"remove\") {\r\n                        // we are adding new signatures we removed so we need the new ids\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": data.results});\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": redo});\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID].push({\"action\": undoItem.action, \"signatures\": undoItem.signatures});\r\n                    }\r\n                } else {\r\n                    if (undoItem.action == \"remove\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": data.results}];\r\n                    } else if (undoItem.action == \"update\") {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": redo}];\r\n                    } else {\r\n                        tripwire.signatures.redo[viewingSystemID] = [{\"action\": undoItem.action, \"signatures\": undoItem.signatures}];\r\n                    }\r\n                }\r\n\r\n                sessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n                sessionStorage.setItem(\"tripwire_redo\", JSON.stringify(tripwire.signatures.redo));\r\n            }\r\n        }\r\n\r\n        var always = function(data) {\r\n            if (tripwire.signatures.undo[viewingSystemID].length > 0) {\r\n                $(\"#undo\").removeClass(\"disabled\");\r\n            }\r\n        }\r\n\r\n        tripwire.refresh('refresh', data, success, always);\r\n    }\r\n}\r\n","var activity = new function() {\r\n\tthis.graph;\r\n\tthis.options;\r\n\tthis.view;\r\n\tthis.span = 24;\r\n\tthis.columns = [\r\n\t\t{id: \"time\", label: \"Time\", role: \"domain\", type: \"string\", calc: function(d, r) { return d.getValue(r, 0) + \"h\"; }},\r\n\t\t{id: \"jumps\", label: \"Jumps\", role: \"data\", type: \"number\", sourceColumn: 1, column: 1, title: \"Jumps\"},\r\n\t\t{id: \"podkills\", label: \"Pod Kills\", role: \"data\", type: \"number\", sourceColumn: 2, column: 2, title: \"Pod Kills\"},\r\n\t\t{id: \"shipkills\", label: \"Ship Kills\", role: \"data\", type: \"number\", sourceColumn: 3, column: 3, title: \"Ship Kills\"},\r\n\t\t{id: \"npckills\", label: \"NPC Kills\", role: \"data\", type: \"number\", sourceColumn: 4, column: 4, title: \"NPC Kills\"},\r\n\t\t//{id: \"annotationLabel\", label: \"Test\", role: \"annotation\", type: \"string\", sourceColumn: 5, title: \"Test\"},\r\n\t\t//{id: \"annotationText\", label: \"Test\", role: \"annotationText\", type: \"string\", sourceColumn: 6, title: \"Test\"}\r\n\t];\r\n\r\n\tthis.getData = function(span, cache) {\r\n\t\tvar span = typeof(span) !== \"undefined\" ? span : this.span;\r\n\t\tvar cache = typeof(cache) !== \"undefined\" ? cache : true;\r\n\r\n\t\t// Google hasn't finished loading yet\r\n\t\tif (!activity.graph) {\r\n\t\t\t\tsetTimeout(function() {activity.getData(span, cache)}, 500);\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn $.ajax({\r\n\t\t\turl: \"activity_graph.php\",\r\n\t\t\tdata: {systemID: viewingSystemID, time: span},\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\",\r\n\t\t\tcache: cache\r\n\t\t}).done(function(json) {\r\n\t\t\tif (json) {\r\n\t\t\t\tjson.rows.reverse();\r\n\t\t\t\tactivity.view = new google.visualization.DataView(new google.visualization.DataTable(json));\r\n\t\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tthis.selectHandler = function() {\r\n\t\tvar selections = activity.graph.getSelection();\r\n\r\n\t\tif (selections[0] && selections[0].row == null) {\r\n\t\t\tvar c = selections[0].column;\r\n\r\n\t\t\tif (activity.columns[c].sourceColumn) {\r\n\t\t\t\t//activity.columns[c].calc = function() { return null };\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title + \" (off)\";\r\n\t\t\t\tdelete activity.columns[c].sourceColumn;\r\n\t\t\t} else {\r\n\t\t\t\tactivity.columns[c].sourceColumn = activity.columns[c].column;\r\n\t\t\t\tactivity.columns[c].label = activity.columns[c].title;\r\n\t\t\t\t//delete activity.columns[c].calc;\r\n\t\t\t}\r\n\r\n\t\t\tactivity.view.setColumns(activity.columns);\r\n\t\t\tactivity.options.animation.duration = 0;\r\n\t\t\tactivity.graph.draw(activity.view, activity.options);\r\n\t\t\tactivity.options.animation.duration = 500;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.init = function() {\r\n\t\tactivity.graph = new google.visualization.AreaChart(document.getElementById(\"activityGraph\"));\r\n\t\tactivity.options = {\r\n\t\t\tisStacked: false,\r\n\t\t\tbackgroundColor: \"transparent\",\r\n\t\t\thAxis: {textStyle: {color: \"#999\", fontName: \"Verdana\", fontSize: 10}, showTextEvery: 3},\r\n\t\t\tvAxis: {textStyle: {color: \"#666\", fontName: \"Verdana\", fontSize: 10}, viewWindowMode: \"maximized\", viewWindow: {min: 0}, maxValue: 5},\r\n\t\t\tgridlineColor: \"#454545\",\r\n\t\t\tpointSize: 2,\r\n\t\t\tlineWidth: 1,\r\n\t\t\theight: 150,\r\n\t\t\tchartArea: {left: \"10%\", top: \"5%\", width: \"88%\", height: \"85%\"},\r\n\t\t\tlegend: {position: \"in\", textStyle: {color: \"#CCC\", fontName: \"Verdana\", fontSize: 8.5}},\r\n\t\t\tanimation: {duration: 500, easing: \"inAndout\"},\r\n\t\t\ttooltip: {showColorCode: true},\r\n\t\t\tannotations: {style: \"line\", textStyle: {fontSize: 12, color: \"#ccc\"}, domain: 0},\r\n\t\t\tfocusTarget: \"category\"\r\n\t\t}\r\n\r\n\t\tgoogle.visualization.events.addListener(activity.graph, \"select\", activity.selectHandler);\r\n\r\n\t\tactivity.getData(activity.span);\r\n\t}\r\n\r\n\tthis.time = function(span) {\r\n\t\tswitch(span) {\r\n\t\t\tcase 24:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 48:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 168:\r\n\t\t\t\tthis.options.hAxis.showTextEvery = 24;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.span = span;\r\n\t\tthis.getData(span);\r\n\t}\r\n\r\n\tthis.redraw = function() {\r\n\t\tthis.graph.draw(this.view, this.options);\r\n\t}\r\n\r\n\tthis.refresh = function(cache) {\r\n\t\tthis.getData(this.span, cache);\r\n\t}\r\n\r\n\tgoogle.charts.setOnLoadCallback(this.init);\r\n}\r\n","var CKConfig = {\r\n\tskin: \"custom\",\r\n\theight: 100,\r\n\tallowedContent: true,\r\n\textraPlugins: \"toolbarswitch,autogrow,autolink\",\r\n\tenterMode: CKEDITOR.ENTER_BR,\r\n\tremoveDialogTabs: 'link:advanced',\r\n\tautoGrow_onStartup: true,\r\n\tautoGrow_minHeight: 100,\r\n\ttoolbar_minToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\"]},\r\n\t\t{name: \"paragraph\", items: [\"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\"]},\r\n\t\t{name: \"tools\", items: [\"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar_maxToolbar: [\r\n\t\t{name: \"basicstyles\", items: [\"Bold\", \"Italic\", \"Underline\", \"Strike\", \"Subscript\", \"Superscript\"]},\r\n\t\t{name: \"paragraph\", items: [\"NumberedList\", \"BulletedList\", \"Outdent\", \"Indent\"]},\r\n\t\t{name: \"links\", items: [\"Link\"]},\r\n\t\t{name: \"colors\", items: [\"TextColor\", \"BGColor\"]},\r\n\t\t{name: \"styles\", items: [\"FontSize\", \"Font\"]},\r\n\t\t{name: \"tools\", items: [\"Source\", \"Toolbarswitch\"]}\r\n\t],\r\n\ttoolbar: \"minToolbar\",\r\n\tsmallToolbar: \"minToolbar\",\r\n\tmaximizedToolbar: \"maxToolbar\",\r\n\tfontSize_style: {\r\n\t    element:        'span',\r\n\t    styles:         { 'font-size': '#(size)' },\r\n\t    overrides:      [ { element :'font', attributes: { 'size': null } } ]\r\n\t}\r\n}\r\n\r\nCKEDITOR.on(\"instanceLoaded\", function(cke) {\r\n\tcke.editor.on(\"contentDom\", function() {\r\n\t\tcke.editor.on(\"key\", function(e) {\r\n\t\t\tif (e.data.keyCode == 27) {\r\n\t\t\t\t// escape key cancels\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentCancel\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (e.data.domEvent.$.altKey && e.data.domEvent.$.keyCode == 83) {\r\n\t\t\t\t// alt+s saves\r\n\t\t\t\t$(cke.editor.element.$).closest(\".comment\").find(\".commentSave\").click();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t$(\".cke_combo__font a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n\r\n\t$(\".cke_combo__fontsize a\")\r\n\t\t.removeClass(\"cke_combo_button\")\r\n\t\t.addClass(\"cke_button cke_button_off\")\r\n\t\t.html('<span class=\"cke_button_icon\">&nbsp;</span>')\r\n});\r\n\r\nCKEDITOR.on(\"instanceReady\", function(cke) {\r\n\t// ensure focus on init\r\n\tcke.editor.focus();\r\n\r\n\tvar s = cke.editor.getSelection(); // getting selection\r\n\tvar selected_ranges = s.getRanges(); // getting ranges\r\n\tvar node = selected_ranges[0].startContainer; // selecting the starting node\r\n\tvar parents = node.getParents(true);\r\n\r\n\tnode = parents[parents.length - 2].getFirst();\r\n\r\n\tif (!node) return false;\r\n\r\n\twhile (true) {\r\n\t\tvar x = node.getNext();\r\n\t\tif (x == null) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tnode = x;\r\n\t}\r\n\r\n\ts.selectElement(node);\r\n\tselected_ranges = s.getRanges();\r\n\tselected_ranges[0].collapse(false);  //  false collapses the range to the end of the selected node, true before the node.\r\n\ts.selectRanges(selected_ranges);  // putting the current selection there\r\n});\r\n\r\nCKEDITOR.on(\"dialogDefinition\", function(ev) {\r\n\tif (ev.data.name == 'link') {\r\n\t\tev.data.definition.getContents('target').get('linkTargetType')['default'] = '_blank';\r\n\t}\r\n});\r\n","// Firefox (and some other browsers) don't support 'zoom' CSS\r\n// This snippet hooks up a variant using transform(scale) to JQuery\r\n// See e.g. https://medium.com/@sai_prasanna/simulating-css-zoom-with-css3-transform-scale-461d1b9762d6\r\nif (document.createElement(\"detect\").style.zoom != \"\"){\r\n\t$.cssNumber.zoom = true;\r\n    $.cssHooks.zoom = {\r\n        get: function(elem, computed, extra) {\r\n            var value = $(elem).data('zoom');\r\n            return value != null ? value : 1;\r\n        },\r\n        set: function(elem, scale) {\r\n            var $e = $(elem);\r\n            var e = $e[0];\r\n            var data = $e.data('zoom');\r\n            if (data == null) {\r\n                $e.data('origWidth', e.clientWidth);\r\n                $e.data('origHeight', e.clientHeight);\r\n            }\r\n            $e.data('zoom', scale);\r\n            const width = $e.data('origWidth');\r\n            const height = $e.data('origHeight');\r\n            e.style.transform = 'scale(' + scale + ')';\r\n            e.style.transformOrigin = '0 0';\r\n            const bot = (height/scale - height);\r\n            const right = (width/scale - width);\r\n            e.style.marginBottom = (-bot) + 'px';\r\n            e.style.marginRight = (-right) + 'px';\r\n        }\r\n    };\r\n}","const fw = new _FactionWarfare();\r\n\r\nfunction _FactionWarfare() {\r\n\tconst _this = this;\r\n\tthis.listeners = [];\r\n\tthis.data = null;\r\n\tthis.systems = {};\r\n\tthis.SamanuniAthounonGateOpen = true;\r\n\t\r\n\t/** Refresh the FW data from the public ESI endpoint */\r\n\tthis.refresh = function() {\r\n\t\t$.ajax({\r\n\t\t\turl: 'cached_third_party.php?key=fw',\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"JSON\"\r\n\t\t}).done(function(data, status, xhr) {\t\r\n\t\t\tif(!_.isEqual(data, _this.data)) {\r\n\t\t\t\tconsole.info('Updating faction warfare status');\r\n\t\t\t\t_this.data = data;\r\n\t\t\t\t_this.parse(data);\r\n\t\t\t\ttripwire.systemChange(viewingSystemID);\r\n\t\t\t\tguidance.clearCache();\r\n\t\t\t}\r\n\t\t}).fail(function(xhr, status, error) {\r\n\t\t\tconsole.warn('Failed to fetch FW data from ESI: ' + status, error);\r\n\t\t});\r\n\t};\t\r\n\t\r\n\tthis.parse = function(data) {\r\n\t\tthis.systems = {};\r\n\t\tfor(var i = 0; i < data.length; i++) { this.systems[data[i].solar_system_id] = data[i]; }\r\n\t\tthis.SamanuniAthounonGateOpen = this.systems[30003856].occupier_faction_id == 500001;\r\n\t}\r\n\t\r\n\t// Guidance plugin\r\n\tthis.adjustJumpCost = function(from, to, cost) {\r\n\t\tconst gateOpen = this.SamanuniAthounonGateOpen || !((from == 3856 && to == 45322) || (to == 3856 && from == 45322));\r\n\t\treturn gateOpen ? cost : -1;\r\n\t}.bind(this);\t// because it's called from outside\r\n\tguidance.jumpCostModifiers.push(this.adjustJumpCost);\r\n\t\r\n\t/** Gets the markup for faction text for a system. If it's in FW, it will show contested status; if not it will just show the faction */\r\n\tthis.factionMarkup = function(system) {\r\n\t\treturn system.factionID ? (\r\n\t\t\t_this.systems[system.systemID] ? \r\n\t\t\t\tappData.factions[_this.systems[system.systemID].occupier_faction_id].name + ' (FW: ' + \r\n\t\t\t\t\t(_this.systems[system.systemID].contested == 'uncontested' ? 'uncontested' : \r\n\t\t\t\t\t\tMath.floor(100 * _this.systems[system.systemID].victory_points / _this.systems[system.systemID].victory_points_threshold) + '% contested') + ')'\r\n\t\t\t\t: appData.factions[system.factionID].name\r\n\t\t) : \"&nbsp;\";\r\n\t};\r\n\t\r\n\tsetInterval(this.refresh, 3600000);\r\n\tthis.refresh();\t\r\n}","// Model and data binding for mass related UI\r\ntripwire.massOptions = {\r\n\thiggs: false,\r\n\tprop: false\r\n}\r\n\t\r\ntripwire.resetMassOptions = function() {\r\n\t$(\"#hot-jump\").removeClass(\"active\");\r\n\ttripwire.massOptions.prop = false;\t\t\r\n\t$(\"#higgs-jump\").removeClass(\"active\");\r\n\ttripwire.massOptions.higgs = false;\r\n};\r\n\r\n$(\"#hot-jump\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\t\t\r\n\t\t$(this).removeClass(\"active\");\r\n\t\ttripwire.massOptions.prop = false;\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\ttripwire.massOptions.prop = true;\r\n\t}\r\n});\r\n\r\n$(\"#higgs-jump\").click(function() {\r\n\tif ($(this).hasClass(\"active\")) {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\ttripwire.massOptions.higgs = false;\r\n\t} else {\r\n\t\t$(this).addClass(\"active\");\r\n\t\ttripwire.massOptions.higgs = true;\r\n\t}\r\n});\r\n","const tracking = {\r\n\tremove: function(characterID) {\r\n\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\t\t\r\n\t},\r\n\tadd: function(character) {\r\n\t\tvar $clone = $(\"#tracking-clone\").clone();\r\n\t\t$clone.attr(\"data-characterid\", characterID);\r\n\t\t$clone.find(\".avatar img\").attr(\"src\", \"https://image.eveonline.com/Character/\"+ character.characterID +\"_32.jpg\");\r\n\t\t$clone.find(\".name\").html(character.characterName);\r\n\t\t$clone.removeAttr(\"id\");\r\n\t\t$clone.removeClass(\"hidden\");\r\n\t\t$clone.addClass(\"tracking-clone\");\r\n\r\n\t\t$(\"#tracking\").append($clone);\r\n\t\tTooltips.attach($clone.find(\".avatar [data-tooltip]\"));\r\n\t\t\r\n\t\tconst charOptions = options.tracking.characterOptions[character.characterID] || tracking.defaultCharacterOptions;\r\n\t\tif(charOptions.show) { $clone.find('.show').addClass('active'); }\r\n\t\tif(charOptions.showShip) { $clone.find('.show-ship').addClass('active'); }\r\n\t\t\r\n\t\treturn $clone;\r\n\t},\r\n\tdefaultCharacterOptions: { show: true, showShip: true }\r\n\t\r\n};\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone\", function() {\r\n\tvar characterID =$(this).attr(\"data-characterid\");\r\n\t$(\"#tracking .tracking-clone\").removeClass(\"active\");\r\n\r\n\tif (options.tracking.active == characterID) {\r\n\t\toptions.tracking.active = null;\r\n\t\ttripwire.EVE(false, true);\r\n\t\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\t} else {\r\n\t\toptions.tracking.active = characterID;\r\n\r\n\t\tif (tripwire.esi.characters[options.tracking.active]) {\r\n\t\t\t$(\"#tracking .tracking-clone[data-characterid='\"+ options.tracking.active +\"']\").addClass(\"active\");\r\n\t\t\ttripwire.EVE(tripwire.esi.characters[options.tracking.active], true);\r\n\t\t}\r\n\r\n\t\t$(\"#removeESI\").removeAttr(\"disabled\");\r\n\t}\r\n\tset_tracking_text();\r\n\toptions.save();\r\n});\r\n\r\n$(\"#track\").on(\"click\", \".tracking-clone i.interactable\", function(e) {\r\n\tconst elem = e.target;\r\n\tconst container = $(elem).closest('.tracking-clone')[0];\r\n\tconst characterID = container.dataset.characterid;\r\n\tconst wasActive = $(elem).hasClass('active');\r\n\tif(wasActive) {\r\n\t\t$(elem).removeClass('active');\r\n\t} else {\r\n\t\t$(elem).addClass('active');\r\n\t}\r\n\te.stopPropagation();\r\n\t\r\n\tif(!options.tracking.characterOptions[characterID]) { options.tracking.characterOptions[characterID] = tracking.defaultCharacterOptions; }\r\n\t\r\n\toptions.tracking.characterOptions[characterID][elem.dataset.property] = !wasActive;\r\n\ttripwire.esi.updateTracking(tripwire.esi.characters[characterID]);\r\n});\r\n\r\n$(\"#login\").on(\"click\", \"#removeESI\", function() {\r\n\tvar characterID = options.tracking.active;\r\n\r\n\toptions.tracking.active = null;\r\n\ttripwire.EVE(false, true);\r\n\toptions.save();\r\n\r\n\t$(\"#tracking .tracking-clone[data-characterid='\"+ characterID +\"']\").remove();\r\n\r\n\t$(\"#removeESI\").attr(\"disabled\", \"disabled\");\r\n\r\n\tif ($.isArray(tripwire.data.esi.delete)) {\r\n\t\ttripwire.data.esiDelete.push(characterID);\r\n\t} else {\r\n\t\ttripwire.data.esiDelete = [characterID];\r\n\t}\r\n});\r\n\r\n\r\n/** Set UI text based on the current tracked character */\r\nfunction set_tracking_text() {\r\n\tif(tripwire.esi.characters[options.tracking.active]) {\r\n\t\tdocument.getElementById('user-track-name').textContent = tripwire.esi.characters[options.tracking.active].characterName;\r\n\t\tdocument.getElementById('user-track').style.display = '';\r\n\t\tdocument.getElementById('user-no-track').style.display = 'none';\r\n\t} else {\r\n\t\tdocument.getElementById('user-track').style.display = 'none';\r\n\t\tdocument.getElementById('user-no-track').style.display = '';\t\r\n\t}\r\n}\r\n","const wormholeAnalysis = new function() {\r\n\t/** Finds the ID for a target system or system type for the given system name text and wormhole type.\r\n\t@param systemText The name of a system, or a system class from appData.genericSystemTypes, e.g. 'Low-Sec'\r\n\t@param wormholeType The type text of a wormhole e.g. 'U210'\r\n\t@return An ID - either a systemID (31001031), a system type ID (7) or null if there isn't enough information */\r\n\tthis.targetSystemID = function(systemText, wormholeType) {\r\n\t\tconst lookupText = systemText || (appData.wormholes[(wormholeType + '').toUpperCase()] || {}).leadsTo;\r\n\t\tif(!lookupText) { return null; }\r\n\t\tif (Object.index(appData.systems, \"name\", lookupText, true)) {\r\n\t\t\t// Leads To is a normal EVE system, so use the sytem ID\r\n\t\t\treturn Object.index(appData.systems, \"name\", lookupText, true)\r\n\t\t} else if (wormholeType && appData.wormholes[wormholeType.toUpperCase()]) {\r\n\t\t\t// Leads To can be determined by the wormhole type, so lets use what we know it leads to\r\n\t\t\tif (appData.genericSystemTypes.findIndex((item) => lookupText.replace(' ', '-').toLowerCase() === item.toLowerCase()) > -1) {\r\n\t\t\t\treturn appData.genericSystemTypes.findIndex((item) => lookupText.replace(' ', '-').toLowerCase() === item.toLowerCase());\r\n\t\t\t}\r\n\t\t} else if (appData.genericSystemTypes.findIndex((item) => lookupText.toLowerCase() === item.toLowerCase()) !== -1) {\r\n\t\t\t// Leads To is one of the valid types we allow, so use of of those indexes as reference\r\n\t\t\treturn appData.genericSystemTypes.findIndex((item) => systemText.toLowerCase() === item.toLowerCase());\r\n\t\t} else { return null; }\r\n\t};\r\n\t\r\n\t/** Get all the eligible wormhole types for this connection.\r\n\tIf both systems are known (e.g. C3 to C2) then only wormhole types matching that specific connection will be returned. If either side is unknown then all connections to/from the known side are listed, which will be quite large. If both are unknown then return null (as it could be any wormhole).\r\n\t@param sourceID The system ID, type ID (into genericSystemType) or chain format string (e.g. 2|1232) for the source system\r\n\t@param targetID As above for the target system\r\n\t@param dataSource A source set of wormhole types to evaluate (defaults to appData.wormholes)\r\n\t@return An object of the form { from: [...], to: [...] } where each list is the wormhole types (from appData.wormholes) eligible for that direction */\r\n\tthis.eligibleWormholeTypes = function(sourceDef, targetDef, dataSource) {\r\n\t\tconst coerce = function(def) { return def === undefined || def === null || def.genericSystemType ? def : systemAnalysis.analyse(def); };\r\n\t\tconst source = coerce(sourceDef), target = coerce(targetDef);\r\n\t\t\r\n\t\tif(!source && !target) { return null; }\r\n\t\t\r\n\t\tconst from = [], to = [];\r\n\t\tconst systemTypeMatch = function(possibleSystems, genericTypes) {\r\n\t\t\treturn genericTypes.some(genericType => possibleSystems.indexOf(genericType) >= 0 ||\r\n\t\t\t\t(genericType.indexOf('/') >= 0 && _.some(genericType.substring('Class-'.length).split('/'), x => possibleSystems.indexOf('Class-' + x) >= 0))\r\n\t\t\t);\r\n\t\t};\r\n\t\tconst matches = function(possibleSystems, exclusions, system) {\r\n\t\t\tif(typeof possibleSystems === 'string') { possibleSystems = [possibleSystems]; }\r\n\t\t\treturn (!system) || (\r\n\t\t\t\t((!possibleSystems) || (possibleSystems.indexOf(system.name) >= 0 || systemTypeMatch(possibleSystems, system.genericSystemType))) && \r\n\t\t\t\t((!exclusions) || exclusions.indexOf(system.genericSystemType) < 0)\t// no exclusion\r\n\t\t\t);\r\n\t\t}\r\n\t\tObject.entries(dataSource || appData.wormholes).forEach(function(e) {\r\n\t\t\tconst wt = e[1], key = e[0];\r\n\t\t\tif(matches(wt.from, wt.notFrom, source) && matches(wt.leadsTo, wt.notLeadsTo, target)) { from.push(objAndKey(wt, key)); }\r\n\t\t\tif(matches(wt.from, wt.notFrom, target) && matches(wt.leadsTo, wt.notLeadsTo, source)) { to.push(objAndKey(wt, key)); }\r\n\t\t});\r\n\t\treturn { from: from, to: to };\r\n\t}\r\n\t\r\n\tfunction objAndKey(o, k) { return o && Object.assign({key: k}, o); }\r\n\t\r\n\t/** Placeholder wormholes which don't have an exact known type, but still provide some information */\r\n\tthis.dummyWormholes = {\r\n\t\t\"GATE\": { from: [ \"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Triglavian\"], leadsTo: [ \"Null-Sec\", \"Low-Sec\", \"High-Sec\", \"Triglavian\"] },\r\n\t\t\"SML\": { \"key\": \"SML\", \"jump\": 5000000, \"dummy\": true },\r\n\t\t\"MED\": { \"key\": \"MED\", \"jump\": 62000000, \"mass\": 500000000, \"dummy\": true },\r\n\t\t\"LRG\": { \"key\": \"LRG\", \"jump\": 375000000, \"mass\": 2000000000, \"dummy\": true },\r\n\t\t\"XLG\": { \"key\": \"XLG\", \"jump\": 2000000000, \"mass\": 3300000000, \"dummy\": true },\r\n\t};\r\n\t\r\n\t/** Get the wormhole type object from the type names for a sig pair. One of the types is probably K162 */\r\n\tthis.wormholeFromTypePair = function(type1, type2) {\r\n\t\treturn appData.wormholes[type1] || appData.wormholes[type2] ||\r\n\t\t\tthis.dummyWormholes[type1] || this.dummyWormholes[type2] ||\r\n\t\t\tundefined;\t// we don't know anything\r\n\t}\r\n\t\r\n\tthis.likelyWormhole = function(system1, system2) {\r\n\t\tconst class1 = systemAnalysis.analyse(system1).genericSystemType,\r\n\t\t\tclass2 = systemAnalysis.analyse(system2).genericSystemType;\r\n\t\t\r\n\t\tfunction isHighClass(classes) { return classes && classes.some(c => ['Class-5', 'Class-6' ].indexOf(c) >= 0); }\r\n\t\tfunction isKSpace(classes) { return classes && classes.toString().indexOf('-Sec') >= 0; }\r\n\t\tfunction inferKSpace(genericTypes) {\r\n\t\t\treturn isHighClass(genericTypes) ? 'XLG' :\r\n\t\t\tgenericTypes == 'Class-1' ? 'MED' :\r\n\t\t\t'LRG';\r\n\t\t}\r\n\t\t\r\n\t\treturn this.dummyWormholes[\r\n\t\t\tisKSpace(class1) ? inferKSpace(class2) : isKSpace(class2) ? inferKSpace(class1) :\r\n\t\t\tString(class1 + '/' + class2).indexOf('-13') >= 0 ? 'SML' :\r\n\t\t\tclass1 == 'Class-1' || class2 == 'Class-1' ? 'MED' :\r\n\t\t\tisHighClass(class1) && isHighClass(class2) ? 'XLG' :\r\n\t\t\t'LRG'\r\n\t\t];\r\n\t}\r\n}","$(\"#admin\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\")) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (!$(\"#dialog-admin\").hasClass(\"ui-dialog-content\")) {\r\n\t\tvar refreshTimer = null;\r\n\t\tvar $total = null;\r\n\t\tvar $ajax = null;\r\n\r\n\t\tfunction refreshWindow() {\r\n\t\t\tif ($ajax) $ajax.abort();\r\n\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\r\n\t\t\t$ajax = $.ajax({\r\n\t\t\t\turl: \"admin.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdata: {mode: $(\"#dialog-admin .menu .active\").attr(\"data-window\")},\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tif (data && data.results) {\r\n\t\t\t\t\tvar rows = data.results;\r\n\t\t\t\t\tvar ids = [];\r\n\r\n\t\t\t\t\tfor (var i = 0, l = rows.length; i < l; i++) {\r\n\t\t\t\t\t\tvar $row = $(\"#dialog-admin .window .hasFocus tbody tr[data-id='\"+ rows[i].id +\"']\");\r\n\t\t\t\t\t\tids.push(rows[i].id);\r\n\r\n\t\t\t\t\t\tif ($row.length) {\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? Intl.NumberFormat().format(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$row = $(\"#dialog-admin .window .hasFocus table tr.hidden\").clone();\r\n\t\t\t\t\t\t\t$row.attr(\"data-id\", rows[i].id);\r\n\r\n\t\t\t\t\t\t\tfor (col in rows[i]) {\r\n\t\t\t\t\t\t\t\tvar $col = $row.find(\"[data-col='\"+col+\"']\");\r\n\t\t\t\t\t\t\t\t$col.html(($col.attr(\"data-format\") == \"number\" ? Intl.NumberFormat().format(rows[i][col]) : rows[i][col]) || \"&nbsp;\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$row.removeClass(\"hidden\");\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-admin .window .hasFocus tbody\").append($row);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").each(function() {\r\n\t\t\t\t\t\tif ($.inArray($(this).data(\"id\").toString(), ids) == -1) {\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table\").trigger(\"update\", [true]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-admin .window .hasFocus table tr[data-id]\").remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$total.html(\"Total: \" + $(\"#dialog-admin .window .hasFocus table tr[data-id]\").length);\r\n\t\t\t});\r\n\r\n\t\t\tif ($(\"#dialog-admin\").dialog(\"isOpen\") && $(\"#dialog-admin .menu .active\").attr(\"data-refresh\")) {\r\n\t\t\t\trefreshTimer = setTimeout(refreshWindow, $(\"#dialog-admin .menu .active\").attr(\"data-refresh\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$(\"#dialog-admin\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tmodal: true,\r\n\t\t\theight: 350,\r\n\t\t\twidth: 800,\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\t// menu toggle\r\n\t\t\t\t$(\"#dialog-admin\").on(\"click\", \".menu li\", function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t$menuItem = $(this);\r\n\t\t\t\t\tclearTimeout(refreshTimer);\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .menu .active\").removeClass(\"active\");\r\n\t\t\t\t\t$menuItem.addClass(\"active\");\r\n\t\t\t\t\t$(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\").html(\"\");\r\n\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window]\").removeClass(\"hasFocus\").hide();\r\n\t\t\t\t\t$(\"#dialog-admin .window [data-window='\"+ $menuItem.data(\"window\") +\"']\").addClass(\"hasFocus\").show();\r\n\r\n\t\t\t\t\trefreshWindow();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-admin [data-sortable='true']\").tablesorter({\r\n\t\t\t\t\tsortReset: true,\r\n\t\t\t\t\twidgets: ['saveSort'],\r\n\t\t\t\t\tsortList: [[0,0]]\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// dialog bottom tray\r\n\t\t\t\t$($(this)[0].parentElement).find(\".ui-dialog-buttonpane\").append(\"<div class='ui-dialog-traypane'></div>\");\r\n\t\t\t\t$total = $(\"div.ui-dialog[aria-describedby='dialog-admin'] .ui-dialog-traypane\");\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$menuItem = $(\"#dialog-admin .menu li.active\");\r\n\t\t\t\trefreshWindow();\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-admin\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-admin\").dialog(\"open\");\r\n\t}\r\n});\r\n","// Dialog effects\r\n$(\"#wrapper\").addClass(\"transition\");\r\n\r\n$(document).on(\"dialogopen\", \".ui-dialog\", function (event, ui) {\r\n\t// Add additional full screen overlay for 2nd level dialog\r\n\tif ($(\".ui-dialog:visible\").length == 2 && $(this).hasClass(\"dialog-modal\"))\r\n\t\t$(\"body\").append($(\"<div id='overlay' class='overlay' />\").css(\"z-index\", $(this).css(\"z-index\") - 1));\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 1);\r\n\r\n\tif (!$(this).hasClass(\"dialog-noeffect\"))\r\n\t\t$(\"#wrapper\").addClass(\"blur\");\r\n});\r\n\r\n$(document).on(\"dialogclose\", \".ui-dialog\", function (event, ui) {\r\n\tif (!$(\".ui-dialog\").is(\":visible\"))\r\n\t\t$(\"#wrapper\").removeClass(\"blur\");\r\n\r\n\tif ($(\".ui-dialog:visible\").length == 1)\r\n\t\t$(\"#overlay\").remove();\r\n\telse if ($(\"#overlay\"))\r\n\t\t$(\"#overlay\").css(\"z-index\", $(this).css(\"z-index\") - 2);\r\n\r\n\t//if ($(\".ui-dialog:visible\").length == 0 && options.buttons.follow && viewingSystemID != tripwire.client.EVE.systemID)\r\n\t//\twindow.location = \"?system=\"+tripwire.client.EVE.systemName;\r\n});\r\n\r\n","$(\"#dialog-masks\").dialog({\r\n\tautoOpen: false,\r\n\twidth: 450,\r\n\tminHeight: 400,\r\n\tmodal: true,\r\n\tbuttons: {\r\n\t\tSave: function() {\r\n\t\t\t\tvar maskChange = false;\r\n\t\t\t\tif (options.masks.active != $(\"#dialog-masks input[name='mask']:checked\").val()) {\r\n\t\t\t\t\tmaskChange = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.masks.active = $(\"#dialog-masks input[name='mask']:checked\").val();\r\n\r\n\t\t\t\toptions.save() // Performs AJAX\r\n\t\t\t\t\t.done(function() {\r\n\t\t\t\t\t\tif (maskChange) {\r\n\t\t\t\t\t\t\t// Reset signatures\r\n\t\t\t\t\t\t\t$(\"#sigTable span[data-age]\").countdown(\"destroy\");\r\n\t\t\t\t\t\t\t$(\"#sigTable tbody\").empty()\r\n\t\t\t\t\t\t\t$(\"#signature-count\").html(0);\r\n\t\t\t\t\t\t\ttripwire.signatures.list = {};\r\n\t\t\t\t\t\t\ttripwire.client.signatures = [];\r\n\r\n\t\t\t\t\t\t\ttripwire.refresh('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\r\n\t\t\t\t// toggle mask admin icon\r\n\t\t\t\tdocument.getElementById('admin').disabled = !$(\"#dialog-masks input[name='mask']:checked\").data(\"admin\");\t\t\t\r\n\t\t},\r\n\t\tClose: function() {\r\n\t\t\t$(this).dialog(\"close\");\r\n\t\t}\t\t\r\n\t}, \r\n\t\topen: function() {\r\n\t\t\t// Get masks\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"masks.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(response) {\r\n\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t$(\"#dialog-masks #masks #default\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-masks #masks #personal\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-masks #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t$(\"#dialog-masks #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t$(\"#dialog-masks #masks #personal\").append(node);\r\n\r\n\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t$(\"#dialog-masks #masks #corporate\").append(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-masks input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\tdocument.getElementById('admin').disabled = !response.masks[response.active].admin;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\t\r\n});\r\n\r\n$(\"#mask-link\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\t\r\n\t$(\"#dialog-masks\").dialog('open');\r\n });\r\n \r\n \t\t\t// Mask selections\r\n\t\t\t$(\"#masks\").on(\"change\", \"input.selector:checked\", function() {\r\n\t\t\t\tif ($(this).data(\"owner\")) {\r\n\t\t\t\t\t$(\"#maskControls #edit\").removeAttr(\"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#maskControls #edit\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t$(\"#maskControls #delete\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($(this).val() != 0.0 && $(this).val().split(\".\")[1] == 0) {\r\n\t\t\t\t\t$(\"#dialog-masks #leave\").removeAttr(\"disabled\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#dialog-masks #leave\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Mask join\r\n\t\t\t$(\"#dialog-joinMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tvar mask = $(\"#dialog-joinMask #results input:checked\");\r\n\t\t\t\t\t\tvar label = $(\"#dialog-joinMask #results input:checked+label\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: {mask: mask.val(), mode: \"join\"},\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\tlabel.css(\"width\", \"\");\r\n\t\t\t\t\t\t\t\tlabel.find(\".info\").remove();\r\n\t\t\t\t\t\t\t\tlabel.append('<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>');\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #\"+response.type+\" input.selector:last\").before(mask).before(label);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-joinMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").show();\r\n\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.eveIDs)\r\n\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar mask = response.results[x];\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+mask.mask+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"false\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+mask.mask+'\" style=\"width: 100%; margin-left: -5px;\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">'+mask.label+'</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].category == \"character\" ? results[x].corporation.name +'<br/>' : null)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-joinMask #results\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(function() {\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask #loading\").hide();\r\n\t\t\t\t\t\t\t$(\"#dialog-joinMask input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-joinMask #results\").html(\"\");\r\n\t\t\t\t\t$(\"#dialog-joinMask input[name='name']\").val(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-masks #masks\").on(\"click\", \"input[name='find']+label\", function() {\r\n\t\t\t\t$(\"#dialog-joinMask input[name='find']\").val($(this).prev().val());\r\n\t\t\t\t$(\"#dialog-joinMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask leave\r\n\t\t\t$(\"#dialog-masks #masks\").on(\"click\", \".closeIcon\", function() {\r\n\t\t\t\tvar mask = $(this).closest(\"input.selector+label\").prev();\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to remove this mask?\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tRemove: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"leave\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// Mask delete\r\n\t\t\t$(\"#maskControls #delete\").click(function() {\r\n\t\t\t\tvar mask = $(\"#masks input.selector:checked\");\r\n\r\n\t\t\t\t$(\"#dialog-confirm #msg\").text(\"Are you sure you want to delete this mask?\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tDelete: function() {\r\n\t\t\t\t\t\t\tvar send = {mode: \"delete\", mask: mask.val()};\r\n\r\n\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\tdata: send,\r\n\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t\tmask.next().remove();\r\n\t\t\t\t\t\t\t\t\tmask.remove();\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-confirm\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unable to delete\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t// User Create mask\r\n\t\t\t$(\"#dialog-createMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tCreate: function() {\r\n\t\t\t\t\t\t$(\"#dialog-createMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \"#create_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t// Get masks\r\n\t\t\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\t\t\tif (response && response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #default\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #personal\").html(\"\");\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #corporate\").html(\"\");\r\n\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in response.masks) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar mask = response.masks[x];\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"radio\" name=\"mask\" id=\"mask'+x+'\" value=\"'+mask.mask+'\" class=\"selector\" data-owner=\"'+mask.owner+'\" data-admin=\"'+mask.admin+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"mask'+x+'\"><img src=\"'+mask.img+'\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+  (mask.optional ? '<i class=\"closeIcon\" onclick=\"return false;\" data-icon=\"red-giant\"><i data-icon=\"times\"></i></i>' : '')\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<span class=\"selector_label\">'+mask.label+'</span></label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #\"+mask.type).append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findp\" value=\"personal\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findp\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #personal\").append(node);\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (init.admin == \"1\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" name=\"find\" id=\"findc\" value=\"corporate\" class=\"selector\" disabled=\"disabled\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"findc\"><i data-icon=\"search\" style=\"font-size: 3em; margin-left: 16px; margin-top: 16px; display: block;\"></i></label>');\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks #masks #corporate\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t$(\"#dialog-masks input[name='mask']\").filter(\"[value='\"+response.masks[response.active].mask+\"']\").attr(\"checked\", true).trigger(\"change\");\r\n\r\n\t\t\t\t\t\t\t\t\t\t// toggle mask admin icon\r\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('admin').disabled = !response.masks[response.active].admin;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t$(\"#dialog-createMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-createMask select\").selectmenu({width: 100});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#dialog-createMask input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#dialog-createMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#maskControls #create\").click(function() {\r\n\t\t\t\t$(\"#dialog-createMask\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-createMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t$(this).closest(\"input.selector+label\").prev().remove();\r\n\t\t\t\t$(this).closest(\"label\").remove();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-editMask\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#dialog-editMask form\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \".maskRemove\", function() {\r\n\t\t\t\t\t\t$(this).closest(\"input.selector+label\").prev().attr(\"name\", \"deletes[]\").hide();\r\n\t\t\t\t\t\t$(this).closest(\"label\").hide();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList\").on(\"click\", \"#edit_add+label\", function() {\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").dialog(\"open\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(\"#dialog-editMask form\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-editMask\").dialog(\"close\");\r\n\t\t\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(response.error);\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Unknown error\");\r\n\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\tvar mask = $(\"#dialog-masks input[name='mask']:checked\").val();\r\n\t\t\t\t\t$(\"#dialog-editMask input[name='mask']\").val(mask);\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").hide();\r\n\t\t\t\t\t$(\"#dialog-editMask #loading\").show();\r\n\t\t\t\t\t$(\"#dialog-editMask #name\").text($(\"#dialog-masks input[name='mask']:checked+label .selector_label\").text());\r\n\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"masks.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: {mode: \"edit\", mask: mask},\r\n\t\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\tif (response && response.results && response.results.length) {\r\n\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(response.results)\r\n\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<input type=\"checkbox\" checked=\"checked\" onclick=\"return false\" name=\"\" id=\"edit_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"edit_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(node);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).then(function(response) {\r\n\t\t\t\t\t\t$(\"#dialog-editMask #accessList label.static\").show();\r\n\t\t\t\t\t\t$(\"#dialog-editMask #loading\").hide();\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#dialog-editMask #accessList :not(.static)\").remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// EVE search dialog\r\n\t\t\t$(\"#dialog-EVEsearch\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tAdd: function() {\r\n\t\t\t\t\t\tif ($(\"#accessList input[value='\"+$(\"#EVESearchResults input\").val()+\"']\").length) {\r\n\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"Already has access\");\r\n\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults .info\").append('<input type=\"button\" class=\"maskRemove\" value=\"Remove\" style=\"position: absolute; bottom: 3px; right: 3px;\" />');\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"checked\", \"checked\");\r\n\t\t\t\t\t\t$(\"#EVESearchResults input:checked\").attr(\"onclick\", \"return false\");\r\n\r\n\t\t\t\t\t\tvar nodes = $(\"#EVESearchResults .maskNode:has(input:checked)\");\r\n\r\n\t\t\t\t\t\tif ($(\"#dialog-createMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-createMask #accessList .static:first\").before(nodes);\r\n\t\t\t\t\t\telse if ($(\"#dialog-editMask\").dialog(\"isOpen\"))\r\n\t\t\t\t\t\t\t$(\"#dialog-editMask #accessList .static:first\").before(nodes);\r\n\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t},\r\n\t\t\t\t\tClose: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcreate: function() {\r\n\t\t\t\t\t$(\"#EVEsearch\").submit(function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tif ($(\"#EVEsearch input[name='name']\").val() == \"\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").show();\r\n\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\r\n\t\t\t\t\t\ttripwire.esi.search($(\"#EVEsearch input[name='name']\").val(), $(\"#EVEsearch input[name='category']:checked\").val(), $(\"#EVEsearch input[name='exact']\")[0].checked)\r\n\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\tif (results && (results.character || results.corporation)) {\r\n\t\t\t\t\t\t\t\t\t// limit results\r\n\t\t\t\t\t\t\t\t\tresults = $.merge(results.character || [], results.corporation || []);\r\n\t\t\t\t\t\t\t\t\ttotal = results.length;\r\n\t\t\t\t\t\t\t\t\tresults = results.slice(0, 10);\r\n\t\t\t\t\t\t\t\t\treturn tripwire.esi.fullLookup(results)\r\n\t\t\t\t\t\t\t\t\t\t.done(function(results) {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchCount\").html(\"Found: \"+total+\"<br/>Showing: \"+(total<10?total:10));\r\n\t\t\t\t\t\t\t\t\t\t\tif (results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var x in results) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (results[x].category == \"character\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_1373\" value=\"'+results[x].id+'_1373\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_1373\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Character/'+results[x].id+'_64.jpg\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Character</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name + '<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].corporation.name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (results[x].category == \"corporation\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar node = $(''\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<div class=\"maskNode\"><input type=\"checkbox\" name=\"adds[]\" id=\"find_'+results[x].id+'_2\" value=\"'+results[x].id+'_2\" class=\"selector\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '<label for=\"find_'+results[x].id+'_2\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<img src=\"https://image.eveonline.com/Corporation/'+results[x].id+'_64.png\" />'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<span class=\"selector_label\">Corporation</span>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t<div class=\"info\">'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+results[x].name+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t\t'+(results[x].alliance ? results[x].alliance.name : '')+'<br/>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '\t</div>'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ '</label></div>');\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$(\"#EVESearchResults\").append(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).always(function() {\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error #msg\").text(\"No Results\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-error\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch #searchSpinner\").hide();\r\n\t\t\t\t\t\t\t\t\t$(\"#EVEsearch input[type='submit']\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t\t\t\t$(\"#dialog-EVEsearch\").parent().find(\".ui-dialog-buttonpane button:contains('Add')\").removeAttr(\"disabled\").removeClass(\"ui-state-disabled\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#EVEsearch input[name='name']\").val(\"\");\r\n\t\t\t\t\t$(\"#EVESearchResults, #searchCount\").html(\"\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t$(\"#maskControls #edit\").click(function() {\r\n\t\t\t\t$(\"#dialog-editMask\").dialog(\"open\");\r\n\t\t\t});\r\n","\r\n\t\t$(\"#dialog-mass\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\twidth: \"auto\",\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tClose: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tvar wormholeID = $(this).data(\"id\");\r\n\t\t\t\tvar systemID = $(this).data(\"systemID\");\r\n\t\t\t\tvar wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tvar signature = tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\tvar otherSignature = tripwire.client.signatures[wormhole.secondaryID];\r\n\t\t\t\t\r\n\t\t\t\tconst fromSystem = systemAnalysis.analyse(signature.systemID), toSystem = systemAnalysis.analyse(otherSignature.systemID);\r\n\t\t\t\t\r\n\t\t\t\tconst wormholeType = wormhole.type ? tripwire.wormholes[wormhole.type] : \r\n\t\t\t\t\tObject.assign({from: fromSystem.genericSystemType, leadsTo: toSystem.genericSystemType }, wormholeAnalysis.likelyWormhole(signature.systemID, otherSignature.systemID));\r\n\r\n\t\t\t\t$(\"#dialog-mass\").dialog(\"option\", \"title\", \"From \"+fromSystem.name+\" to \"+toSystem.name);\r\n\t\t\t\tdocument.getElementById('mass-systems').innerHTML = \"From \"+systemRendering.renderSystem(fromSystem)+\r\n\t\t\t\t\" To \"+systemRendering.renderSystem(toSystem) +\r\n\t\t\t\t\" via \"+wormholeRendering.renderWormholeType(wormholeType, wormhole.type, fromSystem, toSystem);\r\n\r\n\t\t\t\t$(\"#dialog-mass #massTable tbody tr\").remove();\r\n\t\t\t\tdocument.getElementById('mass-jumped').innerText = '?';\r\n\t\t\t\tdocument.getElementById('mass-capacity').innerText = '?';\r\n\r\n\t\t\t\tvar payload = {wormholeID: wormhole.id};\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"mass.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: payload,\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(data) {\r\n\t\t\t\t\tif (data && data.jumps) {\r\n\t\t\t\t\t\tconst massData = parseMassData(data.jumps);\r\n\t\t\t\t\t\tdocument.getElementById('mass-jumped').innerText = wormholeRendering.renderMass(massData.totalMass);\r\n\t\t\t\t\t\tdocument.getElementById('mass-capacity').innerText = wormholeType.mass ? wormholeRendering.renderMass(wormholeType.mass) : 'Unknown';\r\n\t\t\t\t\t\tdocument.getElementById('mass-placeholder-desc').style.display = wormholeType.dummy ? '' : 'none';\r\n\t\t\t\t\t\tfor (x in massData.jumps) {\r\n\t\t\t\t\t\t\tconst j = massData.jumps[x];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst massMarkup = (j.massClass === 'Small' ? '' :\r\n\t\t\t\t\t\t\t\t\t'<i data-icon=\"prop-mod\" class=\"' + (j.prop ? ' active' : 'inactive') + '\"></i>' +\r\n\t\t\t\t\t\t\t\t\t'<i data-icon=\"anchor\" class=\"' + (j.higgs ? ' active' : 'inactive') + '\"></i> '\r\n\t\t\t\t\t\t\t\t) + wormholeRendering.renderMass(j.mass);\r\n\t\t\t\t\t\t\t$(\"#dialog-mass #massTable tbody\").append(\"<tr class='mass-\" + getMassClass(j.mass) + \"'><td>\"+j.characterName+\"</td><td>\"+(j.targetSystem == systemID ? \"Into \" + systemRendering.renderSystem(toSystem, 'span') : \"Return to \" + systemRendering.renderSystem(fromSystem, 'span'))+\"</td><td>\"+j.shipName+\"</td><td>\"+massMarkup+\"</td><td>\"+j.time+\"</td></tr>\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Summary rows\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr id='small-mass'><td></td><td></td><td>Small jumps</td><td>\"+ wormholeRendering.renderMass(massData.smallMass) +\"</td><td></td></tr>\");\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr id='medium-mass'><td></td><td></td><td>Medium jumps</td><td>\"+ wormholeRendering.renderMass(massData.mediumMass) +\"</td><td></td></tr>\");\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr id='large-mass'><td></td><td></td><td>Large jumps</td><td>\"+ wormholeRendering.renderMass(massData.largeMass) +\"</td><td></td></tr>\");\r\n                        $(\"#dialog-mass #massTable tbody\").append(\"<tr><td></td><td></td><td></td><th>\"+ wormholeRendering.renderMass(massData.totalMass) +\"</th><td></td></tr>\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\nfunction getMassClass(jumpMass) {\r\n\treturn jumpMass <= 5e6 ? 'Small' :\r\n\t jumpMass <= 80e6 ? 'Medium' :\r\n\t jumpMass <= 500e6 ? 'Large' :\r\n\t 'X-Large';\r\n}\r\n\r\nfunction parseMassData(jumps) {\r\n\tconst result = { totalMass: 0, smallMass: 0, mediumMass: 0, largeMass: 0, xlMass: 0, jumps: [] };\r\n\tfor (x in jumps) {\r\n\t\tconst shipData = appData.mass[jumps[x].shipTypeID];\r\n\t\tif(!shipData) { continue; }\t// sometimes ship is not recorded, or ship isn't in SDE dump yet\r\n\t\tconst originalMass = parseFloat(shipData.mass);\r\n\t\tconst shipFlagsText = jumps[x].shipType.split('|', 2)[1] || '';\r\n\t\tconst shipFlags = { higgs: shipFlagsText.indexOf('h') >= 0, prop: shipFlagsText.indexOf('p') >= 0 };\r\n\t\tconst massClass = getMassClass(originalMass);\r\n\t\tconst jumpMass = (originalMass + (shipFlags.prop ? (massClass === 'X-Large' ? 500e6 : 50e6) : 0)) * (shipFlags.higgs ? 2 : 1);\r\n\t\tresult.totalMass += jumpMass;\r\n\t\tswitch(massClass) {\r\n\t\t\tcase 'Small': result.smallMass += jumpMass; break;\r\n\t\t\tcase 'Medium': result.mediumMass += jumpMass; break;\r\n\t\t\tcase 'Large': result.largeMass += jumpMass; break;\r\n\t\t\tcase 'X-Large': result.xlMass += jumpMass; break;\r\n\t\t}\r\n\t\tresult.jumps.push( { \r\n\t\t\toriginalMass: originalMass, mass: jumpMass, massClass: massClass,\r\n\t\t\thiggs: shipFlags.higgs, prop: shipFlags.prop, shipName: shipData.typeName,\r\n\t\t\ttargetSystem: jumps[x].toID, \r\n\t\t\tcharacterName: jumps[x].characterName.split('|')[0],\r\n\t\t\ttime: jumps[x].time \r\n\t\t});\r\n\t}\r\n\treturn result;\r\n}","$(\".options\").click(function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).hasClass(\"disabled\"))\r\n\t\treturn false;\r\n\r\n\t$(\"#dialog-options\").dialog({\r\n\t\tautoOpen: false,\r\n\t\twidth: 450,\r\n\t\tminHeight: 400,\r\n\t\tmodal: true,\r\n\t\tbuttons: {\r\n\t\t\tSave: function() {\r\n\t\t\t\t// Options\r\n\t\t\t\tvar data = {mode: \"set\", options: JSON.stringify(options)};\r\n\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", true).addClass(\"ui-state-disabled\");\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.sigNameLocation = $(\"#dialog-options #chainSigNameLocation\").val();\r\n\t\t\t\toptions.chain.routingLimit = 1 * $(\"#dialog-options #chainRoutingLimit\").val();\r\n\t\t\t\toptions.chain.routeSecurity = $(\"#dialog-options #chainRouteSecurity\").val();\r\n\t\t\t\toptions.chain.routeIgnore.enabled = $(\"#dialog-options #route-ignore-enabled\").prop('checked');\r\n\t\t\t\toptions.chain.routeIgnore.systems = $(\"#dialog-options #route-ignore\").val().split(\",\").map(x => x.trim());\r\n\r\n\t\t\t\toptions.chain.gridlines = 'true' == $(\"#dialog-options input[name=gridlines]:checked\").val();\r\n\t\t\t\toptions.chain.aura = 'true' == $(\"#dialog-options input[name=aura]:checked\").val();\r\n\t\t\t\toptions.chain.scrollWithoutCtrl = 'true' == $(\"#dialog-options input[name=scrollWithoutCtrl]:checked\").val();\r\n\r\n\t\t\t\toptions.chain.nodeSpacing.x = $(\"#dialog-options #node-spacing-x-slider\").slider(\"value\");\r\n\t\t\t\toptions.chain.nodeSpacing.y = $(\"#dialog-options #node-spacing-y-slider\").slider(\"value\");\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.lineWeight = $(\"#dialog-options #node-spacing-line-weight-slider\").slider(\"value\");\r\n\t\t\t\t\r\n\t\t\t\toptions.chain[\"node-reference\"] = $(\"#dialog-options input[name=node-reference]:checked\").val();\r\n\t\t\t\t\r\n\t\t\t\toptions.chain.renderer = $(\"#dialog-options #renderer\").val();\r\n\r\n\t\t\t\toptions.signatures.editType = $(\"#dialog-options #editType\").val();\r\n\r\n\t\t\t\toptions.signatures.pasteLife = $(\"#dialog-options #pasteLife\").val();\r\n\r\n\t\t\t\toptions.signatures.copySeparator = $(\"#dialog-options #copySeparator\").val();\r\n\r\n\t\t\t\toptions.background = $(\"#dialog-options #background-image\").val();\r\n\r\n\t\t\t\toptions.uiscale = $(\"#dialog-options #uiscale-slider\").slider(\"value\");\r\n\r\n\t\t\t\toptions.apply();\r\n\t\t\t\toptions.save(); // Performs AJAX\r\n\r\n\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t$(\"#dialog-options\").parent().find(\".ui-dialog-buttonpane button:contains('Save')\").attr(\"disabled\", false).removeClass(\"ui-state-disabled\");\r\n\r\n\t\t\t},\r\n\t\t\tReset: function() {\r\n\t\t\t\t$(\"#dialog-confirm #msg\").html(\"Settings will be reset to defaults temporarily.<br/><br/><p><em>Save settings to make changes permanent.</em></p>\");\r\n\t\t\t\t$(\"#dialog-confirm\").dialog(\"option\", {\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tReset: function() {\r\n\t\t\t\t\t\t\toptions.reset();\r\n\t\t\t\t\t\t\toptions.apply();\r\n\r\n\t\t\t\t\t\t\t$(\"#dialog-options\").dialog(\"close\");\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}).dialog(\"open\");\r\n\t\t\t},\r\n\t\t\tClose: function() {\r\n\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t}\r\n\t\t},\r\n\t\topen: function() {\r\n\t\t\t// Get user stats data\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"user_stats.php\",\r\n\t\t\t\ttype: \"POST\",\r\n\t\t\t\tdataType: \"JSON\"\r\n\t\t\t}).done(function(data) {\r\n\t\t\t\tfor (i in data.stats) {\r\n\t\t\t\t\tfor (x in data.stats[i]) {\r\n\t\t\t\t\t\t$(\"#optionsAccordion #\"+ x).text(data.stats[i][x]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"#optionsAccordion #systems_visited\").text(data.system_visits);\r\n\t\t\t\t$(\"#optionsAccordion #logins\").text(data.account.logins);\r\n\t\t\t\t$(\"#optionsAccordion #lastLogin\").text(data.account.lastLogin);\r\n\t\t\t\t$(\"#optionsAccordion #username\").text(data.username);\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-options #editType\").val(options.signatures.editType);\r\n\t\t\t$(\"#dialog-options #pasteLife\").val(options.signatures.pasteLife);\r\n\t\t\t$(\"#dialog-options #copySeparator\").val(options.signatures.copySeparator);\r\n\t\t\t$(\"#dialog-options #chainRoutingLimit\").val(options.chain.routingLimit);\r\n\t\t\t$(\"#dialog-options #chainSigNameLocation\").val(options.chain.sigNameLocation);\r\n\t\t\t$(\"#dialog-options #chainRouteSecurity\").val(options.chain.routeSecurity);\r\n\t\t\t$(\"#dialog-options #route-ignore-enabled\").prop('checked', options.chain.routeIgnore.enabled);\r\n\t\t\t$(\"#dialog-options #route-ignore\").val(options.chain.routeIgnore.systems.join(','));\r\n\t\t\t$(\"#dialog-options #renderer\").val(options.chain.renderer);\r\n\t\t\t$(\"#dialog-options input[name='node-reference'][value='\"+options.chain[\"node-reference\"]+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='gridlines'][value='\"+options.chain.gridlines+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='aura'][value='\"+options.chain.aura+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options input[name='scrollWithoutCtrl'][value='\"+options.chain.scrollWithoutCtrl+\"']\").prop(\"checked\", true);\r\n\t\t\t$(\"#dialog-options #node-spacing-x-slider\").slider(\"value\", options.chain.nodeSpacing.x);\r\n\t\t\t$(\"#dialog-options #node-spacing-y-slider\").slider(\"value\", options.chain.nodeSpacing.y);\r\n\t\t\t$(\"#dialog-options #node-spacing-line-weight-slider\").slider(\"value\", options.chain.lineWeight);\r\n\t\t\t$(\"#dialog-options #background-image\").val(options.background);\r\n\t\t},\r\n\t\tcreate: function() {\r\n\t\t\t$(\"#optionsAccordion\").accordion({heightStyle: \"content\", collapsible: true, active: false});\r\n\t\t\tfunction setUpSlider(id, value, change, range) {\r\n\t\t\t\trange = Object.assign({min: 0.7, max:1.4, step:0.05}, range);\r\n\t\t\t\t$(\"#\" + id).slider({\r\n\t\t\t\t\tmin: range.min,\r\n\t\t\t\t\tmax: range.max,\r\n\t\t\t\t\tstep: range.step,\r\n\t\t\t\t\tvalue: value || 1.0,\r\n\t\t\t\t\tchange: change,\r\n\t\t\t\t\tslide: function(e, ui) {\r\n\t\t\t\t\t\t$(\"label[for='\" + id + \"']\").html(ui.value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"label[for='\" + id + \"']\").html($(\"#\" + id).slider(\"value\"));\r\n\t\t\t}\r\n\t\t\tsetUpSlider('uiscale-slider', options.uiscale, function(e, ui) {\r\n\t\t\t\t\t\t$(\"body\").css(\"zoom\", ui.value);\r\n\t\t\t\t\t});\r\n\t\t\tsetUpSlider('node-spacing-x-slider', options.chain.nodeSpacing.x);\r\n\t\t\tsetUpSlider('node-spacing-y-slider', options.chain.nodeSpacing.y);\r\n\t\t\tsetUpSlider('node-spacing-line-weight-slider', options.chain.lineWeight, undefined, { min: 0.5, max: 1.5 });\r\n\r\n\t\t\t$(\"#dialog-pwChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#pwForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#pwForm input[name='password'], #pwForm input[name='confirm']\").val(\"\");\r\n\t\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-pwChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pwForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#pwError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Password changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-pwChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#pwError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#pwError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#dialog-usernameChange\").dialog({\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t\tdialogClass: \"ui-dialog-shadow dialog-noeffect dialog-modal\",\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tSave: function() {\r\n\t\t\t\t\t\t$(\"#usernameForm\").submit();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tCancel: function() {\r\n\t\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\topen: function() {\r\n\t\t\t\t\t$(\"#usernameForm #username\").html($(\"#dialog-options #username\").html());\r\n\t\t\t\t},\r\n\t\t\t\tclose: function() {\r\n\t\t\t\t\t$(\"#usernameForm [name='username']\").val(\"\");\r\n\t\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameChange\").click(function() {\r\n\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"open\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#usernameForm\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t$(\"#usernameError\").text(\"\").hide();\r\n\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: \"options.php\",\r\n\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\tdata: $(this).serialize(),\r\n\t\t\t\t\tdataType: \"JSON\"\r\n\t\t\t\t}).done(function(response) {\r\n\t\t\t\t\tif (response && response.result) {\r\n\t\t\t\t\t\t$(\"#dialog-msg #msg\").text(\"Username changed\");\r\n\t\t\t\t\t\t$(\"#dialog-msg\").dialog(\"open\");\r\n\r\n\t\t\t\t\t\t$(\"#dialog-options #username\").html(response.result);\r\n\r\n\t\t\t\t\t\t$(\"#dialog-usernameChange\").dialog(\"close\");\r\n\t\t\t\t\t} else if (response && response.error) {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(response.error).show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#usernameError\").text(\"Unknown error\").show(\"slide\", {direction: \"up\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\r\n\t\t}\r\n\t});\r\n\r\n\t$(\"#dialog-options\").dialog(\"open\");\r\n});\r\n","\t\t$(\"#dialog-ping\").dialog({\r\n\t\t\tautoOpen: false,\r\n\t\t\theight: \"auto\",\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tSend: function() {\r\n\t\t\t\t\tvar payload = {systemName: this.systemName, systemText: this.systemText, message: $('#ping-text').val() };\r\n\t\t\t\t\tconst _this = this;\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: \"ping.php\",\r\n\t\t\t\t\t\ttype: \"POST\",\r\n\t\t\t\t\t\tdata: payload,\r\n\t\t\t\t\t\tdataType: \"text\"\r\n\t\t\t\t\t}).done(function(data) {\t$(_this).dialog(\"close\"); })\r\n\t\t\t\t\t.fail(function(xhr, status, error) { console.log(status, error); });\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tconst wormholeID = $(this).data(\"id\");\r\n\t\t\t\tconst systemID = $(this).data(\"systemID\");\r\n\t\t\t\tconst wormhole = tripwire.client.wormholes[wormholeID];\r\n\t\t\t\tconst fromSignature = wormhole ? tripwire.client.signatures[wormhole.initialID] : { name: null};\r\n\t\t\t\t\r\n\t\t\t\tthis.systemName = tripwire.systems[systemID].name;\r\n\t\t\t\tthis.systemText = this.systemName + (fromSignature.name !== null && fromSignature.name.length ? ' (' + fromSignature.name + ')' : '');\r\n\t\t\t\t\r\n\t\t\t\t$(\"#dialog-ping\").dialog(\"option\", \"title\", \"Ping about \"+this.systemText);\r\n\t\t\t\t$('#ping-text').val('');\r\n\t\t\t\t$('#ping-text').focus();\r\n\t\t\t}\r\n\t\t});","$(\"#signaturesWidget\").on(\"click\", \"#delete-signature\", function(e) {\r\n\te.preventDefault();\r\n\r\n\tif ($(this).closest(\"tr\").attr(\"disabled\")) {\r\n\t\treturn false;\r\n\t} else if ($(\"#sigTable tr.selected\").length == 0) {\r\n\t\treturn false;\r\n\t} else if ($(\"#dialog-sigEdit\").hasClass(\"ui-dialog-content\") && $(\"#dialog-sigEdit\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-sigEdit\").parent().effect(\"shake\", 300);\r\n\t\treturn false;\r\n\t}\r\n\t\t\r\n\topenDeleteDialog({\r\n\t\tsignatures: $.map($(\"#sigTable tr.selected\"), function(n) {\r\n\t\t\treturn tripwire.client.signatures[$(n).data(\"id\")];\r\n\t\t})\r\n\t});\r\n});\r\n\r\nfunction openDeleteDialog(vm, successFunction) {\r\n\topenDeleteDialog.deleteDialogVM = vm;\t// outside so it's not saved in the closure first time we open the dialog\r\n\r\n\t// check if dialog is open\r\n\tif (!$(\"#dialog-deleteSig\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog({\r\n\t\t\tresizable: false,\r\n\t\t\tminHeight: 0,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\t// Prevent duplicate submitting\r\n\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\t\t\t\t\tvar undo = [];\r\n\r\n\t\t\t\t\tvar signaturePayload = $.map(openDeleteDialog.deleteDialogVM.signatures, function(signature) {\r\n\t\t\t\t\t\tif (signature.type != \"wormhole\") {\r\n\t\t\t\t\t\t\tundo.push(signature);\r\n\t\t\t\t\t\t\treturn signature.id;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\t\t\t\t\t\treturn wormhole;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpayload.signatures.remove = signaturePayload;\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"close\");\r\n\t\t\t\t\t\t\tif(successFunction) { successFunction(); }\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\t\t\t\t\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function(data) {\r\n\t\t\t\t\t\t$(\"#dialog-deleteSig\").parent().find(\":button:contains('Delete')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\tconst sigs = openDeleteDialog.deleteDialogVM.signatures;\r\n\t\t\t\t$(\"#dialog-deleteSig\").dialog(\"option\", \"title\", sigs.length == 1 ? 'Delete Signature ' + formatSignatureID(sigs[0].signatureID) : 'Delete Multiple Signatures');\r\n\t\t\t\tdocument.getElementById('deleteSigText').innerText = sigs.length == 1 ? 'The ' + sigs[0].type + ' signature ' + formatSignatureID(sigs[0].signatureID) \r\n\t\t\t\t\t: 'The signatures ' + sigs.map(s => formatSignatureID(s.signatureID)).join(', ');\r\n\t\t\t\tdocument.getElementById('deleteSigSystem').innerHTML = systemRendering.renderSystem(systemAnalysis.analyse(sigs[0].systemID));\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t//$(\"#sigTable .sigDelete\").removeClass(\"invisible\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-deleteSig\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-deleteSig\").dialog(\"open\");\r\n\t}\r\n}\r\n","const sigDialog = {};\r\nconst sigDialogVM = {};\r\n\r\nsigDialog.openSignatureDialog = function(e) {\r\n\tif(e.preventDefault) { e.preventDefault(); }\t// Allow calls with fake event-like objects too\r\n\tsigDialogVM.mode = e.data.mode;\r\n\t\r\n\tswitch(sigDialogVM.mode) {\r\n\t\tcase 'update':\r\n\t\t\tif (e.data.source == \"sig-row\") {\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(this).closest(\"tr\").addClass(\"selected\");\r\n\t\t\t\tsigDialogVM.sigId = $(this).data('id');\r\n\t\t\t} else if (e.data.source == \"edit-sig\") {\r\n\t\t\t\tvar elements = $(\"#sigTable tbody tr.selected\");\r\n\t\t\t\tif (elements.length !== 1) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsigDialogVM.sigId = $(elements[0]).data('id');\r\n\t\t\t\t}\r\n\t\t\t} else { sigDialogVM.sigId = e.data.signature; }\r\n\t\t\tbreak;\r\n\t\tdefault: delete sigDialogVM.sigId;\r\n\t}\r\n\t\r\n\tsigDialogVM.viewingSystemID = ( sigDialogVM.sigId ) ? tripwire.client.signatures[sigDialogVM.sigId].systemID : viewingSystemID;\r\n\tsigDialogVM.viewingSystem = tripwire.systems[sigDialogVM.viewingSystemID];\r\n\t\r\n\tif (!$(\"#dialog-signature\").hasClass(\"ui-dialog-content\")) {\r\n\t\t$(\"#dialog-signature\").dialog({\r\n\t\t\tautoOpen: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdialogClass: \"dialog-noeffect ui-dialog-shadow\",\r\n\t\t\tposition: {my: \"center\", at: \"center\", of: $(\"#signaturesWidget\")},\r\n\t\t\tbuttons: {\r\n\t\t\t\tDelete: function() {\r\n\t\t\t\t\tconst d = $(this);\r\n\t\t\t\t\topenDeleteDialog({ signatures: [tripwire.client.signatures[sigDialogVM.sigId]] }, () => d.dialog('close') );\r\n\t\t\t\t},\r\n\t\t\t\tSave: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tAdd: function() {\r\n\t\t\t\t\t$(\"#form-signature\").submit();\r\n\t\t\t\t},\r\n\t\t\t\tCancel: function() {\r\n\t\t\t\t\t$(this).dialog(\"close\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcreate: function() {\r\n\t\t\t\tvar aSigWormholes = Object.assign({}, appData.wormholes, wormholeAnalysis.dummyWormholes, { K162: {} } );\r\n\t\t\t\t\r\n\t\t\t\tfunction system_select_item_mapper(items) {\r\n\t\t\t\t\treturn items.concat(appData.genericSystemTypes).map(function(name) {\r\n\t\t\t\t\t\treturn Object.assign({name:name}, systemAnalysis.analyse(name)); \r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType'], #dialog-signature [name='signatureLife']\").selectmenu({width: 100});\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife'], #dialog-signature [name='wormholeMass']\").selectmenu({width: 80});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigSystems']\").inlinecomplete({source: tripwire.aSigSystems, renderer: 'system', select_item_mapper: system_select_item_mapper, maxSize: 10, delay: 0});\r\n\t\t\t\t\r\n\t\t\t\tfunction getTargetName() { return $(\"#dialog-signature .leadsTo:visible\").val(); }\r\n\t\t\t\tfunction getTargetSystem() {\r\n\t\t\t\t\treturn wormholeAnalysis.targetSystemID(getTargetName(), undefined);\t\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tfunction sigTypeDropdownFiller(extractor) {\r\n\t\t\t\t\treturn function() {\r\n\t\t\t\t\t\tconst eligible = wormholeAnalysis.eligibleWormholeTypes(sigDialogVM.viewingSystemID, getTargetSystem());\r\n\t\t\t\t\t\treturn extractor(eligible);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfunction renderInbound(item) {\t// Render with the type of the systems, if we know, so we don't get \"from: [drifter wormholes]\" if we know we're in a C2\r\n\t\t\t\t\treturn wormholeRendering.renderWormholeType(item, item.key, getTargetName(), sigDialogVM.viewingSystem.name);\r\n\t\t\t\t}\r\n\t\t\t\tfunction renderOutbound(item) {\t// As above\r\n\t\t\t\t\treturn wormholeRendering.renderWormholeType(item, item.key, sigDialogVM.viewingSystem.name, getTargetName());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigTypeFrom']\").inlinecomplete({source: aSigWormholes, renderer: renderOutbound, maxSize: 10, delay: 0, customDropdown: sigTypeDropdownFiller(function(x) { return x.from; })});\r\n\t\t\t\t$(\"#dialog-signature [data-autocomplete='sigTypeTo']\").inlinecomplete({source: aSigWormholes, renderer: renderInbound, maxSize: 10, delay: 0, customDropdown: sigTypeDropdownFiller(function(x) { return x.to; })});\r\n\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").durationPicker();\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").on(\"change\", function() {\r\n\t\t\t\t\t// prevent negative values\r\n\t\t\t\t\tif (this.value < 0) {\r\n\t\t\t\t\t\tthis.value = 0;\r\n\t\t\t\t\t\t$(this).change();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure first signature ID field only accepts letters\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha'], #dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[a-zA-Z?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Move to the numeric ID after filling out alpha ID\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID2_Alpha']\").on(\"input\", function() {\r\n\t\t\t\t\tif (this.value.length === 3) {\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureID2_Numeric']\").select();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Ensure second signature ID field only accepts numbers\r\n\t\t\t\t$(\"#dialog-signature [name='signatureID_Numeric'], #dialog-signature [name='signatureID2_Numeric']\").on(\"input\", function() {\r\n\t\t\t\t\twhile (!/^[0-9?]*$/g.test(this.value)) {\r\n\t\t\t\t\t\tthis.value = this.value.substring(0, this.value.length -1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// Positioning hack to separate delete button visually\r\n\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Delete')\").css( { position: 'absolute', left: '30px' } );\r\n\r\n\t\t\t\t// Select value on click\r\n\t\t\t\t$(\"#dialog-signature .signatureID, #dialog-signature .wormholeType\").on(\"click\", function() {\r\n\t\t\t\t\t$(this).select();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Auto fill opposite side wormhole w/ K162\r\n\t\t\t\t$(\"#dialog-signature .wormholeType\").on(\"input, change\", function() {\r\n\t\t\t\t\tif (this.value.length > 0 && aSigWormholes[this.value.toUpperCase()] != -1 && this.value.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\r\n\t\t\t\t\t\t// Also auto calculate duration\r\n\t\t\t\t\t\tif (appData.wormholes[this.value.toUpperCase()]) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(appData.wormholes[this.value.toUpperCase()].life.substring(0, 2) * 60 * 60).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value.toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\tif (aSigWormholes[$(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase()] || $(\"#dialog-signature .wormholeType\").not(this).val().toUpperCase() === \"K162\") {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"????\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this.value == \"????\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature .wormholeType\").not(this).val(\"K162\");\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Toggle between wormhole and regular signatures\r\n\t\t\t\t$(\"#dialog-signature\").on(\"selectmenuchange\", \"[name='signatureType']\", function() {\r\n\t\t\t\t\tif (this.value == \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").slideDown(200, function() { $(this).show(200); });\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").slideUp(200, function() { $(this).hide(0); });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$(\"#form-signature\").submit(function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar form = $(this).serializeObject();\r\n\t\t\t\t\tvar valid = true;\r\n\t\t\t\t\tValidationTooltips.close();\r\n\r\n\t\t\t\t\t// Validate full signature ID fields (blank | 3 characters)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .signatureID:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.length < 3) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be 3 characters in length!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate full signature ID doesn't already exist in current system\r\n\t\t\t\t\tif (form.signatureID_Alpha.length === 3 && form.signatureID_Numeric.length === 3) {\r\n\t\t\t\t\t\tfor(var sigKey in tripwire.client.signatures) {\r\n\t\t\t\t\t\t\tconst existing = tripwire.client.signatures[sigKey];\r\n\t\t\t\t\t\t\tif((existing.id != sigDialogVM.sigId) && // not the sig we are editing\r\n\t\t\t\t\t\t\t\t(existing.signatureID == form.signatureID_Alpha.toLowerCase() + form.signatureID_Numeric) && // same name\r\n\t\t\t\t\t\t\t\t(existing.systemID == sigDialogVM.viewingSystemID) // in current system\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tValidationTooltips.open({target: $(\"#dialog-signature .signatureID:first\")}).setContent(\"Signature ID already exists! <input type='button' autofocus='true' id='overwrite' value='Overwrite' style='margin-bottom: -4px; margin-top: -4px; font-size: 0.8em;' data-id='\"+ sigKey +\"' />\");\r\n\t\t\t\t\t\t\t\t$(\"#overwrite\").focus();\r\n\t\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate wormhole types (blank | wormhole)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .wormholeType:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && !aSigWormholes[this.value.toUpperCase()] && this.value != \"????\") {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid wormhole type!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to system (blank | system)\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && appData.genericSystemTypes.findIndex((item) => this.value.toLowerCase() === item.toLowerCase()) == -1 && !findSystemID(this.value)) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Must be a valid leads to system!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\t// Validate leads to isn't the viewing system which causes a inner loop\r\n\t\t\t\t\t$.each($(\"#dialog-signature .leadsTo:visible\"), function() {\r\n\t\t\t\t\t\tif (this.value.length > 0 && this.value.toLowerCase() === sigDialogVM.viewingSystem.name.toLowerCase()) {\r\n\t\t\t\t\t\t\tValidationTooltips.open({target: $(this)}).setContent(\"Wormhole cannot lead to the same system it comes from!\");\r\n\t\t\t\t\t\t\t$(this).select();\r\n\t\t\t\t\t\t\tvalid = false;\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!valid) return false;\r\n\r\n\t\t\t\t\tvar payload = {};\r\n\t\t\t\t\tvar undo = [];\r\n\t\t\t\t\tif (form.signatureType === \"wormhole\") {\r\n\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar leadsTo = wormholeAnalysis.targetSystemID(form.leadsTo, form.wormholeType);\r\n\r\n\t\t\t\t\t\tvar signature2 = {\r\n\t\t\t\t\t\t\t\"signatureID\": form.signatureID2_Alpha + form.signatureID2_Numeric,\r\n\t\t\t\t\t\t\t\"systemID\": leadsTo,\r\n\t\t\t\t\t\t\t\"type\": \"wormhole\",\r\n\t\t\t\t\t\t\t\"name\": form.wormholeName2,\r\n\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar type = null;\r\n\t\t\t\t\t\tvar parent = null;\r\n\t\t\t\t\t\tif (form.wormholeType.length > 0 && aSigWormholes[form.wormholeType.toUpperCase()] && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && aSigWormholes[form.wormholeType2.toUpperCase()] && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"secondary\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\tparent = \"initial\";\r\n\t\t\t\t\t\t\ttype = \"????\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar wormhole = {\r\n\t\t\t\t\t\t\t\"type\": type,\r\n\t\t\t\t\t\t\t\"parent\": parent,\r\n\t\t\t\t\t\t\t\"life\": form.wormholeLife,\r\n\t\t\t\t\t\t\t\"mass\": form.wormholeMass\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tsignature.id = $(\"#dialog-signature\").data(\"signatureid\");\r\n\t\t\t\t\t\t\tsignature2.id = $(\"#dialog-signature\").data(\"signature2id\");\r\n\t\t\t\t\t\t\twormhole.id = $(\"#dialog-signature\").data(\"wormholeid\");\r\n\r\n\t\t\t\t\t\t\t// Update the initial and type based on which side of the wormhole we are editing\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\tif (form.wormholeType.length > 0 && aSigWormholes[form.wormholeType.toUpperCase()] && form.wormholeType.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.length > 0 && aSigWormholes[form.wormholeType2.toUpperCase()] && form.wormholeType2.toUpperCase() != \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = form.wormholeType2.toUpperCase();\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"secondary\" : \"initial\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t} else if (form.wormholeType2.toUpperCase() == \"K162\") {\r\n\t\t\t\t\t\t\t\t\twormhole.parent = tripwire.client.wormholes[wormhole.id].initialID == signature.id ? \"initial\" : \"secondary\";\r\n\t\t\t\t\t\t\t\t\twormhole.type = \"????\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.wormholes[wormhole.id]) {\r\n\t\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [{\"wormhole\": wormhole, \"signatures\": [signature, signature2]}]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (sigDialogVM.mode == \"update\") {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"id\": $(\"#dialog-signature\").data(\"signatureid\"),\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"update\": [signature]}};\r\n\r\n\t\t\t\t\t\t\tif (tripwire.client.signatures[signature.id].type == \"wormhole\") {\r\n\t\t\t\t\t\t\t\t//used to be a wormhole\r\n\t\t\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\t\t\t\t\t\t\tvar signature2 = signature.id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t\t\tundo.push({\"wormhole\": tripwire.client.wormholes[wormhole.id], \"signatures\": [tripwire.client.signatures[signature.id], tripwire.client.signatures[signature2.id]]});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// used to be just a regular signature\r\n\t\t\t\t\t\t\t\tundo.push(tripwire.client.signatures[signature.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar signature = {\r\n\t\t\t\t\t\t\t\t\"signatureID\": form.signatureID_Alpha + form.signatureID_Numeric,\r\n\t\t\t\t\t\t\t\t\"systemID\": sigDialogVM.viewingSystemID,\r\n\t\t\t\t\t\t\t\t\"type\": form.signatureType,\r\n\t\t\t\t\t\t\t\t\"name\": form.signatureName,\r\n\t\t\t\t\t\t\t\t\"lifeLength\": form.signatureLength\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tpayload = {\"signatures\": {\"add\": [signature]}};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"disable\");\r\n\r\n\t\t\t\t\tvar success = function(data) {\r\n\t\t\t\t\t\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature\").dialog(\"close\");\r\n\r\n\t\t\t\t\t\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\r\n\t\t\t\t\t\t\tif (sigDialogVM.mode == \"add\") {\r\n\t\t\t\t\t\t\t\tundo = data.results;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (sigDialogVM.viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID].push({action: sigDialogVM.mode, signatures: undo});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttripwire.signatures.undo[sigDialogVM.viewingSystemID] = [{action: sigDialogVM.mode, signatures: undo}];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar always = function() {\r\n\t\t\t\t\t\t$(\"#sigEditForm input[type=submit]\").removeAttr(\"disabled\");\r\n\t\t\t\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").button(\"enable\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttripwire.refresh('refresh', payload, success, always);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topen: function() {\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\r\n\t\t\t\t$(\"#dialog-signature input\").val(\"\");\r\n\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(\"unknown\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(\"stable\").selectmenu(\"refresh\");\r\n\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(\"stable\").selectmenu(\"refresh\");\r\n\r\n\t\t\t\t$(\"#dialog-signature #site\").show();\r\n\t\t\t\t$(\"#dialog-signature #wormhole\").hide();\r\n\r\n\t\t\t\t// Side labels\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:first\").html(sigDialogVM.viewingSystem.name + \" Side\");\r\n\t\t\t\t$(\"#dialog-signature .sideLabel:last\").html(\"Other Side\");\r\n\r\n\t\t\t\t// Default signature life\r\n\t\t\t\t$(\"#dialog-signature #durationPicker\").val(options.signatures.pasteLife * 60 * 60).change();\r\n\r\n\t\t\t\tvar id = sigDialogVM.sigId;\r\n\t\t\t\tif (sigDialogVM.mode == \"update\" && id && tripwire.client.signatures[id]) {\r\n\t\t\t\t\tvar signature = tripwire.client.signatures[id];\r\n\t\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", id);\r\n\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Delete')\").show();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Edit Signature\");\r\n\r\n\t\t\t\t\tif (signature.type == \"wormhole\") {\r\n\t\t\t\t\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == id || wormhole.secondaryID == id) return wormhole; })[0];\r\n\t\t\t\t\t\tvar otherSignature = id == wormhole.initialID ? tripwire.client.signatures[wormhole.secondaryID] : tripwire.client.signatures[wormhole.initialID];\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", otherSignature.id);\r\n\t\t\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", wormhole.id);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst sigAlpha = signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\";\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(sigAlpha);\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='leadsTo']\").val(tripwire.systems[otherSignature.systemID] ? tripwire.systems[otherSignature.systemID].name : (appData.genericSystemTypes[otherSignature.systemID] ? appData.genericSystemTypes[otherSignature.systemID] : \"\"));\r\n\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Alpha']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID2_Numeric']\").val(otherSignature.signatureID ? otherSignature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeName2']\").val(otherSignature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeLife']\").val(wormhole.life).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='wormholeMass']\").val(wormhole.mass).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\r\n\t\t\t\t\t\tif (wormhole[wormhole.parent+\"ID\"] == signature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t} else if (wormhole[wormhole.parent+\"ID\"] == otherSignature.id) {\r\n\t\t\t\t\t\t\t$(\"#dialog-signature input[name='wormholeType2']\").val(wormhole.type).change();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Focus the sig ID, if it isn't set, otherwise the sig name\r\n\t\t\t\t\t\tif(sigAlpha != '???') { $(\"#dialog-signature input[name='wormholeName']\").select(); }\r\n\t\t\t\t\t\telse { $(\"#dialog-signature input[name='signatureID_Alpha']\").select(); }\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").val(signature.signatureID ? signature.signatureID.substr(0, 3) : \"???\");\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Numeric']\").val(signature.signatureID ? signature.signatureID.substr(3, 5) : \"\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(signature.type).selectmenu(\"refresh\").trigger(\"selectmenuchange\");\r\n\t\t\t\t\t\t$(\"#dialog-signature [name='signatureName']\").val(signature.name);\r\n\t\t\t\t\t\t$(\"#dialog-signature #durationPicker\").val(signature.lifeLength).change();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Not a wormhole - always focus the sig ID\r\n\t\t\t\t\t\t$(\"#dialog-signature input[name='signatureID_Alpha']\").select();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Hightlight first ID section, if not set, otherwise the name\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Change the dialog buttons\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Add')\").show();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Delete')\").hide();\r\n\t\t\t\t\t$(\"#dialog-signature\").parent().find(\"button:contains('Save')\").hide();\r\n\r\n\t\t\t\t\t// Change the dialog title\r\n\t\t\t\t\t$(\"#dialog-signature\").dialog(\"option\", \"title\", \"Add Signature\");\r\n\r\n\t\t\t\t\t$(\"#dialog-signature [name='signatureType']\").val(options.signatures.editType || \"unknown\").selectmenu(\"refresh\")\r\n\t\t\t\t\tif ($(\"#dialog-signature [name='signatureType']\").val() === \"wormhole\") {\r\n\t\t\t\t\t\t$(\"#dialog-signature #site\").hide();\r\n\t\t\t\t\t\t$(\"#dialog-signature #wormhole\").show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function() {\r\n\t\t\t\tValidationTooltips.close();\r\n\t\t\t\t$(\"#sigTable tr.selected\").removeClass(\"selected\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signatureid\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"signature2id\", \"\");\r\n\t\t\t\t$(\"#dialog-signature\").data(\"wormholeid\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t} else if (!$(\"#dialog-signature\").dialog(\"isOpen\")) {\r\n\t\t$(\"#dialog-signature\").dialog(\"open\");\r\n\t}\r\n};\r\n\r\n$(\"#sigTable tbody\").on(\"dblclick\", \"tr\", {mode: \"update\", source:\"sig-row\"}, sigDialog.openSignatureDialog);\r\n$(\"#edit-signature\").on(\"click\", {mode: \"update\", source:\"edit-sig\"}, sigDialog.openSignatureDialog);\r\n$(\"#add-signature\").click({mode: \"add\"}, sigDialog.openSignatureDialog);\r\n\r\n// Signature overwrite. Attached to document because the element gets recreated each time\r\nsigDialog.overwriteSignature = function(sigToRemove, completeFunction, always) {\r\n\tvar payload = {\"signatures\": {\"remove\": []}, \"systemID\": viewingSystemID};\r\n\tvar undo = [];\r\n\r\n\tvar signature = tripwire.client.signatures[sigToRemove];\r\n\tif (signature.type != \"wormhole\") {\r\n\t\tundo.push(signature);\r\n\t\tpayload.signatures.remove.push(signature.id);\r\n\t} else {\r\n\t\tvar wormhole = $.map(tripwire.client.wormholes, function(wormhole) { if (wormhole.initialID == signature.id || wormhole.secondaryID == signature.id) return wormhole; })[0];\r\n\t\tundo.push({\"wormhole\": wormhole, \"signatures\": [tripwire.client.signatures[wormhole.initialID], tripwire.client.signatures[wormhole.secondaryID]]});\r\n\t\tpayload.signatures.remove.push(wormhole);\r\n\t}\r\n\r\n\tvar success = function(data) {\r\n\t\t$(\"#undo\").removeClass(\"disabled\");\r\n\t\tif (viewingSystemID in tripwire.signatures.undo) {\r\n\t\t\ttripwire.signatures.undo[viewingSystemID].push({action: \"remove\", signatures: undo});\r\n\t\t} else {\r\n\t\t\ttripwire.signatures.undo[viewingSystemID] = [{action: \"remove\", signatures: undo}];\r\n\t\t}\r\n\r\n\t\tsessionStorage.setItem(\"tripwire_undo\", JSON.stringify(tripwire.signatures.undo));\r\n\t\t\r\n\t\tcompleteFunction(data);\r\n\t}\r\n\r\n\ttripwire.refresh('refresh', payload, success, always);\r\n}\r\n\r\n/** Delegate the next action after sig overwrite to the save dialog */\r\nsigDialog.delegateSave = function(data) {\r\n\tif (data.resultSet && data.resultSet[0].result == true) {\r\n\t\tValidationTooltips.close();\r\n\r\n\t\tif ($(\"#dialog-signature\").parent().find(\":button:contains('Save')\")) {\r\n\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Save')\").click();\r\n\t\t} else {\r\n\t\t\t$(\"#dialog-signature\").parent().find(\":button:contains('Add')\").click();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n$(document).on(\"click\", \"#overwrite\", function() { \r\n\t$(\"#overwrite\").attr(\"disable\", true);\r\n\tsigDialog.overwriteSignature($(this).data(\"id\"), sigDialog.delegateSave, function() {\r\n\t\t$(\"#overwrite\").removeAttr(\"disable\");\r\n\t}); \r\n});\r\n"]}